/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function($){var types=['DOMMouseScroll','mousewheel'];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks;}}
$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false);}}else{this.onmousewheel=handler;}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false);}}else{this.onmousewheel=null;}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel");},unmousewheel:function(fn){return this.unbind("mousewheel",fn);}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120;}
if(orgEvent.detail){delta=-orgEvent.detail/3;}
deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta;}
if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120;}
if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120;}
args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args);}})(jQuery);;var MS_SECOND=1000,MS_MINUTE=MS_SECOND*60,MS_HOUR=MS_MINUTE*60,MS_DAY=MS_HOUR*24;var VectorStock=VectorStock||{};VectorStock.js={excanvas:'/js/libraries/excanvas.3.0.min.js',jq_flot:'/js/libraries/jquery.flot.1.1.min.js',jq_spell:'/js/libraries/jquery.spellchecker.min.js',zclip:'/js/libraries/jquery.zclip.min.js',addthis:'//s7.addthis.com/js/250/addthis_widget.js#pubid=vectorstock',addthis_new:'//s7.addthis.com/js/300/addthis_widget.js#pubid=vectorstock',analytics:'//google-analytics.com/ga.js',facebook:'//connect.facebook.net/en_US/all.js#xfbml=1&appId=241100862642313',googleplus:'//apis.google.com/js/plusone.js',pinterest:'//assets.pinterest.com/js/pinit.js',twitter:'//platform.twitter.com/widgets.js'};VectorStock.google_id='101753067915-kdnvvq7hnnmrkia4f8ld6vrsuuco80c0.apps.googleusercontent.com';VectorStock.analytics_id='UA-2180430-2';VectorStock.host='//www.vectorstock.com';VectorStock.amazonHost='https://vectorstock-uploads.s3.amazonaws.com';VectorStock.domain='//cdn.vectorstock.com';VectorStock.time=new Date().getTime();VectorStock.defaultInputText=['Search any Keyword...','Search for Artist...','Search for Vector ID...'];VectorStock.cache={vectors:{}};VectorStock.track=function(){if(!window.ga){window.ga=function(){if(window.console&&window.console.log){console.log('Track: ',arguments);}};}
try{ga.apply(this,arguments)}
catch(err){}};VectorStock.trackPage=function(page,title){VectorStock.track('send','pageview',{page:page,title:title});};VectorStock.trackAction=function(label,data){if(window.mixpanel&&window.mixpanel.track){mixpanel.track(label,data);}};(function(){function isFileRemote(file){return(file.search(/https?:/i)>=0&&file.search(/:\/\/[w.]*vectorstock\.com/i)<0);}
function isBrowserOld(){if(head.browser.ie&&head.browser.version<9)return true;if(!window.JSON)return true;return false;}
function onErrorDefault(message,source,lineno,colno,error){if(source&&isFileRemote(source))return;if(!message||!message.match||message.match(/script error/i))return;if(isBrowserOld())return;var log={page:window.location.href,source:source,position:(lineno?(colno?lineno+':'+colno:lineno):''),user:($('#user_id').val()||$('input[name="account_timestamp"]').val()||'Unknown')};if(message.match(/nsresult:/i)){var exception=/\exception[\.]+\s+"(.+?)"/i.exec(message);if(exception.length>1){var location=/location:\s+"(.+?)"/i.exec(message);if(location.length>1){var url=/(https\S+)/i.exec(location[1]);if(url&&url.length>1){if(isFileRemote(url[1]))return;log.source=url[1];}
var line=/line (\d+)/i.exec(location[1]);if(line&&line.length>1)log.position=line[1];}
message=exception[1];}}
if(error&&error.stack){var regex=/([^@(\s]+?):([:\d]+)/i,match=regex.exec(error.stack),source=(match[1]||'');if(isFileRemote(source))return;log.stack=error.stack;}
VectorStock.track('send','event','Error (JS)',message,JSON.stringify(log));}
function onErrorAJAX(event,request,settings){if(request.status==0&&request.statusText=='error')return;if(isBrowserOld())return;var log={page:event.target.URL,request:settings.url,data:settings.data,method:settings.type,code:request.status,user:($('#user_id').val()||$('input[name="account_timestamp"]').val()||'Unknown')};if(request.status==401){if(window.SignupBox){var box=new SignupBox(false,'login');return;}}
if(request.status==200){log.response=request.responseText;}
VectorStock.track('send','event','Error (JS)','AJAXError: '+request.statusText,JSON.stringify(log));}
window.onerror=onErrorDefault;$(document).ajaxError(onErrorAJAX);})();var addthis_config={data_ga_property:VectorStock.analytics_id,data_track_clickback:true,data_ga_social:true};var adroll_adv_id='FGEN3AZRB5FR7IPG3EJY2N',adroll_pix_id='4MPPFIS53BCNTEJONTB5OY',__adroll_loaded=true;head.feature('localStorage',function(){try{return'localStorage'in window&&window['localStorage']!==null}
catch(e){return false}});head.feature('sessionStorage',function(){try{return'sessionStorage'in window&&window['sessionStorage']!==null}
catch(e){return false}});$.put=function(url,data,callback,type){if($.isFunction(data)){type=type||callback,callback=data,data={}}
return $.ajax({url:url,type:'PUT',data:data,success:callback,contentType:type});};$.delete=function(url,data,callback,type){if($.isFunction(data)){type=type||callback,callback=data,data={}}
return $.ajax({url:url,type:'DELETE',data:data,success:callback,contentType:type});};$.fn.forceNumericOnly=function(){return this.each(function(){$(this).keydown(function(e){if(e.keyCode==46||e.keyCode==8||e.keyCode==9||e.keyCode==27||e.keyCode==13||(e.keyCode==65&&e.metaKey===true)||(e.keyCode==65&&e.ctrlKey===true)||(e.keyCode>=35&&e.keyCode<=40)){return;}
else{if(e.shiftKey||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)){e.preventDefault();}}});$(this).on('change',function(){var value=$(this).val();$(this).val(value.replace(/\D/g,''));});})};$.fn.getCaretPosition=function(){var elem=this[0];if('selectionStart'in elem){return elem.selectionStart;}else if(document.selection){elem.focus();var sel=document.selection.createRange(),sel_length=document.selection.createRange().text.length;sel.moveStart('character',-elem.value.length);return sel.text.length-sel_length;}
return null;};$.fn.setCaretPosition=function(pos){this.each(function(index,elem){if(elem.setSelectionRange){elem.setSelectionRange(pos,pos);}else if(elem.createTextRange){var range=elem.createTextRange();range.collapse(true);range.moveEnd('character',pos);range.moveStart('character',pos);range.select();}});return this;};$.fn.isEmpty=function(){var val=this.val();if((val==this.attr('placeholder'))||(val=='')){return true;}
return false;};$.fn.typeEvents=function(){this.each(function(){var input=$(this),timeout_typing;input.on('keydown paste',function(){var len=input.val().length;setTimeout(function(){if(input.val().length!==len){input.trigger('value_change');}},10);});input.on('value_change',function(){if(timeout_typing)clearTimeout(timeout_typing);else input.trigger('type_start');timeout_typing=setTimeout(function(){input.trigger('type_stop');clearTimeout(timeout_typing);timeout_typing=null;},300);});});};$(window).each(function(){var wait=300,init=false,timeout;var scope=$(this);scope.on('resize',function(){if(!init){scope.trigger('resizeStart');init=true;}
clearInterval(timeout);timeout=setTimeout(function(){scope.trigger('resizeStop');init=false;},wait);});});Number.prototype.formatCommas=function(shorthand){if(shorthand){if(this>=1000000){return String(Math.floor(this/100000)/10)+'m';}
else if(this>=10000){return String(Math.floor(this/1000))+'k';}}
return String(this).replace(/(\d)(?=(\d{3})+\b)/g,'$1,');};Number.prototype.zeroPad=function(len){var str=this+'';return(str.length>=len?str:new Array(len-str.length+1).join('0')+str);};String.prototype.formatCommas=function(){var parts=this.split('.'),whole=parseInt(parts.shift());if(isNaN(whole))return this;else{return whole.formatCommas()+'.'+parts.join();}};String.prototype.toTitleCase=function(){return this.toLowerCase().replace(/(?:^|\s)\w/g,function(match){return match.toUpperCase();});};String.prototype.toNumber=function(){var adj=this.match(/%\s?$/gi)?0.01:1;return parseFloat(this.replace(/[\$,]/g,''))*adj;};if(!Array.prototype.filter){Array.prototype.filter=function(method,scope){if(this==null||typeof method!='function')
throw new TypeError();var arr=Object(this),len=arr.length>>>0,res=[];for(var i=0;i<len;i++){if(i in arr){var val=arr[i];if(method.call(scope,val,i,arr))
res.push(val);}}
return res;};}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(needle,index){index=index||0;var len=this.length;while(index<len){if(this[index]===needle)return index;++index;}
return-1;};}
Array.prototype.remove=function(){var needle,len=arguments.length,index;while(len&&this.length){needle=arguments[--len];while((index=this.indexOf(needle))!==-1){this.splice(index,1);}}
return this;};;var VSModule=function(){var INSTANCE={};var events={};INSTANCE.dispatchEvent=function(eventtype,arguments){if(events[eventtype]){if(arguments==null||arguments==undefined){arguments=[];}else if(arguments instanceof Array!==true){arguments=[arguments];}
var i=events[eventtype].length;while(i--){events[eventtype][i].apply(INSTANCE,arguments);}}
return INSTANCE;};INSTANCE.on=function(eventtype,method){if(typeof eventtype=='string'){var types=eventtype.split(' ');eventtype=(types.length>1)?types:eventtype;}
if(eventtype instanceof Array){for(var index in eventtype){INSTANCE.on(eventtype[index],method);}
return INSTANCE;}
if(!events[eventtype]){events[eventtype]=[];}
events[eventtype].push(method);return INSTANCE;};INSTANCE.off=function(eventtype,method){if(typeof eventtype=='string'){var types=eventtype.split(' ');eventtype=(types.length>1)?types:eventtype;}
if(eventtype instanceof Array){for(var index in eventtype){INSTANCE.off(eventtype[index],method);}
return INSTANCE;}
if(events[eventtype]){var i=events[eventtype].length;while(i--){if(events[eventtype][i]==method){events[eventtype].splice(i,1);break;}}}
return INSTANCE;};return INSTANCE;};;(function($){var ID_CLASSNAME='vs_loadicon';$.fn.loadingIcon=function(icon_type,icon_shade){var time_cleanup=1000,num_diameter=100,num_framerate=31,num_frames=18;var svg_code='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 40 40" style="enable-background:new 0 0 40 40;" xml:space="preserve"><g>'
+'<path d="M12.436,35.229C6.843,32.445,3,26.671,3,20c0-9.39,7.611-17,17-17l-2.532,7.767"/>'
+'<path d="M27.561,4.769C33.155,7.551,37,13.327,37,20c0,9.389-7.611,17-17,17l2.531-7.768"/>'
+'</g></svg>';var support_svg=$('html').hasClass('svginline'),support_animation=$('html').hasClass('cssanimation'),icon_type=(icon_type)?icon_type:'medium',icon_shade=(icon_shade)?icon_shade:'';support_svg=true;support_animation=true;var instances;this.each(function(){var frame=0,offset=0;var container,icon,film,int_animation,int_cleanup;function init(){icon=$('<span></span>').addClass(ID_CLASSNAME).addClass(icon_type).addClass(icon_shade).appendTo(container);film=$('<span></span>').appendTo(icon);if(support_svg&&support_animation){$(svg_code).appendTo(film);icon.addClass('animate_css');}
else{icon.addClass('animate_fbf');offset=parseInt(film.css('top'),10);var time_fps=Math.round(1000/num_framerate);int_animation=setInterval(animateJS,time_fps);}
int_cleanup=setInterval(isFinished,time_cleanup);instances=(instances)?instances.add(icon):icon;}
function animateJS(){var position=(frame*num_diameter*-1)+offset;film.css({top:position+'px'});frame=(frame<(num_frames-1))?frame+1:0;}
function isFinished(){if(icon.is(':hidden')||icon.css('opacity')<0.1||icon.css('visibility')=='hidden'){icon.remove();clearInterval(int_animation);clearInterval(int_cleanup);}}
container=$(this);init();});return instances;};})(jQuery);;(function($){$.fn.dropdown=function(settings_custom){var settings_default={classname:'dropdown',width:0};var settings=$.extend({},settings_default,settings_custom);this.each(function(){var original,module,button,label,options,area,list,icon;var is_open,selected_index,scroll_position,open_height;function init(){is_open=false;module=$('<div class="'+settings.classname+' open"><div class="dd_button"><span class="dd_label"></span><span class="dd_icon"></span></div><div class="dd_options"><div class="dd_area"><ul></ul></div></div></div>');button=$('.dd_button',module);label=$('.dd_label',module);options=$('.dd_options',module);area=$('.dd_area',options);list=$('ul',area);icon=$('<span class="dd_icon"></span>');original.after(module).hide();if(settings.size){module.addClass('dd_'+settings.size);}
if(settings.direction){module.addClass('dd_'+settings.direction);}
if(settings.theme){module.addClass('dd_'+settings.theme);}
module.width((settings.width>0)?settings.width:original.outerWidth());var scroll_tally=0;$('option',original).each(function(i){var item=$('<li>'+$(this).text()+'</li>').attr('data-val',$(this).val()).appendTo(list);if($(this).is(':selected')){item.append(icon).addClass('selected');label.html($(this).text());scroll_position=scroll_tally;selected_index=i;}
scroll_tally+=item.outerHeight();});open_height=options.height();module.on('open',open).on('close',close);button.on('click',toggleState);list.on('mousewheel',onMousewheel).on('click',onListClick);$(window).on('scroll',checkDirection);original.on('change',function(){var item_index=$('option:selected',this).index();selectItem(list.find('li').eq(item_index));});module.removeClass('open');checkDirection();}
function onMousewheel(event,delta){var top=list.scrollTop();if(delta>0&&top==0){event.preventDefault();}else{if(delta<0&&top==list[0].scrollHeight-list.innerHeight()){event.preventDefault();}}}
function toggleState(){if(is_open){close();}else{open();}}
function open(){if(!is_open){closeOtherDropDowns();$(document).on('mousedown',mouseDown);$(document).on('keydown',scrollTo);module.addClass('open');list.scrollTop(scroll_position);is_open=true;}}
function close(){if(is_open){$(document).off('mousedown',mouseDown);$(document).off('keydown',scrollTo);module.removeClass('open');module.addClass('close');if($('html').hasClass('csstransitions')){var transitionEnd='webkitTransitionEnd oTransitionEnd MSTransitionEnd transitionend',transitionComplete=function(){module.removeClass('close');module.off(transitionEnd,transitionComplete);};module.on(transitionEnd,transitionComplete);}
else{module.removeClass('close');}
is_open=false;}}
function mouseDown(event){if($((event).target).parents('.'+settings.classname).length===0){close();}}
function closeOtherDropDowns(){$('.'+settings.classname).not(module).each(function(){$(this).trigger('close');});}
function onListClick(event){if(event.target.tagName==='LI'){selectItem($(event.target));setTimeout(function(){close();},150);}}
function selectItem(item){var item_index=$('li',list).index(item);if(item_index!==selected_index){$('.selected',list).removeClass('selected');$('.dd_icon',list).remove();item.prepend(icon).addClass('selected');selected_index=item_index;label.html(item.text());scroll_position=list.scrollTop()+item.position().top-1;original[0].selectedIndex=selected_index;original.change();}}
function checkDirection(){var _window=$(window),boundary_top=_window.scrollTop(),boundary_bottom=boundary_top+_window.height(),module_top=module.offset().top,module_bottom=module_top+module.height();if(!is_open){if(((module_bottom<=boundary_bottom)&&(module_top>=boundary_top))){if(settings.direction=='up'){if(module_top-open_height<boundary_top){module.removeClass('dd_up');}else{module.addClass('dd_up');}}
else{if(module_bottom+open_height>boundary_bottom){module.addClass('dd_up');}else{module.removeClass('dd_up');}}}}}
function scrollTo(event){if($(':focus').length==0){if(event.keyCode>=65&&event.keyCode<=90){var limit=list[0].scrollHeight-list.height(),adjust=0,offset=0;$('li',list).each(function(){var code=$(this).text().charCodeAt(0);if($(this).attr('data-val')==''){adjust=$(this).outerHeight();offset+=adjust;}else if(code==event.keyCode){return false;}else if(code>event.keyCode){offset-=adjust;return false;}else{adjust=$(this).outerHeight();offset+=adjust;}});var offset=Math.min(offset,limit),change=Math.abs(list.scrollTop()-offset),duration=300+(Math.round(change/30)*5);scroll_position=offset;list.stop().animate({scrollTop:scroll_position},duration,'easeOutCubic');}}}
original=$(this);init();});return this;};})(jQuery);;var UserData=function(){var INSTANCE={};var URL_PROFILE='/json/json_profile.php';var user_id,cart=[],purchased=[],galleries=[],following=[];function init(){if(head.sessionStorage){if((sessionStorage.sid!==undefined)&&(sessionStorage.cart!==undefined)&&(sessionStorage.purchased!==undefined)){user_id=JSON.parse(sessionStorage.sid);cart=(JSON.parse(sessionStorage.cart)||cart);cart=($.isArray(cart))?cart:[];purchased=(JSON.parse(sessionStorage.purchased)||purchased);galleries=(sessionStorage.galleries?(JSON.parse(sessionStorage.galleries)||galleries):galleries);following=(sessionStorage.following?(JSON.parse(sessionStorage.following)||following):following);if(galleries.length===undefined){purge();getProfile();}}
else if(VectorStock.isLoggedIn()){getProfile();}}}
function getProfile(){$.get(URL_PROFILE).done(function(response){if(!response)logIssue();else setProfile(response);}).fail(logIssue);}
function logIssue(){try{$.get('/api/purchases/setup',function(response){VectorStock.track('send','event','Error (JS)','CustomError: JSON Profile','User ID: '+response.user_id);});}catch(e){}}
function setProfile(data){if(!data)return;user_id=data.id;cart=(data.cart||[]);cart=($.isArray(cart))?cart:[];purchased=(data.purchased||[]);galleries=(data.galleries||[]);following=(data.following||[]);save();}
function save(type){try{if(head.sessionStorage&&JSON&&JSON.stringify){if(!type||type=='id'){sessionStorage.sid=JSON.stringify(user_id);}
if(!type||type=='cart'){sessionStorage.cart=JSON.stringify(cart);}
if(!type||type=='purchased'){sessionStorage.purchased=JSON.stringify(purchased);}
if(!type||type=='galleries'){sessionStorage.galleries=JSON.stringify(galleries);}
if(!type||type=='following'){sessionStorage.following=JSON.stringify(following);}}}catch(e){}}
function getGalleryIndexByID(gallery_id){for(var i=0;i<galleries.length;i++){if(galleries[i].id==gallery_id){return i;}}
return null;}
function emptyGallery(gallery_id){var gallery_index=getGalleryIndexByID(gallery_id);galleries[gallery_index].contents=[];}
function purge(){if(head.sessionStorage){sessionStorage.removeItem('sid');sessionStorage.removeItem('cart');sessionStorage.removeItem('purchased');sessionStorage.removeItem('galleries');sessionStorage.removeItem('following');}}
INSTANCE.destroy=purge;INSTANCE.refresh=getProfile;INSTANCE.setProfile=setProfile;INSTANCE.isInCart=function(vector_id){vector_id=parseInt(vector_id);if(cart.length&&cart.indexOf&&cart.indexOf(vector_id)>-1)return true;return false;};INSTANCE.addToCart=function(vector_ids){if(vector_ids instanceof Array==false){vector_ids=[vector_ids];}
var i=vector_ids.length;while(i--){var vector_id=parseInt(vector_ids[i]);if(!INSTANCE.isInCart(vector_id)){cart.push(vector_id);}}
save('cart');return cart.length;};INSTANCE.removeFromCart=function(vector_ids){if(vector_ids instanceof Array==false){vector_ids=[vector_ids];}
if(cart.length){var i=vector_ids.length;while(i--){var vector_id=parseInt(vector_ids[i]),vector_index=cart.indexOf(vector_id);if(vector_index>-1){cart.splice(vector_index,1);}}}
save('cart');return cart.length;};INSTANCE.emptyCart=function(){cart=[];save('cart');};INSTANCE.getCart=function(){return cart;};INSTANCE.hasPurchased=function(vector_id){vector_id=parseInt(vector_id);if(purchased&&purchased.indexOf&&purchased.indexOf(vector_id)>-1)return true;return false;};INSTANCE.addPurchase=function(vector_ids){if(vector_ids instanceof Array==false){vector_ids=[vector_ids];}
var i=vector_ids.length;while(i--){var vector_id=parseInt(vector_ids[i]);if(!INSTANCE.hasPurchased(vector_id)){purchased.push(vector_id);}}
save('purchased');};INSTANCE.isInGallery=function(vector_id,gallery_id){vector_id=parseInt(vector_id);gallery_id=parseInt(gallery_id);var gallery_index=getGalleryIndexByID(gallery_id);if(galleries[gallery_index]){if(galleries[gallery_index].contents.indexOf(vector_id)>=0){return true;}}
return false;};INSTANCE.createGallery=function(gallery_id,gallery_name){gallery_id=parseInt(gallery_id);galleries.unshift({id:gallery_id,name:gallery_name,contents:[]});save('galleries');};INSTANCE.renameGallery=function(gallery_id,gallery_name){var gallery_index=getGalleryIndexByID(parseInt(gallery_id));galleries[gallery_index].name=gallery_name;save('galleries');};INSTANCE.addToGallery=function(vector_id,gallery_id){vector_id=parseInt(vector_id);gallery_id=parseInt(gallery_id);var gallery_index=getGalleryIndexByID(parseInt(gallery_id));if(!galleries[gallery_index]){getProfile();}else{galleries[gallery_index].contents.push(vector_id);save('galleries');}};INSTANCE.removeFromGallery=function(vector_id,gallery_id){vector_id=parseInt(vector_id);gallery_id=parseInt(gallery_id);var gallery_index=getGalleryIndexByID(parseInt(gallery_id));if(galleries[gallery_index]){var vector_index=galleries[gallery_index].contents.indexOf(vector_id);if(vector_index>-1){galleries[gallery_index].contents.splice(vector_index,1);}}
save('galleries');};INSTANCE.emptyGallery=function(gallery_id){emptyGallery(parseInt(gallery_id));save('galleries');};INSTANCE.deleteGallery=function(gallery_id){gallery_id=parseInt(gallery_id);emptyGallery(gallery_id);var gallery_index=getGalleryIndexByID(gallery_id);if(gallery_index){galleries.splice(gallery_index,1);}
save('galleries');};INSTANCE.isFollowing=function(artist_name){artist_name=artist_name.toLowerCase();if(following&&following.indexOf&&following.indexOf(artist_name)>-1)return true;return false;};INSTANCE.followArtist=function(artist_name){artist_name=artist_name.toLowerCase();if(following.indexOf(artist_name)===-1){following.push(artist_name);save('purchased');}};INSTANCE.unfollowArtist=function(artist_name){artist_name=artist_name.toLowerCase();var index=following.indexOf(artist_name);if(index>-1){following.splice(index,1);save('purchased');}};init();return INSTANCE;};;var MenuMobile=function(){var INSTANCE=new VSModule();var icon=$('#mobilenav-icon'),menu=$('#mobilenav-menu'),logout=$('li.logout a',menu);var is_mobile=$('html').hasClass('mobile'),is_open=false,int_closing=false;function init(){$('li[data-action="login"] a').on('click',function(){if(window.SignupBox){var box=new SignupBox(false,'login');return false;}});icon.on('click',function(event){if(is_open)close();else open();event.stopPropagation();event.preventDefault();});logout.on('click',function(){VectorStock.userData.destroy();$('form.logout',menu).submit();return false;});}
function open(){if(!is_open){clearInterval(int_closing);menu.removeClass('close');icon.addClass('open');menu.addClass('open');updateHeight();$(window).on('resize',updateHeight);$(document).on('click',clickOutside);is_open=true;}}
function close(){if(is_open){icon.removeClass('open');menu.addClass('close');int_closing=setTimeout(function(){menu.removeClass('open close');menu.css({height:''});},750);$(document).off('click',clickOutside);is_open=false;}}
function clickOutside(event){if(!$(event.target).closest(menu).length){close();}}
function updateHeight(){var height=$('body').outerHeight()-68;menu.css({height:height});}
INSTANCE.open=open;INSTANCE.close=close;init();return INSTANCE;};;(function($){$.fn.filestyle=function(options){var settings={width:250};if(options){$.extend(settings,options);};return this.each(function(){var self=this;var wrapper=$("<div>").css({"width":settings.imagewidth+"px","height":settings.imageheight+"px","background":"url("+settings.image+") 0 0 no-repeat","background-position":"right","display":"inline","position":"absolute","overflow":"hidden"});var filename=$('<input class="file">').addClass($(self).attr("class")).css({"display":"inline","width":settings.width+"px"});$(self).before(filename);$(self).wrap(wrapper);$(self).css({"position":"relative","height":settings.imageheight+"px","width":settings.width+"px","display":"inline","cursor":"pointer","opacity":"0.0"});if($.browser.mozilla){if(/Win/.test(navigator.platform)){$(self).css("margin-left","-142px");}else{$(self).css("margin-left","-168px");};}else{$(self).css("margin-left",settings.imagewidth-settings.width+"px");};$(self).bind("change",function(){filename.val($(self).val());});});};})(jQuery);;(function($){$.fn.copyField=function(){var CLASS_NAME='copyfield';this.each(function(){var contents;var instance,textfield,button,clipboard;function init(){textfield=$('input[type=text]',instance);button=$('button',instance);contents=textfield.val();if(!instance.hasClass(CLASS_NAME)){instance.addClass(CLASS_NAME);}
if($.fn.zclip===undefined){head.js(VectorStock.js.zclip,function(){build();});}}
function hasFlash(){return!!(navigator.mimeTypes["application/x-shockwave-flash"]||window.ActiveXObject&&new ActiveXObject('ShockwaveFlash.ShockwaveFlash'))}
function build(){clipboard=button.zclip({copy:textfield.val(),setHandCursor:true}).on('load',function(){instance.addClass('ready');button.css({opacity:0}).animate({opacity:1},300,'easeOutQuad');});if(hasFlash()&&$('html').hasClass('ie')){instance.addClass('ready');}
textfield.on('keypress',function(event){if(event.metaKey||event.ctrlKey){if(String.fromCharCode(event.keyCode).toUpperCase()=='C'){var onKeyUp=function(){textfield.removeClass('press').off('keyup',onKeyUp);};textfield.addClass('press').on('keyup',onKeyUp);}}
else{textfield.select();return false;}}).on('focus',function(){textfield.addClass('focus');setTimeout(function(){textfield.select();},1);}).on('blur',function(){textfield.removeClass('focus');});button.on('mouseenter',function(){textfield.addClass('highlight');}).on('mouseleave',function(){textfield.removeClass('highlight');}).on('mousedown',function(){textfield.addClass('press');}).on('mouseup',function(){textfield.removeClass('press');});}
instance=$(this);init();});return this;};})(jQuery);;(function($){$.fn.popout=function(customSettings){$.fn.popout.defaultSettings={className:'popout',align:'left'};var settings=$.extend({},$.fn.popout.defaultSettings,customSettings);this.each(function(){var isOpen;var instance,button,panel,content;function init(){isOpen=instance.hasClass('open');button=$('a:first',instance).wrapInner('<span class="po_icon"></span>');content=$('div:first',instance).wrap('<div class="po_panel"><div class="po_content"></div></div>');panel=$('.po_panel',instance);if(!instance.hasClass(settings.className)){instance.addClass(settings.className);}
if(settings.align=='right'){instance.addClass('alignr');}else if(settings.align=='center'){instance.addClass('alignc');}
button.on('click',function(){toggleState();return false;});instance.on('open',open);instance.on('close',close);if(isOpen){$(document).on('mousedown',mouseDown);}
instance.addClass('ready');}
function toggleState(){if(isOpen){instance.trigger('close');}else{instance.trigger('open');}}
function open(){if(!isOpen){closeAll();$(document).on('mousedown',mouseDown);instance.addClass('open');$('.po_content',panel).hide().slideDown(100,'easeOutExpo');isOpen=true;}}
function mouseDown(event){if($((event).target).parents('.'+settings.className).length===0){instance.trigger('close');}}
function close(){if(isOpen){$(document).off('mousedown',mouseDown);instance.removeClass('open');isOpen=false;}}
function closeAll(){$('.'+settings.className).each(function(){if($(this)[0]!==instance[0]){$(this).trigger('close');}});}
instance=$(this);init();});return this;};})(jQuery);;(function($){$.fn.mpopout=function(settings_custom){var CLASSNAME='mpopout';$.fn.mpopout.settings_default={align:'left'};var settings=$.extend({},$.fn.popout.settings_default,settings_custom);this.each(function(){var is_open;var instance,link_instant,link_toggle,panel;function init(){is_open=instance.hasClass('open');var display=$('.mpo_display',instance);link_instant=$('a:eq(0)',display).addClass('instant').wrapInner('<span class="mpo_icon_instant" />');link_toggle=$('a:eq(1)',display).addClass('toggle').wrapInner('<span class="mpo_icon_toggle" />');panel=$('.mpo_panel',instance).wrapInner('<div class="mpo_content"></div>');if(!instance.hasClass(CLASSNAME)){instance.addClass(CLASSNAME);}
if(settings.align=='right'){instance.addClass('alignr');}else if(settings.align=='center'){instance.addClass('alignc');}
link_toggle.on('click',function(){toggleState();return false;});instance.on('open',open);instance.on('close',close);if(is_open){$(document).on('mousedown',mouseDown);}
instance.addClass('ready');}
function toggleState(){if(is_open){instance.trigger('close');}else{instance.trigger('open');}}
function open(){if(!is_open){closeAll();$(document).on('mousedown',mouseDown);instance.addClass('open');is_open=true;}}
function mouseDown(event){if($((event).target).parents('.'+CLASSNAME).length===0){instance.trigger('close');}}
function close(){if(is_open){$(document).off('mousedown',mouseDown);instance.removeClass('open');is_open=false;}}
function closeAll(){$('.'+CLASSNAME).each(function(){if($(this)[0]!==instance[0]){$(this).trigger('close');}});}
instance=$(this);init();});return this;};})(jQuery);;var PreviewLink=function(element,vector_id,vector_title,is_pending){var INSTANCE=VSModule();var SIZE_WIDE=237,SIZE_HIGH=250;var axis='horizontal',is_enabled=true,is_text_only=false,src_cache={},src_thumb,src_preview;var pane,stem,area,grid,edge,img;function init(){vector_title=(vector_title||'');is_text_only=($('img',element).length)?false:true;src_thumb=VectorStock.imagePath(vector_id,'small',is_pending);src_preview=VectorStock.imagePath(vector_id,'medium',is_pending);element.on('mouseenter',showPreviewPane).on('mouseleave click',hidePreviewPane);}
function showPreviewPane(event){if(!is_enabled)return;$('#previewpane').remove();element.attr('title','');$('img',element).attr('title','');element.parent().addClass('hover');pane=$('<div id="previewpane"><span class="pp_title">'+vector_title+'</span></div>');area=$('<div></div>').addClass('pp_imagearea');stem=$('<div></div>');pane.prepend(area).prepend(stem);img=new Image();if((src_cache[vector_id])||(is_text_only)){$(img).attr('src',src_preview).addClass('pp_preview').appendTo(area);}
else{var errors=0,errorCheck=function(event){var img=$(event.target).remove(),src=img.attr('src');if(src==src_preview){grid.fadeOut(200,'easeOutSine');}
if(++errors>1){$('<div class="pp_error"><p>Preview image could not be loaded...</p></div>').appendTo(area).hide().fadeIn(500);}};grid=$('<div class="pp_grid"></div>').css('width',SIZE_WIDE);area.append(grid).append($('<img src="'+src_thumb+'" width="'+SIZE_WIDE+'" height="'+SIZE_HIGH+'" />').error(errorCheck)).css('width',SIZE_WIDE);$(img).load(function(){var scope=$(this).addClass('pp_preview').appendTo(area).addClass('hide');setTimeout(function(){scope.addClass('show');},10);src_cache[vector_id]=true;}).error(errorCheck).attr('src',src_preview);}
pane.appendTo('body').hide().fadeIn(200,'easeOutSine');var pane_width=SIZE_WIDE+parseFloat(area.css('marginLeft'))+parseFloat(area.css('marginRight')),pane_height=pane.outerHeight();pane.css('width',pane_width);if(axis==='vertical'){if(event.pageY<($(window).height()/2)){buffer_top=60;stem.addClass('pp_stemtop');}else{buffer_top=0-(pane_height+60);stem.addClass('pp_stembottom');}
var filler=5,box_space_left=event.pageX-$(event.target).offset().left,box_space_right=$(event.target).width()-box_space_left,offset_x=Math.ceil(pane_width/2);buffer_left=0-offset_x;var win_space_left=event.pageX-(offset_x+box_space_left+filler);if(win_space_left<0){buffer_left=Math.abs(win_space_left)-offset_x;}
var win_space_right=$(window).width()-(event.pageX+offset_x+box_space_right+filler);if(win_space_right<0){buffer_left=0-offset_x-Math.abs(win_space_right);}
var stem_left=Math.abs(buffer_left)-12;if(stem_left>SIZE_WIDE){stem_left=SIZE_WIDE;}
stem.css({left:stem_left});}
else{if(event.pageX<($(window).width()/2)){buffer_left=60;stem.addClass('pp_stemleft');}else{buffer_left=0-(pane_width+60);stem.addClass('pp_stemright');}
var inner_margin=130,mouse_y=event.pageY-$(window).scrollTop(),perc_y=mouse_y/$(window).height();if(mouse_y<inner_margin){perc_y=0;}else if(mouse_y>($(window).height()-inner_margin)){perc_y=1;}
buffer_top=0-Math.floor(perc_y*(pane.height()-55))-20;stem.css({top:Math.abs(buffer_top)-7});}
element.on('mousemove',followMouseCursor);followMouseCursor(event);}
function hidePreviewPane(event){element.attr('title',vector_title);$('img',element).attr('title',vector_title);element.parent().removeClass('hover');if(pane)pane.remove();element.off('mousemove',followMouseCursor);}
function followMouseCursor(event){pane.css('left',event.pageX+buffer_left).css('top',event.pageY+buffer_top);}
INSTANCE.disable=function(){is_enabled=false};INSTANCE.enable=function(){is_enabled=true};init();return INSTANCE;};;VectorStock.FieldInput=function(input,format){var INSTANCE=new VSModule();var mod_fset,err_message;INSTANCE.name=input.attr('name');INSTANCE.value=input.val();INSTANCE.minlength=(input.attr('minlength')?parseInt(input.attr('minlength')):null);INSTANCE.maxlength=(input.attr('maxlength')?parseInt(input.attr('maxlength')):null);INSTANCE.disabled=input.prop('disabled');function init(){mod_fset=input.closest('fieldset');input.on('focus',onFocus);input.on('blur',onBlur);input.on('keydown cut paste',onUpdate);input.on('change',onChange);if(format){if(format==VectorStock.FieldInput.FORMAT_ALPHANUMERIC)formatAlphaNumeric();}}
function onFocus(){INSTANCE.dispatchEvent('focus');}
function onBlur(){INSTANCE.dispatchEvent('blur');}
function onUpdate(event){if(event.keyCode==13){INSTANCE.dispatchEvent('return',INSTANCE.value);}
setTimeout(function(){var value=input.val();if(value!==INSTANCE.value){mod_fset.toggleClass('filled',(value!==''));INSTANCE.value=value;INSTANCE.dispatchEvent('update',INSTANCE.value);}},10);}
function onChange(){INSTANCE.value=input.val();INSTANCE.dispatchEvent('change',INSTANCE.value);}
function formatAlphaNumeric(){function restrictAlphaNumeric(event){if(event.metaKey||event.ctrlKey)return true;if(event.which==0)return true;if(event.which<33)return true;var character=String.fromCharCode(event.which);return!/[^a-zA-Z\d ]/.test(character);}
function reformatAlphaNumeric(event){setTimeout(function(){var value_original=input.val(),value_stripped=value_original.replace(/[^a-zA-Z\d ]/gi,'');input.val(value_stripped);});}
input.on('keypress',restrictAlphaNumeric);input.on('paste change input',reformatAlphaNumeric);}
INSTANCE.disable=function(){mod_fset.addClass('disabled');input.prop('disabled',true);INSTANCE.disabled=true;};INSTANCE.enable=function(){mod_fset.removeClass('disabled');input.prop('disabled',false);INSTANCE.disabled=false;};INSTANCE.focus=function(){input.focus();};INSTANCE.showError=function(message){if(err_message)return;mod_fset.addClass('error');var icon,wrap,copy;err_message=$('<div class="message" />').appendTo(mod_fset);icon=$('<div class="icon" />').appendTo(err_message);wrap=$('<div class="explanation" />').appendTo(err_message);copy=$('<p />').html(message).appendTo(wrap);function showError(){err_message.addClass('show');icon.off('touchstart',showError);$('body').on('touchstart',hideError);}
function hideError(){err_message.removeClass('show');icon.on('touchstart',showError);$('body').off('touchstart',hideError);}
function clearError(){INSTANCE.clearError();INSTANCE.off('update',clearError);}
icon.on('touchstart',showError);INSTANCE.on('update',clearError);};INSTANCE.clearError=function(){if(!err_message)return;mod_fset.removeClass('error');err_message.remove();err_message=null;};INSTANCE.hasError=function(){return(err_message?true:false);};INSTANCE.setValue=function(value,suppress_event){value=(value||'');input.val(value);INSTANCE.value=value;if(!suppress_event){INSTANCE.dispatchEvent('update',INSTANCE.value);}};init();return INSTANCE;};VectorStock.FieldInput.FORMAT_ALPHANUMERIC='alphanumeric';VectorStock.FieldCheckbox=function(input){var INSTANCE=new VSModule();var container,label,err_message;INSTANCE.name=input.attr('name');INSTANCE.checked=input.is(':checked');INSTANCE.disabled=input.prop('disabled');function init(){label=input.closest('label');container=label.parent();input.on('change',onChange);}
function onChange(){INSTANCE.checked=input.is(':checked');label.toggleClass('checked',INSTANCE.checked);INSTANCE.dispatchEvent('change',INSTANCE.checked);}
INSTANCE.toggle=function(checked){checked=(checked==undefined?!INSTANCE.checked:checked);input.prop('checked',checked);onChange();};INSTANCE.disable=function(){label.addClass('disabled');input.prop('disabled',true);INSTANCE.disabled=true;};INSTANCE.enable=function(){label.removeClass('disabled');input.prop('disabled',false);INSTANCE.disabled=false;};INSTANCE.showError=function(message){if(err_message)return;container.addClass('error');var wrap,copy;err_message=$('<div class="message" />').appendTo(container);wrap=$('<div class="explanation" />').appendTo(err_message);copy=$('<p />').html(message).appendTo(wrap);var clearError=function(){container.removeClass('error');err_message.remove();err_message=null;INSTANCE.off('change',clearError);};INSTANCE.on('change',clearError);};INSTANCE.hasError=function(){return(err_message?true:false);};init();return INSTANCE;};VectorStock.FieldRadioboxes=function(items){var INSTANCE=new VSModule();INSTANCE.value=null;INSTANCE.disabled=$('input[type="radio"]',items).prop('disabled');var container;function init(){container=items.parent();items.each(function(){var item=$(this),input=$('input[type="radio"]',item);if(input.is(':checked')){INSTANCE.value=input.val();item.addClass('checked');}else{item.removeClass('checked');}
item.on('mouseup',function(){if($(this).hasClass('checked')){INSTANCE.dispatchEvent('click');}});input.on('change',function(){selectItem(item);});});}
function selectItem(item,suppress_bubbling){var input=$('input[type="radio"]',item);if(!input.is(':checked'))input.prop('checked',true);INSTANCE.value=input.val();items.removeClass('checked');item.addClass('checked');if(!suppress_bubbling)INSTANCE.dispatchEvent('change',INSTANCE.value);}
INSTANCE.disable=function(){container.addClass('disabled');$('input[type="radio"]',items).prop('disabled',true);INSTANCE.disabled=true;};INSTANCE.enable=function(){container.removeClass('disabled');$('input[type="radio"]',items).prop('disabled',true);INSTANCE.disabled=false;};INSTANCE.set=function(value,suppress_bubbling){var input=$('input[value="'+value+'"]',items),item=input.closest('label');if(input.length){selectItem(item,suppress_bubbling);}};init();return INSTANCE;};VectorStock.FieldButton=function(button){var INSTANCE=new VSModule();var label,icon_area,load_icon;var label_default;INSTANCE.disabled=button.prop('disabled');function init(){label=$('.label',button);icon_area=$('.icon span',button);label_default=label.html();button.on('click',onClick);}
function onClick(event){INSTANCE.dispatchEvent('click',event);}
INSTANCE.disable=function(){button.prop('disabled',true);INSTANCE.disabled=true;};INSTANCE.enable=function(){button.prop('disabled',false);INSTANCE.disabled=false;};INSTANCE.setLoading=function(message,is_light){var shade=(is_light?'light':'');button.addClass('loading').prop('disabled',true);label.html(message);load_icon=icon_area.loadingIcon('medium',shade);INSTANCE.disabled=true;};INSTANCE.setLabel=function(value){label.html(value);};INSTANCE.revert=function(){button.removeClass('loading').prop('disabled',false);label.html(label_default);if(load_icon)load_icon.remove();INSTANCE.disabled=false;};init();return INSTANCE;};var ScreenSelect=function(container,is_contributor){var INSTANCE=new VSModule();var but_email,but_google,but_facebook,but_close,link_login;function init(){but_email=new VectorStock.FieldButton($('button[data-method="email"]',container));but_google=new VectorStock.FieldButton($('button[data-method="google"]',container));but_facebook=new VectorStock.FieldButton($('button[data-method="facebook"]',container));but_close=$('> button',container);link_login=$('.footer p a',container);but_email.on('click',switchToSignup);but_google.on('click',signupWithGoogle);but_facebook.on('click',signupWithFacebook);but_close.on('click',close);link_login.on('click',switchToLogin);}
function switchToSignup(event){INSTANCE.hide();INSTANCE.dispatchEvent('screen_signup');event.preventDefault();}
function switchToLogin(event){INSTANCE.hide();INSTANCE.dispatchEvent('screen_login');event.preventDefault();}
function signupWithGoogle(){var query_str=$.param({response_type:'code',access_type:'online',client_id:(VectorStock.google_id||'101753067915-kdnvvq7hnnmrkia4f8ld6vrsuuco80c0.apps.googleusercontent.com'),redirect_uri:window.location.protocol+'//'+window.location.host+'/api/google/login'+(is_contributor?'?contributer=1':''),state:'',scope:'email profile',approval_prompt:'auto'});VectorStock.goToURL('https://accounts.google.com/o/oauth2/auth?'+query_str);}
function signupWithFacebook(){but_facebook.setLoading('Connecting…',true);but_close.hide();INSTANCE.dispatchEvent('processing');$.get('/api/json/fblogin',(is_contributor?{contributer:1}:null),function(response){but_facebook.revert();but_close.show();INSTANCE.dispatchEvent('response');if(response.success==1){VectorStock.goToURL(response.url);}});}
function close(){INSTANCE.dispatchEvent('close');}
INSTANCE.show=function(is_instant){container.show();if(is_instant){container.addClass('reveal');}else{setTimeout(function(){container.addClass('reveal');},100);}};INSTANCE.hide=function(){container.hide().removeClass('reveal');};init();return INSTANCE;};var ScreenSignup=function(container,is_contributor){var INSTANCE=new VSModule();var REGEX_EMAIL=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;var RESPONSE_FIRSTNAME_MISSING='First name is required',RESPONSE_FIRSTNAME_MINCHARS='First name needs at least 2 characters',RESPONSE_FIRSTNAME_INVALID='First name contains invalid characters',RESPONSE_SURNAME_MISSING='Surname is required',RESPONSE_SURNAME_MINCHARS='Surname needs at least 2 characters',RESPONSE_SURNAME_INVALID='Surname contains invalid characters',RESPONSE_EMAIL_INVALID='Enter a valid email',RESPONSE_EMAIL_REGISTERED='Address has already been registered',RESPONSE_PASSWORD_MINCHARS='Use at least 6 characters',RESPONSE_TERMS_NOT_AGREED='You must agree to our Terms to Signup',RESPONSE_UNKNOWN='Hmm. Unknown error sorry! Please contact our support staff who will help you create an account.';var input_firstname,input_surname,input_email,input_password,radioboxes_account,area_company,input_company,input_billing,checkbox_terms,checkbox_mailinglist,fields_validate,but_submit,but_close,link_login;var email_responses={};function init(){input_firstname=new VectorStock.FieldInput($('input[name="firstname"]',container));input_surname=new VectorStock.FieldInput($('input[name="surname"]',container));input_email=new VectorStock.FieldInput($('input[name="email"]',container));input_password=new VectorStock.FieldInput($('input[name="password"]',container));radioboxes_account=new VectorStock.FieldRadioboxes($('fieldset[data-field="type"] li',container));area_company=$('[data-area="company"]',container);input_company=new VectorStock.FieldInput($('input[name="company"]',area_company));input_billing=new VectorStock.FieldInput($('textarea[name="billing"]',area_company));checkbox_terms=new VectorStock.FieldCheckbox($('input[name="terms"]',container));checkbox_mailinglist=new VectorStock.FieldCheckbox($('input[name="mailinglist"]',container));but_submit=new VectorStock.FieldButton($('.footer button[type="submit"]',container));but_close=$('> button',container);link_login=$('.footer p a',container);fields_validate=[input_firstname,input_surname,input_email,input_password,checkbox_terms];input_email.on('change',checkEmailAddress);radioboxes_account.on('change',changeAccountType);but_submit.on('click',validateFields);but_close.on('click',close);link_login.on('click',switchToLogin);if(input_email.value)checkEmailAddress();}
function checkEmailAddress(){var address_id=$.trim(input_email.value.toLowerCase());function showError(response){switch(response.error){case ScreenSignup.ERROR_EMAIL_INVALID:input_email.showError(RESPONSE_EMAIL_INVALID);break;case ScreenSignup.ERROR_EMAIL_REGISTERED:input_email.showError(RESPONSE_EMAIL_REGISTERED);break;default:alert(RESPONSE_UNKNOWN);}}
if(!address_id.match(REGEX_EMAIL)){input_email.showError(RESPONSE_EMAIL_INVALID);}
else{if(email_responses[address_id]){showError(email_responses[address_id]);}
else{$.get('/api/signup/email/check',{email:address_id},function(response){var address_id_current=$.trim(input_email.value.toLowerCase());if(!response.success&&address_id==address_id_current){showError(response);}
email_responses[address_id]=response;});}}}
function changeAccountType(type){var is_expanded=(type==ScreenSignup.ACCOUNT_TYPE_COMPANY);area_company.toggle(is_expanded);setTimeout(function(){INSTANCE.dispatchEvent('expand',is_expanded);});}
function validateFields(event){event.preventDefault();var firstname=$.trim(input_firstname.value);if(firstname=='')input_firstname.showError(RESPONSE_FIRSTNAME_MISSING);else if(firstname.length<input_firstname.minlength)input_firstname.showError(RESPONSE_FIRSTNAME_MINCHARS);var surname=$.trim(input_surname.value);if(surname=='')input_surname.showError(RESPONSE_SURNAME_MISSING);else if(surname.length<input_surname.minlength)input_surname.showError(RESPONSE_SURNAME_MINCHARS);var email=(input_email.value||'');if(!email.match(REGEX_EMAIL)){input_email.showError(RESPONSE_EMAIL_INVALID);}
if(input_password.value.length<input_password.minlength){input_password.showError(RESPONSE_PASSWORD_MINCHARS);}
if(!checkbox_terms.checked){checkbox_terms.showError(RESPONSE_TERMS_NOT_AGREED);}
var i=0,len=fields_validate.length;while(i<len){if(fields_validate[i].hasError()){var field=fields_validate[i].name.toTitleCase(),user_id=(input_email.value||'Unknown');VectorStock.track('send','event','Error (User)','Signup','Client: '+field);return false;}
i++;}
submit();}
function disableAllFields(){input_firstname.disable();input_surname.disable();input_email.disable();input_password.disable();checkbox_terms.disable();checkbox_mailinglist.disable();}
function enableAllFields(){input_firstname.enable();input_surname.enable();input_email.enable();input_password.enable();checkbox_terms.enable();checkbox_mailinglist.enable();}
function submit(){disableAllFields();but_submit.setLoading('Processing…');but_close.hide();INSTANCE.dispatchEvent('processing');var params={firstname:input_firstname.value,surname:input_surname.value,email:input_email.value,password:input_password.value,mailinglist:checkbox_mailinglist.checked,contributor:(is_contributor?1:0),json:1};if(radioboxes_account.value==ScreenSignup.ACCOUNT_TYPE_COMPANY){params.company=input_company.value;params.address=input_billing.value;}
$.post('/api/signup',params,function(response){var user_id=(input_email.value||'(Not set)');if(response.success){if(window.mixpanel){mixpanel.identify(response.id);mixpanel.people.set({'Firstname':params.firstname,'Surname':params.surname,'Email':params.email});}
INSTANCE.dispatchEvent('signup',params);}
else{enableAllFields();but_submit.revert();but_close.show();var error_label=(response.error?response.error.toTitleCase().split('_').join(' '):JSON.stringify(response));INSTANCE.dispatchEvent('response');switch(response.error){case ScreenSignup.ERROR_FIRSTNAME_MISSING:if(params.firstname.length>input_firstname.minlength){input_firstname.showError(RESPONSE_FIRSTNAME_INVALID);}else{input_firstname.showError(RESPONSE_FIRSTNAME_MISSING);}
error_label+=' ('+params.firstname+')';break;case ScreenSignup.ERROR_SURNAME_MISSING:if(params.surname.length>input_surname.minlength){input_surname.showError(RESPONSE_SURNAME_INVALID);}else{input_surname.showError(RESPONSE_SURNAME_MISSING);}
error_label+=' ('+params.surname+')';break;case ScreenSignup.ERROR_EMAIL_INVALID:input_email.showError(RESPONSE_EMAIL_INVALID);error_label+=' ('+params.email+')';break;case ScreenSignup.ERROR_EMAIL_REGISTERED:input_email.showError(RESPONSE_EMAIL_REGISTERED);break;case ScreenSignup.ERROR_PASSWORD_INVALID:input_password.showError(RESPONSE_PASSWORD_MINCHARS);break;default:alert(RESPONSE_UNKNOWN);}
VectorStock.track('send','event','Error (User)','Signup','Server: '+error_label);}});}
function show(){var is_expanded=(radioboxes_account.value==ScreenSignup.ACCOUNT_TYPE_COMPANY);container.addClass('reveal');INSTANCE.dispatchEvent('expand',is_expanded);if(input_firstname.value=='')input_firstname.focus();else if(input_surname.value=='')input_surname.focus();else if(input_email.value=='')input_email.focus();else if(input_password.value=='')input_password.focus();}
function close(){INSTANCE.dispatchEvent('close');}
function switchToLogin(event){INSTANCE.hide();INSTANCE.dispatchEvent('screen_login');event.preventDefault();}
INSTANCE.show=function(is_instant){container.show();if(is_instant)show();else setTimeout(show,100);};INSTANCE.hide=function(){container.hide().removeClass('reveal');};init();return INSTANCE;};ScreenSignup.ACCOUNT_TYPE_INDIVIDUAL='Individual';ScreenSignup.ACCOUNT_TYPE_COMPANY='Company';ScreenSignup.ERROR_FIRSTNAME_MISSING='FIRSTNAME_MISSING';ScreenSignup.ERROR_FIRSTNAME_MINCHARS='FIRSTNAME_MINCHARS';ScreenSignup.ERROR_SURNAME_MISSING='SURNAME_MISSING';ScreenSignup.ERROR_SURNAME_MINCHARS='SURNAME_MINCHARS';ScreenSignup.ERROR_EMAIL_INVALID='EMAIL_INVALID';ScreenSignup.ERROR_EMAIL_REGISTERED='EMAIL_REGISTERED';ScreenSignup.ERROR_PASSWORD_INVALID='PASSWORD_INVALID';var ScreenLogin=function(container){var INSTANCE=new VSModule();var REGEX_EMAIL=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;var RESPONSE_USERNAME_INVALID='Enter a valid username or email',RESPONSE_PASSWORD_INVALID='Use at least 6 characters',RESPONSE_UNKNOWN='Hmm. Unknown error sorry! Please contact our support staff who will help you further.';var input_username,input_password,but_login,but_google,but_facebook,but_close,link_select;function init(){input_username=new VectorStock.FieldInput($('form input[name="username"]',container));input_password=new VectorStock.FieldInput($('form input[name="password"]',container));but_login=new VectorStock.FieldButton($('form button[type="submit"]',container));but_google=new VectorStock.FieldButton($('.footer button[data-method="google"]',container));but_facebook=new VectorStock.FieldButton($('.footer button[data-method="facebook"]',container));but_close=$('> button',container);link_select=$('.footer p a',container);but_login.on('click',validateFields);but_google.on('click',googleLogin);but_facebook.on('click',facebookLogin);but_close.on('click',close);link_select.on('click',switchToSelect);}
function validateFields(event){event.preventDefault();if(input_username.value.length<4){input_username.showError(RESPONSE_USERNAME_INVALID);return false;}
if(input_password.value.length<6){input_password.showError(RESPONSE_PASSWORD_INVALID);return false;}
login();}
function disableAllFields(){input_username.disable();input_password.disable();}
function enableAllFields(){input_username.enable();input_password.enable();}
function login(){disableAllFields();but_login.setLoading('Logging in…');but_close.hide();INSTANCE.dispatchEvent('processing');var params={login_user:input_username.value,login_password:input_password.value,login_remember:1};$.post('/api/json/login',params,function(response){if(response.success){window.location.reload();}
else{enableAllFields();but_login.revert();but_close.show();INSTANCE.dispatchEvent('response');if(!response){VectorStock.track('send','event','Error (JS)','CustomError: Login issue (No Server Response)',JSON.stringify({user:params.login_user}));return;}
switch(response.error){case ScreenLogin.ERROR_FAILED:input_username.showError(response.message);input_password.showError(response.message);break;case ScreenLogin.ERROR_LOCKED:input_username.showError(response.message);break;case ScreenLogin.ERROR_DISABLED:input_username.showError(response.message);break;case ScreenLogin.ERROR_FACEBOOK:input_username.showError(response.message);break;default:response=(response?response:{});response.user=params.login_user;VectorStock.track('send','event','Error (JS)','CustomError: Login issue (Unknown Error)',JSON.stringify(response));alert(RESPONSE_UNKNOWN);}}});}
function googleLogin(){var query_str=$.param({response_type:'code',access_type:'online',client_id:(VectorStock.google_id||'101753067915-kdnvvq7hnnmrkia4f8ld6vrsuuco80c0.apps.googleusercontent.com'),redirect_uri:window.location.protocol+'//'+window.location.host+'/api/google/login',state:'',scope:'email profile',approval_prompt:'auto'});VectorStock.userData.destroy();window.location.href='https://accounts.google.com/o/oauth2/auth?'+query_str;}
function facebookLogin(){but_facebook.setLoading('Connecting…',true);$.post('/api/json/fblogin',function(response){if(response.success==1){but_facebook.revert();VectorStock.userData.destroy();window.location.href=response.url;}});}
function show(){container.addClass('reveal');if(input_username.value=='')input_username.focus();else if(input_password.value=='')input_password.focus();}
function close(){INSTANCE.dispatchEvent('close');}
function switchToSelect(event){INSTANCE.hide();INSTANCE.dispatchEvent('screen_select');event.preventDefault();}
INSTANCE.show=function(is_instant){container.show();if(is_instant)show();else setTimeout(show,100);};INSTANCE.hide=function(){container.hide().removeClass('reveal');};init();return INSTANCE;};ScreenLogin.ERROR_FAILED='FAILED';ScreenLogin.ERROR_LOCKED='LOCKED';ScreenLogin.ERROR_DISABLED='DISABLED';ScreenLogin.ERROR_FACEBOOK='FACEBOOK';var ScreenLicenses=function(container){var INSTANCE=new VSModule();var header,button;function init(){header=$('h1',container);button=$('.footer button',container);button.on('click',onNextScreen);}
function onNextScreen(){INSTANCE.dispatchEvent('screen_next');}
INSTANCE.setName=function(name){var copy=header.text().replace(/{NAME}/i,name.toTitleCase());header.text(copy);};INSTANCE.show=function(){container.show();setTimeout(function(){container.addClass('reveal');},100);};INSTANCE.hide=function(){container.hide().removeClass('reveal');};init();return INSTANCE;};var ScreenPricing=function(container){var INSTANCE=new VSModule();var button;function init(){button=$('.footer button',container);button.on('click',onNextScreen);}
function onNextScreen(){INSTANCE.dispatchEvent('screen_next');}
INSTANCE.show=function(){container.show();setTimeout(function(){container.addClass('reveal');},100);};INSTANCE.hide=function(){container.hide().removeClass('reveal');};init();return INSTANCE;};var SignupBox=function(is_contributor,selected_screen){var INSTANCE=new VSModule();var overlay,container,sidebar,sb_screens,sb_background_1,sb_background_2,screens,screen_select,screen_signup,screen_login,screen_licenses,screen_pricing;var is_mobile=$('html').hasClass('mobile');function init(){overlay=$('<div class="overlay" />').css({height:$(document).height()}).appendTo('body').on('click',onClickOverlay);setTimeout(function(){overlay.addClass('reveal');});build(SignupBox.template);if(container.css('position')=='absolute'){VectorStock.scrollTo(0);}}
function onClickOverlay(event){if($(event.target)[0]==overlay[0]){INSTANCE.close();}}
function build(html_template){container=$(html_template).appendTo(overlay);sidebar=$('.sb-sidebar',container);sb_screens=$('.sb-screen',sidebar);sb_background_1=$('.sb-background [data-pattern="1"]',sidebar);sb_background_2=$('.sb-background [data-pattern="2"]',sidebar);screens=$('.sb-screens',container);screen_select=new ScreenSelect($('[data-screen="select"]',screens),is_contributor);screen_signup=new ScreenSignup($('[data-screen="signup"]',screens),is_contributor);screen_login=new ScreenLogin($('[data-screen="login"]',screens));screen_licenses=new ScreenLicenses($('[data-screen="licenses"]',screens));screen_pricing=new ScreenPricing($('[data-screen="pricing"]',screens));screen_select.on('processing',disableOverlay).on('response',enableOverlay).on('screen_signup',showSignup).on('close',INSTANCE.close).on('screen_login',showLogin);screen_signup.on('expand',expandBox).on('processing',disableOverlay).on('response',enableOverlay).on('close',INSTANCE.close).on('signup',onSignup).on('screen_login',showLogin);screen_login.on('processing',disableOverlay).on('login',onLogin).on('response',enableOverlay).on('close',INSTANCE.close).on('screen_select',showSelect);screen_licenses.on('screen_next',showPricing);screen_pricing.on('screen_next',goToPurchase);if(selected_screen=='login'){sb_screens.hide().filter('[data-type=login]').show();showLogin(true);}else showSelect(true);setTimeout(function(){container.addClass('reveal');});}
function onLogin(){INSTANCE.dispatchEvent('login');}
function expandBox(is_expanded){container.toggleClass('expanded',is_expanded);}
function disableOverlay(){overlay.off('click',onClickOverlay);}
function enableOverlay(){overlay.on('click',onClickOverlay);}
function showSelect(is_instant){sb_screens.hide().filter('[data-type=default]').show();screen_select.show(is_instant);}
function showSignup(is_instant){screen_signup.show(is_instant);}
function showLogin(is_instant){expandBox(false);screen_login.show(is_instant);}
function onSignup(params){VectorStock.trackAction('Signup',{type:'Popup'});if(is_contributor){goToSellVectors();}else{if(is_mobile){goToPurchase();}else{goToPurchase();}}}
function showLicense(params){screen_signup.hide();container.addClass('membership');screen_licenses.setName(params.firstname);screen_licenses.show();sb_background_1.addClass('reveal');}
function showPricing(){screen_licenses.hide();screen_pricing.show();sb_background_2.addClass('reveal');}
function goToPurchase(){var url='/purchase';var vector_id=$('#vector_id').val();if(vector_id){var vector_license=$('input[name="license"]:checked').val(),vector_payment=$('input[name="payment_'+vector_license+'"]:checked').val();if(vector_payment)url+='/'+vector_payment;url+='?id='+vector_id;if(vector_license)url+='&license='+vector_license;}
VectorStock.goToURL(url);}
function goToSellVectors(){VectorStock.goToURL('/account/sell-vectors');}
INSTANCE.close=function(){if(container)container.remove();overlay.remove();INSTANCE.dispatchEvent('close');};init();return INSTANCE;};SignupBox.template='<div id="box-signup" class="overlay-box"><div class="sb-sidebar"><div class="sb-screen" data-type="default" style="display:block;"><div class="sb-content"><h1>VectorStock</h1><div class="sb-features" data-type="signup"><h2 data-type="signup">Create your <strong>Free Account</strong> for access to:</h2><h2 data-type="login">Login for access to:</h2><ul><li>41,000 Free Vectors</li><li>Millions of Royalty-Free Images</li><li>10,000+ new images added daily</li></ul></div><div class="sb-customers"><h3>Some of our customers —</h3><ul><li class="co-disney">Disney</li><li class="co-oracle">Oracle</li><li class="co-nike">Nike</li><li class="co-warner">Warner Brothers</li></ul></div></div><div class="sb-background"><div class="bg" data-pattern="1"></div><div class="bg" data-pattern="2"></div></div></div><div class="sb-screen" data-type="login"><div class="sb-content"><h1>VectorStock</h1><div class="sb-features"><p><strong>Whoops - it seems that you’re <br>not logged in.</strong></p><p>Login to continue…</p></div></div><div class="sb-background"><div class="bg reveal" data-pattern="1"></div></div></div></div><div class="sb-screens"><div class="screen" data-screen="select"><div class="header"><h1>Select Signup Method</h1><button type="button" data-method="email"><span class="label">Email Address</span><span class="icon"><span></span></span></button><button type="button" data-method="google"><span class="label">Google</span><span class="icon"><span></span></span></button><button type="button" data-method="facebook"><span class="label">Facebook</span><span class="icon"><span></span></span></button></div><div class="footer"><p>Already have an account? <a href="/">Log in</a></p></div><button data-action="close" type="button">Close</button></div><div class="screen" data-screen="signup"><form action="/signup" method="POST" novalidate><div class="header"><h1>Enter your details</h1><div class="fields"><div class="fieldgroup"><fieldset data-field="firstname"><input type="text" name="firstname" minlength="2" maxlength="45" placeholder="First name" autocomplete="on" tabindex="1001" /></fieldset><fieldset data-field="surname"><input type="text" name="surname" minlength="2" maxlength="45" placeholder="Surname" autocomplete="on" tabindex="1002" /></fieldset></div><fieldset data-field="email"><input type="email" name="email" maxlength="100" autocomplete="on" autocorrect="off" autocapitalize="off" placeholder="Email address" tabindex="1003" /></fieldset><fieldset data-field="password"><input type="password" name="password" minlength="6" maxlength="20" placeholder="Password" tabindex="1004"></fieldset><fieldset data-field="type"><h6>Account Type</h6><ul><li class="checked"><label for="f_type_individual"><span class="radio"><span></span><input type="radio" id="f_type_individual" name="account_type" value="Individual" checked="checked" tabindex="1005"></span><span class="title">Individual</span></label></li><li><label for="f_type_company"><span class="radio"><span></span><input type="radio" id="f_type_company" name="account_type" value="Company" tabindex="1006"></span><span class="title">Company</span></label></li></ul></fieldset><div data-area="company"><fieldset data-field="company"><input type="text" name="company" autocomplete="on" autocorrect="off" autocapitalize="off" placeholder="Company name" tabindex="1007"></fieldset><fieldset data-field="billing"><textarea name="billing" placeholder="Billing address" tabindex="1008"></textarea></fieldset></div></div><div class="agreements"><ul><li><label for="f_terms" class="checked"><span class="checkbox"><input type="checkbox" id="f_terms" name="terms" value="1" checked="checked" tabindex="1009" /></span><span class="title">Agree to our <a href="/faq/members/membership-agreement" target="_blank">Terms of Use</a> and <a href="/faq/members/privacy-policy" target="_blank">Privacy&nbsp;Policy</a></span></label></li><li><label for="f_mailinglist" class="checked"><span class="checkbox"><input type="checkbox" id="f_mailinglist" name="mailinglist" value="1" checked="checked" tabindex="1010" /></span><span class="title">Signup to the VectorStock mailing&nbsp;list</span></label></li></ul></div></div><div class="footer"><button type="submit" tabindex="1011"><span class="label">Create Account</span><span class="icon"><span></span></span></button><p>Already have an account? <a href="/">Log in</a></p></div></form><button data-action="close" type="button">Close</button></div><div class="screen" data-screen="login"><form action="/login" method="POST" novalidate><h1>Login<span class="full"> to your account</span></h1><div class="fields"><fieldset data-field="username"><input type="text" name="username" autocomplete="on" autocorrect="off" autocapitalize="off" maxlength="100" placeholder="Username or Email" tabindex="1001" /></fieldset><fieldset data-field="password"><input type="password" name="password" maxlength="20" placeholder="Password" tabindex="1002"></fieldset></div><button type="submit" tabindex="1003"><span class="label">Login</span><span class="icon"><span></span></span></button><p><a href="/request/password">Forgot your password?</a></p></form><div class="footer"><h1>Or login with:</h1><div class="options"><button type="button" data-method="google" tabindex="1004"><span class="label">Google</span><span class="icon"><span></span></span></button><button type="button" data-method="facebook" tabindex="1005"><span class="label">Facebook</span><span class="icon"><span></span></span></button></div><p>New to VectorStock? <a href="/signup">Sign up for&nbsp;free!</a></p></div><button data-action="close" type="button">Close</button></div><div class="screen" data-screen="licenses"><h1>Welcome {NAME}!</h1><h2>Our images are available in 3 licenses:</h2><table cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="title">Free</td><td>For personal use</td></tr><tr><td class="title">Standard</td><td>For print, advertising, design etc.</td></tr><tr><td class="title">Expanded</td><td>For resale &amp; distribution</td></tr></tbody></table><div class="footer"><button type="button"><span class="label">Continue…</span><span class="icon"><span></span></span></button></div></div><div class="screen" data-screen="pricing"><h1>Image Pricing</h1><h2>You can buy images using:<br><strong>Monthly Subscription</strong> (best price) or<br><strong>Pre-paid Credits</strong> (use anytime).</h2><table cellpadding="0" cellspacing="0" border="0"><thead><tr><th></th><th title="Free License">Free</th><th title="Standard License">Standard</th><th title="Expanded License">Expanded</th></tr></thead><tbody><tr><td class="title">Subscription</td><td><sup>$</sup>0</td><td><small>From</small> 69<sub>¢</sub></td><td class="disabled" title="Not Available">N/A</td></tr><tr><td class="title">Credits</td><td><sup>$</sup>0</td><td><small>From</small> <sup>$</sup>1</td><td><sup>$</sup>25</td></tr></tbody></table><div class="footer"><button type="button"><span class="label">Get Started!</span><span class="icon"><span></span></span></button></div></div></div></div>';$(function(){function launchSignupBox(url){var url=url.split('?'),params=(url.length>1?url[1].toLowerCase().split('&'):[]),is_contributor=false;var i=params.length;while(i--){var parts=params[i].split('='),key=parts[0],value=(parts.length>1?parts[1]:'');if(key=='contributor'&&value!==0){is_contributor=true;break;}}
var box=new SignupBox(is_contributor);}
if(window.location.pathname.toLowerCase()!=='/signup'){$('a[href^="/signup"]').on('click',function(event){launchSignupBox($(this).attr('href'));event.preventDefault();});$(window).on('redirect',function(event,url,path){if(path=='/signup'){launchSignupBox(url);if(event.preventDefault)event.preventDefault();else event.isDefaultPrevented=function(){return true;};}});}
if(window.location.search.search(/login=1/i)>=0)
{new SignupBox(false,'login');}
if(window.location.search.search(/signup=1/i)>=0)
{new SignupBox();}});;var GalleryBox=function(image_id,image_title,image_artist){var INSTANCE=new VSModule();var overlay,container,screens,hd_browse,hd_create,gl_list;var is_mobile=$('html').hasClass('mobile');function init(){overlay=$('<div class="overlay" />').css({height:$(document).height()}).appendTo('body').on('click',onClickOverlay).on('mousewheel',function(e){});setTimeout(function(){overlay.addClass('reveal');});build(GalleryBox.template);if(GalleryBox.galleries){populate(GalleryBox.galleries);}else{$.get('/api/galleries/byname').done(function(response){GalleryBox.galleries=response;populate(GalleryBox.galleries);}).fail(function(event){if(event.status==401){INSTANCE.close();}});}
VectorStock.trackAction('Add to Gallery',{id:image_id});}
function build(html_template){var sidebar,sb_content,figure,figure_img,figure_inner,screen,header,gl_pane;container=$(html_template).appendTo(overlay);sidebar=$('.gb-sidebar',container);sb_screen=$('.gb-screen',sidebar).show();sb_content=$('.gb-content',sb_screen);screens=$('.gb-screens',container);screen=$('.gb-screen',screens).show();header=$('.header',screen);hd_browse=new GalleryBox.HeaderBrowse($('.header_browse',header));hd_create=new GalleryBox.HeaderCreate($('.header_create',header));gl_pane=$('.panel',screen);gl_list=new GalleryBox.List(image_id,$('.pane',gl_pane));but_close=$('button[data-action="close"]',screen);figure=$('<figure />').appendTo(sb_content);figure_img=$('<img width="238" height="250">').attr('src',VectorStock.imagePath(image_id,'medium')).attr('alt',image_title).appendTo(figure);figure_inner=$('<span class="inner" />').appendTo(figure);$('<h1 />').text(image_title).appendTo(sb_content);if(image_artist){$('<h2 />').text('by '+image_artist).appendTo(sb_content);}
hd_browse.on('change_header',changeHeader);hd_create.on('change_header',changeHeader).on('create_gallery',createGallery);gl_list.on('new_gallery',changeHeaderCreate).on('update',onListUpdate);but_close.on('click',INSTANCE.close);hd_browse.show();gl_list.show();setTimeout(function(){container.addClass('reveal');});(new Image()).src=VectorStock.imagePath(image_id,'small');}
function populate(galleries){hd_browse.on('filter',filterGalleries);hd_browse.setTotal(galleries.length);gl_list.populate(galleries);var search=hd_browse.getSearch();if(search)filterGalleries(search);}
function onClickOverlay(event){if($(event.target)[0]==overlay[0]){INSTANCE.close();}}
function onListUpdate(num_matches){hd_browse.setTotal(num_matches);}
function filterGalleries(search){gl_list.filter(search);}
function changeHeader(type,search_input){if(type==GalleryBox.HeaderCreate){hd_browse.hide();if(search_input)hd_create.setName(search_input);hd_create.show();gl_list.hide();}else if(type==GalleryBox.HeaderBrowse){hd_browse.show();hd_create.hide();gl_list.show();}}
function changeHeaderCreate(gallery_name){if(gallery_name)hd_create.setName(gallery_name);changeHeader(GalleryBox.HeaderCreate);}
function createGallery(gallery_name,gallery_private){gl_list.createGallery(gallery_name,gallery_private);changeHeader(GalleryBox.HeaderBrowse);}
INSTANCE.close=function(){if(container)container.remove();overlay.remove();$('body').removeClass('pagelock');INSTANCE.dispatchEvent('close');};init();return INSTANCE;};GalleryBox.template='<div id="box-gallery" class="overlay-box"><div class="gb-sidebar"><div class="gb-screen" data-screen="image"><div class="gb-content"></div><div class="gb-background"></div></div></div><div class="gb-screens"><div class="gb-screen" data-screen="list"><div class="header"><div class="header_browse"><h1><span class="short">Galleries</span><span class="long">Add to Gallery</span> <data>(0)</data></h1><div class="fieldgroup"><fieldset data-field="filter"><span class="icon"></span><input type="text" name="gallery_search" placeholder="Search gallery names…" autocomplete="off" tabindex="1"></fieldset><button type="button" data-action="create" tabindex="2"><span class="icon"></span><span class="label">New</span></button></div></div><div class="header_create"><h1>New Gallery</h1><div class="fieldgroup"><fieldset data-field="gallery_name"><input type="text" name="gallery_name" placeholder="Enter name…" autocomplete="off" tabindex="1"></fieldset><label for="gallery_new_private" class="checked"><span class="checkbox"><input type="checkbox" id="gallery_new_private" name="gallery_new_private" checked="checked"></span><span class="title">Private</span></label></div><button type="button" data-action="cancel" tabindex="2"><span class="label">Cancel</span></button><button type="button" data-action="create" tabindex="3"><span class="label">Create</span></button></div></div><div class="panel"><div class="pane"><div class="state"></div><ul></ul></div></div><button data-action="close" type="button">Close</button></div></div></div>';GalleryBox.galleries=null;GalleryBox.HeaderBrowse=function(container){var INSTANCE=new VSModule();var header,header_tally,input_search,but_create;function init(){header=container.parent();header_tally=$('h1 data',container);input_search=new VectorStock.FieldInput($('input[name="gallery_search"]',container),VectorStock.FieldInput.FORMAT_ALPHANUMERIC);but_create=new VectorStock.FieldButton($('button[data-action="create"]',container));input_search.on('update',filterGalleries);but_create.on('click',createNewGallery);}
function filterGalleries(){var value=$.trim(input_search.value);INSTANCE.dispatchEvent('filter',[value]);}
function createNewGallery(){INSTANCE.dispatchEvent('change_header',[GalleryBox.HeaderCreate,input_search.value]);}
INSTANCE.show=function(){container.show();header.css({height:container.outerHeight()});setTimeout(function(){container.addClass('reveal');input_search.focus();});return INSTANCE;};INSTANCE.hide=function(){container.hide().removeClass('reveal');input_search.setValue();return INSTANCE;};INSTANCE.setTotal=function(total){header_tally.show().text('('+total+')');return INSTANCE;};INSTANCE.getSearch=function(){return $.trim(input_search.value);};init();return INSTANCE;};GalleryBox.HeaderCreate=function(container){var INSTANCE=new VSModule();var header,input_name,cbox_private,but_cancel,but_create;function init(){header=container.parent();input_name=new VectorStock.FieldInput($('input[name="gallery_name"]',container),VectorStock.FieldInput.FORMAT_ALPHANUMERIC);cbox_private=new VectorStock.FieldCheckbox($('input[name="gallery_new_private"]',container));but_cancel=new VectorStock.FieldButton($('button[data-action="cancel"]',container));but_create=new VectorStock.FieldButton($('button[data-action="create"]',container));input_name.on('update',onNameUpdate).on('return',onNewGallery);but_cancel.on('click',onCancel);but_create.on('click',onNewGallery);}
function onNameUpdate(value){if(value){but_create.enable();}else{but_create.disable();}}
function onCancel(){INSTANCE.dispatchEvent('change_header',[GalleryBox.HeaderBrowse]);}
function onNewGallery(){var gallery_name=$.trim(input_name.value);if(gallery_name){input_name.setValue('',true);INSTANCE.dispatchEvent('create_gallery',[gallery_name,cbox_private.checked]);}else{but_create.disable();input_name.focus();}}
INSTANCE.show=function(){container.show();header.css({height:container.outerHeight()});setTimeout(function(){container.addClass('reveal');input_name.focus();});return INSTANCE;};INSTANCE.hide=function(){container.hide().removeClass('reveal');return INSTANCE;};INSTANCE.setName=function(gallery_name){input_name.setValue(gallery_name);};init();return INSTANCE;};GalleryBox.List=function(image_id,container){var INSTANCE=new VSModule();var TERM_MAX_LENGTH=20;var state,list;var temp_id=1000000000,filter_term='',gallery_items=[];function init(){var state_load,load_icon,load_title,state_empty,empty_title,state_none,none_title;state=$('.state',container).attr('data-state','load');state_load=$('<div class="state_load" />').appendTo(state);load_icon=state_load.loadingIcon('small');load_title=$('<p>Loading galleries…</p>').appendTo(state_load);state_empty=$('<div class="state_empty" />').appendTo(state);empty_title=$('<p>No galleries exist yet</p>').appendTo(state_empty);state_none=$('<div class="state_none" />').appendTo(state);none_title=$('<p>No matches</p>').appendTo(state_none);list=$('ul',container);}
function createGalleryItem(gallery_id,gallery_name,gallery_private,gallery_contents,gallery_checked){var item=new GalleryBox.ListItem(gallery_id,gallery_name,gallery_private,gallery_contents,gallery_checked),item_element=item.getElement();item.on('check',function(){item.addImage(image_id);addToGallery(gallery_id);INSTANCE.dispatchEvent('image_added',[gallery_id]);}).on('uncheck',function(){item.removeImage(image_id);removeFromGallery(gallery_id);INSTANCE.dispatchEvent('image_removed',[gallery_id]);});return item;}
function addToGallery(gallery_id){$.put('/api/galleries/'+gallery_id+'/'+image_id,'json');VectorStock.userData.addToGallery(image_id,gallery_id);}
function removeFromGallery(gallery_id){$.delete('/api/galleries/'+gallery_id+'/'+image_id,'json');VectorStock.userData.removeFromGallery(image_id,gallery_id);}
function toggleScrolling(){var is_scrolling=(list.outerHeight()>container.outerHeight());container.toggleClass('scrolling',is_scrolling);}
INSTANCE.populate=function(galleries){for(var i=0,len=galleries.length;i<len;i++){var is_checked=(galleries[i].contents.indexOf(image_id)>=0);var item=createGalleryItem(galleries[i].id,galleries[i].name,galleries[i].private,galleries[i].contents,is_checked);item.getElement().appendTo(list);gallery_items.push(item);}
state.attr('data-state',(len==0?'empty':''));toggleScrolling();container.removeClass('reveal');INSTANCE.show();};INSTANCE.filter=function(term){filter_term=term;var i=gallery_items.length,count=0;while(i--){count+=gallery_items[i].match(term);}
state.attr('data-state',(count==0?'none':''));toggleScrolling();INSTANCE.dispatchEvent('update',[count]);};INSTANCE.createGallery=function(gallery_name,gallery_private){var gallery_id=temp_id++,gallery_private=Number(gallery_private),gallery_contents=[image_id],gallery_entry={id:gallery_id,private:gallery_private,name:gallery_name,contents:gallery_contents};var item=createGalleryItem(gallery_id,gallery_name,gallery_private,gallery_contents,true),item_element=item.getElement().addClass('faded');GalleryBox.galleries.unshift(gallery_entry);item_element.prependTo(list);gallery_items.unshift(item);toggleScrolling();setTimeout(function(){container.scrollTop(item_element[0].offsetTop);item_element.removeClass('faded');});$.post('/api/galleries',{name:gallery_name,private:gallery_private,images:gallery_contents},'json').done(function(response){if(response.success){gallery_entry.id=response.id;item.updateId(response.id);VectorStock.setTally('galleries',response.galleries);VectorStock.userData.createGallery(response.id,gallery_name);VectorStock.userData.addToGallery(image_id,response.id);}});INSTANCE.dispatchEvent('update',[GalleryBox.galleries.length]);};INSTANCE.show=function(){container.show();setTimeout(function(){container.addClass('reveal');});return INSTANCE;};INSTANCE.hide=function(){container.hide().removeClass('reveal');return INSTANCE;};init();return INSTANCE;};GalleryBox.ListItem=function(gallery_id,gallery_name,gallery_private,gallery_contents,gallery_checked){var INSTANCE=new VSModule();var item,label,cbox_wrap,cbox_input,cbox_field,item_title,item_subtitle,item_images,item_imageset;INSTANCE.id=gallery_id;INSTANCE.name=gallery_name;INSTANCE.private=gallery_private;INSTANCE.contents=gallery_contents;INSTANCE.checked=gallery_checked;function init(){item=$('<li data-status="'+(INSTANCE.private?'private':'')+'" />');label=$('<label for="in_gallery_'+INSTANCE.id+'">').appendTo(item);cbox_wrap=$('<span class="checkbox" />').appendTo(label);cbox_input=$('<input type="checkbox" id="in_gallery_'+INSTANCE.id+'">').appendTo(cbox_wrap);cbox_field=new VectorStock.FieldCheckbox(cbox_input);item_title=$('<span class="title" />').appendTo(label);item_subtitle=$('<span class="subtitle" />').appendTo(label);item_images=new GalleryBox.ListItemImages(label,INSTANCE.contents);updateTitle(INSTANCE.name);updateSubtitle();cbox_field.toggle(INSTANCE.checked);cbox_field.on('change',onChecked);}
function updateTitle(title){item_title.html(title);}
function updateSubtitle(){item_subtitle.html(INSTANCE.contents.length+' Image'+(INSTANCE.contents==1?'':'s'));}
function onChecked(checked){var event_type=(checked?'check':'uncheck');INSTANCE.dispatchEvent(event_type,[INSTANCE.id]);}
INSTANCE.getElement=function(){return item;};INSTANCE.updateId=function(gallery_id){INSTANCE.id=gallery_id;label.attr('for','in_gallery_'+INSTANCE.id);cbox_input.attr('id','in_gallery_'+INSTANCE.id);};INSTANCE.match=function(term){if(!term){updateTitle(INSTANCE.name);}
else{var regex=new RegExp('('+term+')','gi')
if(INSTANCE.name.search(regex)<0){item.hide();return false;}
else{var name=INSTANCE.name.replace(regex,"<em>$1</em>");updateTitle(name);}}
item.show();return true;};INSTANCE.addImage=function(image_id){item_images.addImage(image_id);updateSubtitle();};INSTANCE.removeImage=function(image_id){item_images.removeImage(image_id);updateSubtitle();};init();return INSTANCE;};GalleryBox.ListItemImages=function(scope,images){var INSTANCE=new VSModule();var MAX_IMAGES=4;var container,imageset;var image_lookup={};function init(){container=$('<span class="images" />').appendTo(scope);imageset=$('<span class="set" />').appendTo(container);var range=(images.length<MAX_IMAGES?images.length:MAX_IMAGES),group=images.slice(images.length-range);var i=range;while(i--){var index=range-i-1;createImage(group[i],index,true);}}
function addImage(image_id,image_index,is_instant){var figure=createImage(image_id,image_index,is_instant);if(!is_instant){figure.addClass('conceal');setTimeout(function(){$('figure',imageset).each(function(index){$(this).attr('data-index',index);});figure.removeClass('conceal');},10);}}
function createImage(image_id,image_index){var image_index=(image_index||0);var src='url('+VectorStock.imagePath(image_id,'small')+')';var figure=$('<figure data-index="'+image_index+'" data-image="'+image_id+'" />'),image=$('<span />').css({backgroundImage:src}).appendTo(figure);var num_images=imageset.children().length;if(image_index==undefined||num_images==0||image_index>=num_images){figure.appendTo(imageset);}else{imageset.children().eq(image_index).before(figure);}
image_lookup[image_id]=figure;return figure;}
function removeImage(image_id){var figure=image_lookup[image_id];if(figure){figure.addClass('conceal');delete image_lookup[image_id];setTimeout(function(){$('figure',imageset).not('.conceal').each(function(index){$(this).attr('data-index',index);});});setTimeout(function(){figure.remove();},550);}}
INSTANCE.addImage=function(image_id){images.push(image_id);addImage(image_id);};INSTANCE.removeImage=function(image_id){var index=images.indexOf(image_id);if(index<0)return;else images.splice(index,1);removeImage(image_id);};init();return INSTANCE;};;(function(){var $,cardFromNumber,cardFromType,cards,defaultFormat,formatBackCardNumber,formatBackExpiry,formatCardNumber,formatExpiry,formatForwardExpiry,formatForwardSlashAndSpace,hasTextSelected,luhnCheck,reFormatCVC,reFormatCardNumber,reFormatExpiry,reFormatNumeric,replaceFullWidthChars,restrictCVC,restrictCardNumber,restrictExpiry,restrictNumeric,safeVal,setCardType,__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i;}return-1;};$=window.jQuery||window.Zepto||window.$;$.payment={};$.payment.fn={};$.fn.payment=function(){var args,method;method=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];return $.payment.fn[method].apply(this,args);};defaultFormat=/(\d{1,4})/g;$.payment.cards=cards=[{type:'visaelectron',pattern:/^4(026|17500|405|508|844|91[37])/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'maestro',pattern:/^(5(018|0[23]|[68])|6(39|7))/,format:defaultFormat,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:true},{type:'forbrugsforeningen',pattern:/^600/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'dankort',pattern:/^5019/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'visa',pattern:/^4/,format:defaultFormat,length:[13,16],cvcLength:[3],luhn:true},{type:'mastercard',pattern:/^(5[1-5]|2[2-7])/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'amex',pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:true},{type:'dinersclub',pattern:/^3[0689]/,format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:true},{type:'discover',pattern:/^6([045]|22)/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true},{type:'unionpay',pattern:/^(62|88)/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:false},{type:'jcb',pattern:/^35/,format:defaultFormat,length:[16],cvcLength:[3],luhn:true}];cardFromNumber=function(num){var card,_i,_len;num=(num+'').replace(/\D/g,'');for(_i=0,_len=cards.length;_i<_len;_i++){card=cards[_i];if(card.pattern.test(num)){return card;}}};cardFromType=function(type){var card,_i,_len;for(_i=0,_len=cards.length;_i<_len;_i++){card=cards[_i];if(card.type===type){return card;}}};luhnCheck=function(num){var digit,digits,odd,sum,_i,_len;odd=true;sum=0;digits=(num+'').split('').reverse();for(_i=0,_len=digits.length;_i<_len;_i++){digit=digits[_i];digit=parseInt(digit,10);if((odd=!odd)){digit*=2;}
if(digit>9){digit-=9;}
sum+=digit;}
return sum%10===0;};hasTextSelected=function($target){var _ref;if(($target.prop('selectionStart')!=null)&&$target.prop('selectionStart')!==$target.prop('selectionEnd')){return true;}
if((typeof document!=="undefined"&&document!==null?(_ref=document.selection)!=null?_ref.createRange:void 0:void 0)!=null){if(document.selection.createRange().text){return true;}}
return false;};safeVal=function(value,$target){var cursor,error,last;try{cursor=$target.prop('selectionStart');}catch(_error){error=_error;cursor=null;}
last=$target.val();$target.val(value);if(cursor!==null&&$target.is(":focus")){if(cursor===last.length){cursor=value.length;}
$target.prop('selectionStart',cursor);return $target.prop('selectionEnd',cursor);}};replaceFullWidthChars=function(str){var char,chars,fullWidth,halfWidth,idx,value,_i,_len;if(str==null){str='';}
fullWidth='\uff10\uff11\uff12\uff13\uff14\uff15\uff16\uff17\uff18\uff19';halfWidth='0123456789';value='';chars=str.split('');for(_i=0,_len=chars.length;_i<_len;_i++){char=chars[_i];idx=fullWidth.indexOf(char);if(idx>-1){char=halfWidth[idx];}
value+=char;}
return value;};reFormatNumeric=function(e){return setTimeout(function(){var $target,value;$target=$(e.currentTarget);value=$target.val();value=replaceFullWidthChars(value);value=value.replace(/\D/g,'');return safeVal(value,$target);});};reFormatCardNumber=function(e){return setTimeout(function(){var $target,value;$target=$(e.currentTarget);value=$target.val();value=replaceFullWidthChars(value);value=$.payment.formatCardNumber(value);return safeVal(value,$target);});};formatCardNumber=function(e){var $target,card,digit,length,re,upperLength,value;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
$target=$(e.currentTarget);value=$target.val();card=cardFromNumber(value+digit);length=(value.replace(/\D/g,'')+digit).length;upperLength=16;if(card){upperLength=card.length[card.length.length-1];}
if(length>=upperLength){return;}
if(($target.prop('selectionStart')!=null)&&$target.prop('selectionStart')!==value.length){return;}
if(card&&card.type==='amex'){re=/^(\d{4}|\d{4}\s\d{6})$/;}else{re=/(?:^|\s)(\d{4})$/;}
if(re.test(value)){e.preventDefault();return setTimeout(function(){return $target.val(value+' '+digit);});}else if(re.test(value+digit)){e.preventDefault();return setTimeout(function(){return $target.val(value+digit+' ');});}};formatBackCardNumber=function(e){var $target,value;$target=$(e.currentTarget);value=$target.val();if(e.which!==8){return;}
if(($target.prop('selectionStart')!=null)&&$target.prop('selectionStart')!==value.length){return;}
if(/\d\s$/.test(value)){e.preventDefault();return setTimeout(function(){return $target.val(value.replace(/\d\s$/,''));});}else if(/\s\d?$/.test(value)){e.preventDefault();return setTimeout(function(){return $target.val(value.replace(/\d$/,''));});}};reFormatExpiry=function(e){return setTimeout(function(){var $target,value;$target=$(e.currentTarget);value=$target.val();value=replaceFullWidthChars(value);value=$.payment.formatExpiry(value);return safeVal(value,$target);});};formatExpiry=function(e){var $target,digit,val;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
$target=$(e.currentTarget);val=$target.val()+digit;if(/^\d$/.test(val)&&(val!=='0'&&val!=='1')){e.preventDefault();return setTimeout(function(){return $target.val("0"+val+" / ");});}else if(/^\d\d$/.test(val)){e.preventDefault();return setTimeout(function(){return $target.val(""+val+" / ");});}};formatForwardExpiry=function(e){var $target,digit,val;digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
$target=$(e.currentTarget);val=$target.val();if(/^\d\d$/.test(val)){return $target.val(""+val+" / ");}};formatForwardSlashAndSpace=function(e){var $target,val,which;which=String.fromCharCode(e.which);if(!(which==='/'||which===' ')){return;}
$target=$(e.currentTarget);val=$target.val();if(/^\d$/.test(val)&&val!=='0'){return $target.val("0"+val+" / ");}};formatBackExpiry=function(e){var $target,value;$target=$(e.currentTarget);value=$target.val();if(e.which!==8){return;}
if(($target.prop('selectionStart')!=null)&&$target.prop('selectionStart')!==value.length){return;}
if(/\d\s\/\s$/.test(value)){e.preventDefault();return setTimeout(function(){return $target.val(value.replace(/\d\s\/\s$/,''));});}};reFormatCVC=function(e){return setTimeout(function(){var $target,value;$target=$(e.currentTarget);value=$target.val();value=replaceFullWidthChars(value);value=value.replace(/\D/g,'').slice(0,4);return safeVal(value,$target);});};restrictNumeric=function(e){var input;if(e.metaKey||e.ctrlKey){return true;}
if(e.which===32){return false;}
if(e.which===0){return true;}
if(e.which<33){return true;}
input=String.fromCharCode(e.which);return!!/[\d\s]/.test(input);};restrictCardNumber=function(e){var $target,card,digit,value;$target=$(e.currentTarget);digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
if(hasTextSelected($target)){return;}
value=($target.val()+digit).replace(/\D/g,'');card=cardFromNumber(value);if(card){return value.length<=card.length[card.length.length-1];}else{return value.length<=16;}};restrictExpiry=function(e){var $target,digit,value;$target=$(e.currentTarget);digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
if(hasTextSelected($target)){return;}
value=$target.val()+digit;value=value.replace(/\D/g,'');if(value.length>6){return false;}};restrictCVC=function(e){var $target,digit,val;$target=$(e.currentTarget);digit=String.fromCharCode(e.which);if(!/^\d+$/.test(digit)){return;}
if(hasTextSelected($target)){return;}
val=$target.val()+digit;return val.length<=4;};setCardType=function(e){var $target,allTypes,card,cardType,val;$target=$(e.currentTarget);val=$target.val();cardType=$.payment.cardType(val)||'unknown';if(!$target.hasClass(cardType)){allTypes=(function(){var _i,_len,_results;_results=[];for(_i=0,_len=cards.length;_i<_len;_i++){card=cards[_i];_results.push(card.type);}
return _results;})();$target.removeClass('unknown');$target.removeClass(allTypes.join(' '));$target.addClass(cardType);$target.toggleClass('identified',cardType!=='unknown');return $target.trigger('payment.cardType',cardType);}};$.payment.fn.formatCardCVC=function(){this.on('keypress',restrictNumeric);this.on('keypress',restrictCVC);this.on('paste',reFormatCVC);this.on('change',reFormatCVC);this.on('input',reFormatCVC);return this;};$.payment.fn.formatCardExpiry=function(){this.on('keypress',restrictNumeric);this.on('keypress',restrictExpiry);this.on('keypress',formatExpiry);this.on('keypress',formatForwardSlashAndSpace);this.on('keypress',formatForwardExpiry);this.on('keydown',formatBackExpiry);this.on('change',reFormatExpiry);this.on('input',reFormatExpiry);return this;};$.payment.fn.formatCardNumber=function(){this.on('keypress',restrictNumeric);this.on('keypress',restrictCardNumber);this.on('keypress',formatCardNumber);this.on('keydown',formatBackCardNumber);this.on('keyup',setCardType);this.on('paste',reFormatCardNumber);this.on('change',reFormatCardNumber);this.on('input',reFormatCardNumber);this.on('input',setCardType);return this;};$.payment.fn.restrictNumeric=function(){this.on('keypress',restrictNumeric);this.on('paste',reFormatNumeric);this.on('change',reFormatNumeric);this.on('input',reFormatNumeric);return this;};$.payment.fn.cardExpiryVal=function(){return $.payment.cardExpiryVal($(this).val());};$.payment.cardExpiryVal=function(value){var month,prefix,year,_ref;_ref=value.split(/[\s\/]+/,2),month=_ref[0],year=_ref[1];if((year!=null?year.length:void 0)===2&&/^\d+$/.test(year)){prefix=(new Date).getFullYear();prefix=prefix.toString().slice(0,2);year=prefix+year;}
month=parseInt(month,10);year=parseInt(year,10);return{month:month,year:year};};$.payment.validateCardNumber=function(num){var card,_ref;num=(num+'').replace(/\s+|-/g,'');if(!/^\d+$/.test(num)){return false;}
card=cardFromNumber(num);if(!card){return false;}
return(_ref=num.length,__indexOf.call(card.length,_ref)>=0)&&(card.luhn===false||luhnCheck(num));};$.payment.validateCardExpiry=function(month,year){var currentTime,expiry,_ref;if(typeof month==='object'&&'month'in month){_ref=month,month=_ref.month,year=_ref.year;}
if(!(month&&year)){return false;}
month=$.trim(month);year=$.trim(year);if(!/^\d+$/.test(month)){return false;}
if(!/^\d+$/.test(year)){return false;}
if(!((1<=month&&month<=12))){return false;}
if(year.length===2){if(year<70){year="20"+year;}else{year="19"+year;}}
if(year.length!==4){return false;}
expiry=new Date(year,month);currentTime=new Date;expiry.setMonth(expiry.getMonth()-1);expiry.setMonth(expiry.getMonth()+1,1);return expiry>currentTime;};$.payment.validateCardCVC=function(cvc,type){var card,_ref;cvc=$.trim(cvc);if(!/^\d+$/.test(cvc)){return false;}
card=cardFromType(type);if(card!=null){return _ref=cvc.length,__indexOf.call(card.cvcLength,_ref)>=0;}else{return cvc.length>=3&&cvc.length<=4;}};$.payment.cardType=function(num){var _ref;if(!num){return null;}
return((_ref=cardFromNumber(num))!=null?_ref.type:void 0)||null;};$.payment.formatCardNumber=function(num){var card,groups,upperLength,_ref;num=num.replace(/\D/g,'');card=cardFromNumber(num);if(!card){return num;}
upperLength=card.length[card.length.length-1];num=num.slice(0,upperLength);if(card.format.global){return(_ref=num.match(card.format))!=null?_ref.join(' '):void 0;}else{groups=card.format.exec(num);if(groups==null){return;}
groups.shift();groups=$.grep(groups,function(n){return n;});return groups.join(' ');}};$.payment.formatExpiry=function(expiry){var mon,parts,sep,year;parts=expiry.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/);if(!parts){return'';}
mon=parts[1]||'';sep=parts[2]||'';year=parts[3]||'';if(year.length>0){sep=' / ';}else if(sep===' /'){mon=mon.substring(0,1);sep='';}else if(mon.length===2||sep.length>0){sep=' / ';}else if(mon.length===1&&(mon!=='0'&&mon!=='1')){mon="0"+mon;sep=' / ';}
return mon+sep+year;};}).call(this);var PaymentScreenPay=function(screen,image){var INSTANCE=new VSModule();var CARD_FORMATS={_default:/(.{1,4})/g,amex:/(.{1,4})(.{1,6})?(.{1,5})?/,dinersclub:/(.{1,4})(.{1,6})?(.{1,4})?/};var CARD_ICONS=['amex','dinersclub','discover','jcb','mastercard','visa'];var REGEX_EMAIL=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;var RESPONSE_CARD_ATTEMPTS='Card declined after too many failed attempts',RESPONSE_CARD_DECLINED='Card declined',RESPONSE_SAVED_CARD_BAD='Stored card invalid, please use another card',RESPONSE_EMAIL_INVALID='Enter a valid email',RESPONSE_NUMBER_INVALID='Invalid card number',RESPONSE_NUMBER_DECLINED='Card declined',RESPONSE_EXPIRY_INVALID='Invalid expiry date',RESPONSE_EXPIRY_EXPIRED='Card has expired',RESPONSE_CVV_INVALID='Invalid CVV number';var page,area_select,area_new,radioboxes_payment,input_email,input_card_number,icon_card,input_card_expiry,input_card_cvv,cbox_remember,but_submit,but_submit_label,but_submit_icon;var logged_in,user_id,payment,bt_token,bt_client;function init(){var but_close;$('.header h1 em',screen).text(image.cost);page=$('#pbox_details_card',screen);area_select=$('#pbox_payment_card_select',screen);area_new=$('#pbox_payment_card_new',screen);but_close=$('button[data-action="close"]',screen);function isLoaded(){if(bt_token&&window.braintree)setup();}
but_close.on('click',close);var icon=screen.parent().loadingIcon('large');$.get('/api/purchases/setup').done(function(response){logged_in=response.logged_in;user_id=(response.user_id||null)
payment=(response.payment||null);bt_token=response.bt_token;page.attr('data-account',(logged_in==1?'member':'guest'));page.attr('data-payment',(payment?'saved':'new'));if(response.payment)addSavedCard(payment.card,payment.expiry);}).fail(function(event){page.attr('data-account','guest');}).always(function(event){icon.remove();isLoaded();});head.load('https://js.braintreegateway.com/v2/braintree.js',isLoaded);}
function addSavedCard(card_number,card_expiry){var card_type=$.payment.cardType(card_number),card_format=(CARD_FORMATS[card_type]?CARD_FORMATS[card_type]:CARD_FORMATS._default);if(CARD_FORMATS[card_type]){var match=card_number.match(CARD_FORMATS[card_type]);if(match.length){match.shift();card_number=match.join(' ');}}else{var match=card_number.match(CARD_FORMATS._default);if(match.length){card_number=match.join(' ');}}
card_number=card_number.replace(/(\.+[\.\s]+\.+)/,"<em>$1</em>");card_number=card_number.replace(/\./g,'•');var item=$('<li class="checked" />'),label=$('<label for="pbox_payment_saved" />').appendTo(item),input=$('<input type="radio" id="pbox_payment_saved" name="pbox_payment" value="saved" checked="checked">').appendTo(label),title=$('<span class="title">Card: '+card_number+' <span class="expiry">Exp. '+card_expiry+'</span></span>').appendTo(label);item.prependTo($('ul.radiobuttons',area_select));}
function setup(){var input_number,input_expiry,input_cvv,but_close;radioboxes_payment=new VectorStock.FieldRadioboxes($('ul.radiobuttons li',area_select));input_email=new VectorStock.FieldInput($('input[name="email"]',area_new));input_number=$('input[name="card_number"]',area_new).payment('formatCardNumber');input_card_number=new VectorStock.FieldInput(input_number);icon_card=$('fieldset[data-field="card_number"] .card',area_new);input_expiry=$('input[name="card_expiry"]',area_new).payment('formatCardExpiry');input_card_expiry=new VectorStock.FieldInput(input_expiry);input_cvv=$('input[name="card_cvv"]',area_new).payment('formatCardCVC');input_card_cvv=new VectorStock.FieldInput(input_cvv);cbox_remember=new VectorStock.FieldCheckbox($('input[name="remember_card"]',area_new));but_submit=$('.footer button[type="submit"]',screen);but_submit_label=$('.label',but_submit);but_close=$('button[data-action="close"]',screen);if(window.braintree&&bt_token){bt_client=new window.braintree.api.Client({clientToken:bt_token});}
radioboxes_payment.on('change',onPaymentSelect);input_card_number.on('update',onNumberUpdate);but_submit.on('click',onSubmit);but_close.on('click',function(){INSTANCE.dispatchEvent('close');});screen.show();setTimeout(function(){if(!logged_in){input_email.focus();}else if(!payment){input_card_number.focus();}},200);}
function onPaymentSelect(type){page.attr('data-payment',type);if(type==PaymentScreenPay.CARD_ADDITIONAL){input_card_number.focus();}}
function onNumberUpdate(number){function showCardIcon(type){icon_card.attr('class','card reveal '+type);}
function hideCardIcon(){icon_card.removeClass('reveal');setTimeout(function(){icon_card.attr('class','card');},200);}
var type=$.payment.cardType(number);if(type){if(CARD_ICONS.indexOf(type)>=0)showCardIcon(type);else hideCardIcon();}else{if(icon_card.hasClass('reveal'))hideCardIcon();}}
function onSubmit(event){input_email.clearError();input_card_number.clearError();input_card_expiry.clearError();input_card_cvv.clearError();var payment_type=(radioboxes_payment.value||null),errors=false;if(payment_type!==PaymentScreenPay.CARD_SAVED){if(!logged_in){if(!input_email.value.match(REGEX_EMAIL)){input_email.showError(RESPONSE_EMAIL_INVALID);errors=true;}}
var card={number:input_card_number.value,expiry:$.payment.cardExpiryVal(input_card_expiry.value),cvv:input_card_cvv.value};var valid_number=$.payment.validateCardNumber(card.number);if(!valid_number){input_card_number.showError(RESPONSE_NUMBER_INVALID);VectorStock.track('send','event','Error (User)','Purchase (Single Image)','Client: Card number invalid',image.cost);errors=true;}
var valid_expiry=$.payment.validateCardExpiry(card.expiry.month,card.expiry.year);if(!valid_expiry){input_card_expiry.showError(RESPONSE_EXPIRY_INVALID);VectorStock.track('send','event','Error (User)','Purchase (Single Image)','Client: Card expiry invalid',image.cost);errors=true;}
var valid_cvv=$.payment.validateCardCVC(card.cvv);if(!valid_cvv){input_card_cvv.showError(RESPONSE_CVV_INVALID);VectorStock.track('send','event','Error (User)','Purchase (Single Image)','Client: Card CVV invalid',image.cost);errors=true;}}
if(!errors){radioboxes_payment.disable();input_email.disable();input_card_number.disable();input_card_expiry.disable();input_card_cvv.disable();cbox_remember.disable();but_submit.prop('disabled',true);but_submit_label.text('Processing…');but_submit_icon=$('.icon',but_submit).loadingIcon();if(radioboxes_payment.value==PaymentScreenPay.CARD_SAVED){submitToServer();}
else{bt_client.tokenizeCard({number:card.number,expirationMonth:card.expiry.month,expirationYear:card.expiry.year,cvv:card.cvv},function(err,nonce){if(err){VectorStock.track('send','event','Error (User)','Purchase (Single Image)','Braintree: Nonce could not be created');}else{submitToServer(nonce,card,input_email.value);}});}}
event.preventDefault();}
function submitToServer(nonce,card,email_address){var url='/api/creditcard/singleimage/'+image.id+'/'+image.license;var params={email:(email_address||null),nonce:(nonce||null),card:null,set_token:(logged_in?Number(cbox_remember.checked==true):0),use_token:(nonce?0:1)};$.post(url,params).done(function(response){if(response.success==1){onPurchaseSuccess(response);}
else{if(response.attempts==0){showPurchaseError('attempts');}
else if(params.use_token){area_select.remove();page.attr('data-payment',PaymentScreenPay.CARD_ADDITIONAL);showPurchaseError('stored_card');input_card_number.focus();}
else if(response.error=='processor'){submitToDPS(response.id,card);}
else{showPurchaseError(response.error);}}}).fail(function(event){showPurchaseError();});}
function submitToDPS(transaction_id,card){var params={id:transaction_id,card_number:card.number,card_month:card.expiry.month,card_year:card.expiry.year,card_cvv:card.cvv};$.post('/api/single-image/reprocess',params,function(response){if(response.success==1){onPurchaseSuccess(response);}
else{showPurchaseError(response.error);}
var outcome=(response.success?'Success':'Failure'),usertype=(user_id?'User #'+user_id:'Guest');VectorStock.track('send','event','Card Reprocess',outcome,'Type: Single-Image, Image: '+image.id+', '+usertype,INSTANCE.value);});}
function showPurchaseError(error_type){switch(error_type){case'attempts':input_card_number.showError(RESPONSE_CARD_ATTEMPTS);break;case'cvv':input_card_cvv.showError(RESPONSE_CVV_INVALID);break;case'email':input_email.showError(RESPONSE_EMAIL_INVALID);break;case'expiry':case'expire_month':case'expire_year':input_card_expiry.showError(RESPONSE_EXPIRY_INVALID);break;case'expired':input_card_expiry.showError(RESPONSE_EXPIRY_EXPIRED);break;case'invalid':case'number':input_card_number.showError(RESPONSE_NUMBER_INVALID);break;case'stored_card':input_card_number.showError(RESPONSE_SAVED_CARD_BAD);break;case'card_attempts':case'process_attempts':input_card_number.showError(RESPONSE_CARD_DECLINED);break;default:input_card_number.showError(RESPONSE_NUMBER_DECLINED);break;}
VectorStock.track('send','event','Error (User)','Purchase (Single Image)','Server: Unique Error ('+error_type+'), '+(user_id?'User #'+user_id:'Guest'),image.cost);enableForm();}
function onPurchaseSuccess(response){VectorStock.trackPurchase(response.transaction.type,response.transaction.id,response.transaction.value,response.transaction.email,response.transaction.country,response.transaction.provider,response.transaction.txn_id);VectorStock.trackConversion({google_conversion_label:'IxeuCM-1m28QiJXH9wM',google_conversion_value:parseInt(response.transaction.value),google_conversion_currency:'USD'});INSTANCE.dispatchEvent('purchase',[response.url,image.license]);}
function enableForm(){radioboxes_payment.enable();input_email.enable();input_card_number.enable();input_card_expiry.enable();input_card_cvv.enable();cbox_remember.enable();but_submit.prop('disabled',false);but_submit_label.text('Pay Now');but_submit_icon.remove();}
function close(){INSTANCE.dispatchEvent('close');}
init();return INSTANCE;};PaymentScreenPay.CARD_NEW='new';PaymentScreenPay.CARD_SAVED='saved';PaymentScreenPay.CARD_ADDITIONAL='additional';var PaymentBox=function(image){var INSTANCE=new VSModule();var overlay,screen;function init(){overlay=$('<div class="overlay" />').css({height:$(document).height()}).appendTo('body').on('click',onClickOverlay);setTimeout(function(){overlay.addClass('reveal');});build(PaymentBox.template);}
function build(html_template){var sidebar,pb_screen,pb_content,imageset,figure,figure_img,figure_inner;container=$(html_template).appendTo(overlay);sidebar=$('.pb-sidebar',container);pb_screen=$('.pb-screen',sidebar).show();pb_content=$('.pb-content',pb_screen);screens=$('.pb-screens',container);screen=new PaymentScreenPay($('.pb-screen',screens),image);imageset=$('.imageset',pb_content).attr('data-images',1);figure=$('<figure />').appendTo(imageset);figure_img=$('<img width="238" height="250">').attr('src',VectorStock.imagePath(image.id,'medium')).attr('alt',image.title).appendTo(figure);figure_inner=$('<span class="inner" />').appendTo(figure);$('h1',pb_content).text(image.title);$('ul li:eq(0) .dd',pb_content).text(image.license);$('ul li:eq(2) .dd em',pb_content).text(image.cost);screen.on('purchase',onPurchase);screen.on('close',INSTANCE.close);setTimeout(function(){container.addClass('reveal');});}
function onClickOverlay(event){if($(event.target)[0]==overlay[0]){INSTANCE.close();}}
function onPurchase(url_download,license){INSTANCE.close();INSTANCE.dispatchEvent('purchase',[url_download,license]);}
INSTANCE.close=function(){if(container)container.remove();overlay.remove();INSTANCE.dispatchEvent('close');};init();return INSTANCE;};PaymentBox.template='<div id="box-payment" class="overlay-box"><div class="pb-sidebar"><div class="pb-screen"><div class="pb-content"><div class="imageset" data-images="1"></div><h1></h1><ul><li><span class="dt">License</span><span class="dm"></span><span class="dd"></span></li><li><span class="dt">Files</span><span class="dm"></span><span class="dd"><abbr title="Encapsulated PostScript File">EPS</abbr>, <abbr title="Adobe Illustrator File">Ai</abbr>, <abbr title="Adobe Portable Document Format File">PDF</abbr> &amp; <abbr title="Joint Photographic Experts Group File">JPEG</abbr></span></li><li><span class="dt">Cost</span><span class="dm"></span><span class="dd"><small>$</small><em></em> <abbr title="United States Dollars">USD</abbr></span></li></ul></div><div class="pb-background"></div></div></div><div class="pb-screens"><div class="pb-screen" data-screen="list"><div class="header"><h1>Single Image Purchase - <small>$</small><em></em></h1></div><div class="panel"><div class="pane reveal"><div id="pbox_details_card" data-account="" data-payment=""><div id="pbox_payment_card_select"><h4>Payment</h2><ul class="radiobuttons"><li><label for="pbox_payment_new"><input type="radio" id="pbox_payment_new" name="pbox_payment" value="additional"><span class="title">New card…</span></label></li></ul></div><div id="pbox_payment_card_new"><form accept-charset="UTF-8" action="/purchase" method="post"><div class="fields"><div class="fieldgroup" data-id="email"><h4>Contact</h2><fieldset data-field="email"><span class="icon"></span><input type="email" name="email" maxlength="100" autocomplete="email" autocorrect="off" autocapitalize="off" placeholder="Email address"></fieldset></div><div class="fieldgroup" data-id="card"><h4>Card Details</h2><fieldset data-field="card_number"><span class="icon"></span><input type="tel" id="pbox_card_number" name="card_number" class="number" placeholder="Card Number" maxlength="19" autocomplete="cc-number"><span class="card"></span></fieldset></div><div class="fieldgroup" data-id="meta"><fieldset data-field="card_expiry"><span class="icon"></span><input type="tel" id="pbox_card_expiry" name="card_expiry" class="expiry" placeholder="MM / YY" maxlength="9" autocomplete="cc-exp"></fieldset><fieldset data-field="card_cvv"><span class="icon"></span><input type="tel" id="pbox_card_cvv" name="card_cvv" placeholder="CVV" maxlength="4" autocomplete="off"></fieldset><label for="pbox_remember_card" class="checkbox checked"><span class="box"><input type="checkbox" id="pbox_remember_card" name="remember_card" checked="checked" value="1"></span><span class="title">Remember</span></label></div></div></form></div></div></div></div><div class="footer"><button type="submit"><span class="label">Buy &amp; Download</span><span class="icon"><span></button></div><button data-action="close" type="button">Close</button></div></div></div>';;var SearchResultData=function(params){var TYPES={};TYPES[SearchResultData.TYPE_BROWSE]={title:'Find Royalty-Free Vectors',header:'Royalty Free Vectors',path:'royalty-free-vectors'};TYPES[SearchResultData.TYPE_FREE]={title:'Find Free Vectors',header:'Free Vector Art & Graphics',path:'free-vectors'};TYPES[SearchResultData.TYPE_PURCHASED]={title:'Purchased Vectors',header:'Purchased',path:'purchased'};TYPES['pending_manage']={title:'Manage Pending',header:'Pending',path:'manage-pending'};TYPES['pending_self']={title:'Pending',header:'Pending',path:'pending'};TYPES['pending_artist']={title:'Pending',header:'Pending',path:'manage-pending/vectors-by_'};var type=TYPES[params.type]||TYPES[SearchResultData.TYPE_BROWSE];if(params.type==SearchResultData.TYPE_PENDING){if(params.pending){if(params.pending==SearchResultData.TYPE_PENDING_SELF){type=TYPES['pending_self'];}else{type=TYPES['pending_artist'];type.path+=params.pending;}}else{type=TYPES['pending_manage'];}}
var path_url=[type.path],path_crumbs=[],title_window=type.title,title_header='',title_keywords=type.header;var keywords=params.keywords.slice(0),category=params.categories[0]||null,artist=params.artists[0]||null,similar=params.similar[0]||null,is_empty=!(keywords.length||category||artist||similar),page=params.page||1,order=params.order;if(!order){order=(keywords.length>0?SearchResults.ORDER_BESTMATCH:SearchResults.ORDER_TRENDING);}
if(keywords.length){var i=keywords.length;while(i--){var keyword_id=SearchBoxTag.termToURL(keywords[i]);keywords[i]=(SearchBox.dictionary.keywords[keyword_id]||keywords[i]);keywords[i]=String(keywords[i]).toTitleCase();}
if(keywords.length>2){var keywords_last=keywords.pop();title_keywords=keywords.join(', ')+' & '+keywords_last;keywords.push(keywords_last);}else{title_keywords=keywords.join(' & ');}
title_window=title_keywords+' Vector Art';path_url[1]=keywords.join('-').toLowerCase()+'-vectors';path_crumbs.push('<li><span>'+title_keywords+' vectors</span></li>');if(params.type==SearchResultData.TYPE_FREE){title_window='Free '+title_window;title_keywords='Free '+title_keywords;}
title_keywords+=' vectors';}else{title_keywords=type.header;}
title_header+='<strong>'+title_keywords+'</strong>';if(category){var category_id=SearchBoxTag.termToURL(category),category_url=category_id+'-vectors',category_title=SearchBox.dictionary.categories[category_id]||category;title_window+=' within '+category_title;title_header+=' within <strong>'+category_title+'</strong>';path_url[0]=category_url;path_crumbs.unshift('<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/'+category_url+'" itemprop="url"><span itemprop="title">'+category_title+'</span></a></li>');}
path_crumbs.unshift('<li itemscope itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/'+type.path+'" itemprop="url"><span itemprop="title">'+type.header+' Vectors</span></a></li>');if(artist){var artist_id=SearchBoxTag.termToURL(artist),artist_url='by_'+artist_id,artist_title=SearchBox.dictionary.artists[artist_id]||artist;is_following=VectorStock.userData.isFollowing(artist_id),button_label=(is_following?'Following':'Follow'),button_selected=(is_following?'selected':''),logged_in=(VectorStock&&VectorStock.isLoggedIn&&VectorStock.isLoggedIn()?true:false);title_window+=' by '+artist_title;title_header+=' by <strong class="artist">'+artist_title+'</strong>';if(logged_in){title_header+='<button type="button" data-action="follow" data-artist="'+artist_title+'" class="'+button_selected+'" title="Follow Artists that you like to create a newsfeed of their recent images."><span class="label">'+button_label+'</span></button>';}
path_url[1]=((path_url[1])||'vectors')+'-'+artist_url;}
if(similar){title_window+=' similar to #'+similar;title_header+=' similar to <strong>#'+similar+'</strong>';if(!path_url[1])path_url[1]='vectors';path_url[1]+='-similar-to_'+similar;}
if((params.type==SearchResultData.TYPE_PURCHASED)||(params.type==SearchResultData.TYPE_PENDING)||((keywords.length==0)&&(order==SearchResults.ORDER_TRENDING))||((keywords.length>0)&&(order==SearchResults.ORDER_BESTMATCH))||((keywords.length==0)&&(!category)&&(artist)&&(order==SearchResults.ORDER_BESTMATCH))){}
else{path_url.push(path_url.pop()+'-order_'+order);}
if(page>1){title_window+=' - Page '+page;path_url.push(path_url.pop()+'-page_'+page);}
return{url:'/'+path_url.join('/'),crumbs:path_crumbs.join(''),header:title_header,title:title_window};};SearchResultData.TYPE_BROWSE='browse';SearchResultData.TYPE_FREE='free';SearchResultData.TYPE_PURCHASED='purchased';SearchResultData.TYPE_PENDING='pending';SearchResultData.TYPE_PENDING_SELF='_self';;var SearchBoxDictionary=function(){var INSTANCE=VSModule();INSTANCE.keywords={};INSTANCE.artists={};INSTANCE.categories={'abstract':'Abstract','animals-wildlife':'Animals & Wildlife','artistic-experimental':'Artistic & Experimental','backgrounds-textures':'Backgrounds & Textures','beauty-fashion':'Beauty & Fashion','borders-frames':'Borders & Frames','buildings-landmarks':'Buildings & Landmarks','business-finance':'Business & Finance','cartoons':'Cartoons','celebration-party':'Celebration & Party','children-family':'Children & Family','christmas':'Christmas','cityscapes':'Cityscapes','communication':'Communication','computers':'Computers','copy-space':'Copy-Space','dancing':'Dancing','design-elements':'Design Elements','digital-media':'Digital Media','dj-dance-music':'DJ-Dance Music','document-template':'Document Template','easter':'Easter','education':'Education','entertainment':'Entertainment','flags-ribbons':'Flags & Ribbons','floral-decorative':'Floral & Decorative','fonts-type':'Fonts & Type','food-drink':'Food & Drink','game-assets':'Game Assets','geographical-maps':'Geographical & Maps','graffiti':'Graffiti','graphs-charts':'Graphs & Charts','grunge':'Grunge','halloween':'Halloween','healthcare-medical':'Healthcare & Medical','heraldry':'Heraldry','housing':'Housing','icon-emblem-(single)':'Icon & Emblem (single)','icons-emblems-(sets)':'Icon & Emblem (sets)','industrial':'Industrial','infographics':'Infographics','interiors':'Interiors','landscapes-nature':'Landscapes & Nature','marriage-engagement':'Marriage & Engagement','military':'Military','miscellaneous':'Miscellaneous','music':'Music','objects-still-life':'Objects & Still Life','packaging':'Packaging','patterns':'Patterns','patterns-(seamless)':'Patterns (seamless)','people':'People','photo-real':'Photo-Real','religion':'Religion','science':'Science','seasons':'Seasons','shopping-retail':'Shopping & Retail','signs-symbols':'Signs & Symbols','silhouettes':'Silhouettes','sports-recreation':'Sports & Recreation','t-shirt-graphics':'T-Shirt Graphics','technology':'Technology','telecommunications':'Telecommunications','transportation':'Transportation','urban-scenes':'Urban Scenes','user-interface':'User Interface','vacation-travel':'Vacation & Travel','valentines-day':'Valentines Day','vintage':'Vintage'};function addTerms(type,terms){var i=terms.length;while(i--){var term_display=terms[i],term_id=SearchBoxTag.termToURL(term_display);INSTANCE[type][term_id]=term_display;}}
INSTANCE.update=function(terms){if(!terms)return;if(terms.keywords){addTerms('keywords',terms.keywords);}
if(terms.artists){addTerms('artists',terms.artists);}};return INSTANCE;};SearchBoxDictionary.WORDS_SKIP=["an?d?","are","art","as","at","artworks?","be","by","clip-?art","do","for","from","got","graphics?","it'?s?","into","images?","illustrat(ions?|ed|ive)","my","on","of","or","so","to","the","vectors?","with","where","were","your"];;var SearchBoxRelated=function(nav){var INSTANCE=VSModule();var lists,list_kw,list_cg,no_results;var is_open;function init(){var container;is_open=nav.hasClass('expanded');if(nav.children().length==0){$('<h4>Related</h4>').appendTo(nav);container=$('<div />').appendTo(nav);kw_area=$('<div class="keywords" />').appendTo(container);kw_list=$('<ul />').appendTo(kw_area);cg_area=$('<div class="categories" />').appendTo(container);cg_list=$('<ul />').appendTo(cg_area);$('<span class="icon" />').prependTo($('> div',container));}else{container=$('> div',nav);kw_area=$('.keywords',container);kw_list=$('ul',kw_area);cg_area=$('.categories',container);cg_list=$('ul',cg_area);}
no_results=$('p',container);if(!no_results.length){no_results=$('<p>No related terms found</p>').hide().appendTo(container);}
nav.on('click','a',onClick);}
function onClick(event){var item=$(this).parent(),list=item.parent().parent(),term=item.attr('data-term'),context=item.parents('div').attr('class');var success=VectorStock.search_box.addTag(term,context);if(success){if(item.siblings().length==0)list.hide();item.remove();}
event.preventDefault();}
function populateList(type,list,terms,existing,max){var table={},i=existing.length;while(i--)table[existing[i]]=true;var index=added=0;while(index<terms.length&&added<max){var term_display=terms[index],term_url=SearchBoxTag.termToURL(term_display);if(type=='categories'){term_display=term_display.replace("+"," &amp; ");}
if(!table[term_url]){var url='/'+(type=='keywords'?'royalty-free-vectors/':'')+term_url+'-vectors',item=$('<li data-term="'+term_display+'" />').appendTo(list),link=$('<a href="'+url+'" title="'+term_display+' vectors">'+term_display+'</a>').appendTo(item);added++;}
index++;}
list.toggle(added>0);return(added>0);}
INSTANCE.open=function(){nav.addClass('expanded');is_open=true;};INSTANCE.close=function(){nav.removeClass('expanded');is_open=false;};INSTANCE.update=function(keywords,categories,is_all){if(VectorStock.search_box.getTags().length>3)return;kw_list.empty();cg_list.empty();if(is_all){INSTANCE.close();return;}
if(!is_open)INSTANCE.open();var existing=VectorStock.search_box.getValue(),is_results=((keywords.length||categories.length)>0);populateList('keywords',kw_list,keywords,existing.keywords,5);populateList('categories',cg_list,categories,existing.categories,2);kw_area.toggle(is_results);cg_area.toggle(is_results);no_results.toggle(!is_results);};init();return INSTANCE;};;var SearchBoxSuggestions=function(box,taglist){var INSTANCE=VSModule();var URL_AUTOCOMPLETE='/api/search/autocomplete';var COPY_LOADING='Loading Terms…',COPY_NO_MATCHES='No Matches Found';var MIN_CHARS=1,MAX_SUGGESTIONS_GROUP=6,MAX_SUGGESTIONS_ALL=10;var TIME_BUFFER=350;INSTANCE.visible=null;INSTANCE.loading=null;var fieldset_sbs,suggestions,input;var mem_suggestions=null,timeout_load;function init(){fieldset_sbs=$('fieldset',box);suggestions=$('<div class="suggestions" />').append('<div />').appendTo(fieldset_sbs);input=$('input[type=text]',fieldset_sbs);INSTANCE.visible=false;INSTANCE.loading=false;mem_suggestions=(head.sessionStorage&&sessionStorage.autocomplete)?JSON.parse(sessionStorage.autocomplete):{};suggestions.on('mouseover','li',onMouseOver).on('mouseout','li',onMouseOut).on('click','li',onSelect);return INSTANCE;}
function onMouseOver(){$('li.highlight',suggestions).removeClass('highlight');$(this).addClass('highlight');}
function onMouseOut(){$(this).removeClass('highlight');}
function onSelect(){var term_id=$(this).attr('data-term'),context=$(this).parents('.group').attr('data-context');INSTANCE.dispatchEvent('selectItem',[term_id,context]);}
function onClickOutside(event){if($(event.target).parents().is(suggestions)){event.preventDefault();}else{INSTANCE.toggle(false);}}
function loadTerms(term_id){$.ajax({url:URL_AUTOCOMPLETE,data:{prefix:encodeURIComponent(term_id)},dataType:'json',type:'GET'}).done(function(response){mem_suggestions[term_id]=response.results;SearchBox.dictionary.update(response.results);if(head.sessionStorage&&JSON&&JSON.stringify){try{sessionStorage.autocomplete=JSON.stringify(mem_suggestions);}catch(e){}}
var current_input=SearchBoxTag.termToURL(input.val());if(current_input==term_id){populateSuggestions(term_id,response.results);}}).fail(function(response){populateSuggestions(term_id,{keywords:[],artists:[],categories:[]});});if(term_id.length<MIN_CHARS){INSTANCE.toggle(false);}
else if(!INSTANCE.loading){INSTANCE.toggle(false);INSTANCE.loading=true;}}
function populateSuggestions(term_id,results){var is_results=false;if(term_id.length>=MIN_CHARS){var list=$('div',suggestions).empty(),items_all=0;var escapeRegExp=function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");};var populateGroup=function(context){var group=$('<div class="group" data-context="'+context+'" />'),title=$('<h6>'+context+'</h6>').appendTo(group),terms=$('<ul />').appendTo(group),items=0;var i=0;while((i<results[context].length)&&(i<MAX_SUGGESTIONS_GROUP)&&(items_all<MAX_SUGGESTIONS_ALL||i==0)){var rterm=results[context][i],rterm_id=SearchBoxTag.termToURL(rterm),rterm_used=taglist[context][rterm_id];if(!rterm_used){var search=new RegExp('('+escapeRegExp(term_id)+')','i'),replace='<em>$1</em>';$('<li data-term="'+rterm+'">'+rterm.replace(search,replace)+'</li>').appendTo(terms);items++;items_all++;is_results=true;}
i++;}
if(items){group.appendTo(list);}};for(var context in results){populateGroup(context);}
if(!is_results){}
INSTANCE.toggle(is_results);INSTANCE.loading=false;}
else{INSTANCE.toggle(false);}}
INSTANCE.toggle=function(show){if(show===INSTANCE.visible)return;show=(show==undefined)?!INSTANCE.visible:show;box.toggleClass('open',show);suggestions.toggle(show);if(show){$(document).on('mousedown',onClickOutside);}
else{$(document).off('mousedown',onClickOutside);$('li.highlight',suggestions).removeClass('highlight');}
INSTANCE.visible=show;}
INSTANCE.update=function(term){clearTimeout(timeout_load);term=VectorStock.sanitizeInput(term);var term_id=SearchBoxTag.termToURL(term);if(mem_suggestions[term_id]){populateSuggestions(term_id,mem_suggestions[term_id]);}
else{timeout_load=setTimeout(function(){loadTerms(term_id);},TIME_BUFFER);}};INSTANCE.selectedTerm=function(){var suggestion=$('li.highlight',suggestions);if(suggestion.length){var group=suggestion.closest('.group');return{term:suggestion.attr('data-term'),context:group.attr('data-context')}}
return null;};INSTANCE.moveHighlight=function(direction){var items=$('li',suggestions),length=items.length;if(length>0){var incumbent=items.filter('.highlight'),index=items.index(incumbent)+direction;index=(index<0)?((index<-1)?length-1:length):index;var successor=$(items[index]);incumbent.removeClass('highlight');if(successor.length>0){successor.addClass('highlight');}}};init();return INSTANCE;};;var SearchBoxTag=function(term,context){var INSTANCE=VSModule();var COPY_LABELS={categories:'In Category',artists:'By Artist',similar:'Similar To'};INSTANCE.term=term;INSTANCE.context=context;INSTANCE.term_id=null;INSTANCE.selected=null;INSTANCE.item=null;var button;function init(){INSTANCE.term_id=SearchBoxTag.termToURL(INSTANCE.term);INSTANCE.selected=false;INSTANCE.item=$('<li />').attr('data-term',INSTANCE.term_id).attr('data-context',context).append('<span class="term">'+INSTANCE.term+'</span>');button=$('<button type="button">×</button>').appendTo(INSTANCE.item);if(context!=SearchBoxTag.CONTEXT_DEFAULT){INSTANCE.item.prepend('<span class="context">'+COPY_LABELS[context]+'</span>');}
INSTANCE.item.on('click',onSelect)
button.on('mousedown',onRemove);return INSTANCE;}
function onSelect(event){if(INSTANCE.selected){INSTANCE.deselect();}else{INSTANCE.select();}
event.stopPropagation();}
function onRemove(event){INSTANCE.remove();event.stopPropagation();}
INSTANCE.add=function(list,index){if(index){$('li:eq('+(index-1)+')',list).after(INSTANCE.item);}else{list.prepend(INSTANCE.item);}
return INSTANCE;};INSTANCE.remove=function(supress_event){INSTANCE.item.remove();if(!supress_event){INSTANCE.dispatchEvent('remove',INSTANCE);}
return INSTANCE;};INSTANCE.update=function(term,context){INSTANCE.term=term;INSTANCE.context=context;INSTANCE.term_id=SearchBoxTag.termToURL(INSTANCE.term);INSTANCE.item.css({width:''}).attr('data-term',INSTANCE.term_id).attr('data-context',INSTANCE.context);$('span',INSTANCE.item).remove();INSTANCE.item.prepend('<span class="term">'+INSTANCE.term+'</span>');if(INSTANCE.context!=SearchBoxTag.CONTEXT_DEFAULT){INSTANCE.item.prepend('<span class="context">'+INSTANCE.context+'</span>');}};INSTANCE.select=function(){if(!INSTANCE.selected){INSTANCE.item.addClass('selected');INSTANCE.selected=true;INSTANCE.dispatchEvent('select',INSTANCE);}
return INSTANCE;};INSTANCE.deselect=function(supress){if(INSTANCE.selected){INSTANCE.item.removeClass('selected');INSTANCE.selected=false;INSTANCE.dispatchEvent('deselect',INSTANCE);}
return INSTANCE;};INSTANCE.highlight=function(){INSTANCE.item.addClass('selected');setTimeout(function(){INSTANCE.item.addClass('unselect').removeClass('selected');setTimeout(function(){INSTANCE.item.removeClass('unselect');},500);},500);return INSTANCE;};init();return INSTANCE;};SearchBoxTag.CONTEXT_KEYWORD='keywords';SearchBoxTag.CONTEXT_CATEGORY='categories';SearchBoxTag.CONTEXT_ARTIST='artists';SearchBoxTag.CONTEXT_SIMILAR='similar';SearchBoxTag.CONTEXT_DEFAULT=SearchBoxTag.CONTEXT_KEYWORD;SearchBoxTag.termToURL=function(term){term=term.replace(/\s*&\s*|\s*\+\s*|\s+/g,'-');term=term.toLowerCase();return term;};SearchBoxTag.termToDisplay=function(term){return term.replace(/\+/g,' & ');};;var SearchBox=function(box){var INSTANCE=VSModule();var MAX_LIST_PERC=0.66;var mode_highlight,mode_dragging,mem_tags,mem_selected,is_empty,is_overflowing,is_loading,box_width_min,box_width_max,fset_width_min,list_width;var fieldset_sb,tags,taglist,input,label,clear,suggestions,submit,values;INSTANCE.mode=SearchBox.MODE_DYNAMIC;INSTANCE.box=box;function init(){mode_highlight=false;mode_dragging=false;mem_tags={total:0,keywords:{},categories:{},artists:{},similar:{}};mem_selected=[];is_empty=true;is_overflowing=false;is_loading=false;list_width=0;fieldset_sb=$('fieldset',box);tags=$('.tags',box);taglist=$('ul',tags);input=$('input[type=text]',box);label=$('<label />').text(input.attr('placeholder')).appendTo(fieldset_sb);clear=$('<button type="button">Clear</button>').appendTo(fieldset_sb);submit=$('button[type=submit]',box);suggestions=SearchBoxSuggestions(box,mem_tags);values={};values['keywords']=$('input[name=keywords]',fieldset_sb);values['categories']=$('input[name=categories]',fieldset_sb);values['artists']=$('input[name=artists]',fieldset_sb);values['similar']=$('input[name=similar]',fieldset_sb);box_width_min=box.width();fset_width_min=fieldset_sb.width();box_fset_dif=box_width_min-fset_width_min;box_width_max=box_width_min+($('header .grid nav').width()-$('header .grid nav ul').width());input.attr('placeholder','');$('<div class="fadeleft" />').appendTo(fieldset_sb);$('<div class="faderight" />').appendTo(fieldset_sb);is_empty=(input.val()=='');$('li',taglist).each(function(){var term=$('.term',this).text(),context=$(this).attr('data-context');$(this).remove();INSTANCE.addTag(term,context);is_empty=false;});box.toggleClass('empty',is_empty);fieldset_sb.on('mousedown',onStartDrag).on('click',INSTANCE.focus);input.on('focus',onInputFocus).on('blur',onInputBlur).on('keydown',onInputKeyPress).on('paste',onChange);clear.on('mousedown',INSTANCE.empty);submit.on('click',createTagFromInput);suggestions.on('selectItem',onSelectSuggestion);$(window).on('resize',onResizeWindow);}
function onStartDrag(){var is_empty=(input.val()==''),notches=[];for(var context in mem_tags){if(context!='total'){for(var term in mem_tags[context]){var tag=mem_tags[context][term];notches.push({tag:tag,endpos:tag.item.offset().left+tag.item.width()});}}}
var dragMove=function(event){var i=notches.length;while(i--){if(event.pageX<notches[i].endpos){notches[i].tag.select();(is_empty)?input.blur():null;}else{notches[i].tag.deselect();}}
mode_dragging=true;};var dragCancel=function(){$(document).off('mousemove',dragMove).off('mouseup',dragCancel);mode_dragging=false;};$(document).on('mousemove',dragMove).on('mouseup',dragCancel);}
function onInputFocus(){label.css({opacity:0.15});box.addClass('focused');}
function onInputBlur(){label.css({opacity:''});box.removeClass('focused');}
function onInputKeyPress(event){switch(event.keyCode){case 17:case 91:var keyComboPress=function(event){if(event.keyCode==65){selectAllTags();if(!input.val().length){event.preventDefault();if(mem_selected.length){setTimeout(function(){input.blur();},1);}}}};var keyComboRelease=function(event){if(event.keyCode==17||event.keyCode==91){cancelCombo();}};var cancelCombo=function(event){input.off('keydown',keyComboPress).off('keyup',keyComboRelease).off('blur',cancelCombo);};input.on('keydown',keyComboPress).on('keyup',keyComboRelease).on('blur',cancelCombo);break;case 13:var selected=suggestions.selectedTerm();if(selected){INSTANCE.addTag(selected.term,selected.context);input.val('');suggestions.toggle(false);event.preventDefault();}
else{createTagFromInput(event);}
break;case 38:case 40:if(suggestions.visible){var direction=(event.keyCode<39)?-1:1;suggestions.moveHighlight(direction);event.preventDefault();}
break;case 188:createTagFromInput(event);break;case 8:if(input.val()==''){if(!mem_selected.length){var list=$('li',taglist);if(list.length){var item=list.last(),term_id=item.attr('data-term'),context=item.attr('data-context')||SearchBoxTag.CONTEXT_DEFAULT;mem_tags[context][term_id].select();input.blur();}
event.stopPropagation();}
break;}
default:onChange();}}
function onChange(){setTimeout(function(){var term=input.val();if(term.length>0){suggestions.update(term);box.removeClass('empty');is_empty=false;}else{suggestions.toggle(false);if(mem_tags.total==0){box.addClass('empty');is_empty=true;}}},5);}
function onHighlightClick(event){var target=$(event.target),tag_click=target.parents().is(taglist);if(!tag_click){var i=mem_selected.length;while(i--){mem_selected[i].deselect();}
toggleHighlightMode(false);}}
function onHighlightKeyPress(event){var input_clear=(event.keyCode==46||event.keyCode==8||event.keyCode==32),input_value=((event.keyCode>47&&event.keyCode<58)||(event.keyCode>95&&event.keyCode<112)||(event.keyCode>64&&event.keyCode<91));if(input_clear||input_value){var i=mem_selected.length;while(i--){var tag=mem_selected[i];deleteTagFromMemory(tag);tag.remove(true);}
mem_selected=[];updateValues();adjustWidth();INSTANCE.focus();toggleHighlightMode(false);INSTANCE.dispatchEvent('change',INSTANCE.getValue());if(input_value){onInputKeyPress(event);}}}
function onSelectSuggestion(term,context){var success=INSTANCE.addTag(term,context);if(success){input.val('');suggestions.toggle(false);}}
function onTagSelect(tag){mem_selected.push(tag);toggleHighlightMode(true);}
function onTagDeselect(tag){deleteTagFromSelection(tag);}
function onTagRemove(tag){deleteTagFromSelection(tag);deleteTagFromMemory(tag);updateValues();adjustWidth();setTimeout(function(){INSTANCE.focus()},1);INSTANCE.dispatchEvent('change',INSTANCE.getValue());}
function onResizeWindow(){box_width_max=box_width_min+($('header .grid nav').width()-$('header .grid nav ul').width());adjustWidth();}
function toggleHighlightMode(is_on){var state=(is_on==undefined)?(!mode_highlight):is_on;if(state==mode_highlight)return;if(state){$(document).on('keydown',onHighlightKeyPress).on('mousedown',onHighlightClick);}
else{$(document).off('keydown',onHighlightKeyPress).off('mousedown',onHighlightClick);}
mode_highlight=state;}
function createTagFromInput(event){if(input.val().length>0){var str=VectorStock.sanitizeInput(input.val()),terms=str.split(' '),was_added=false;var i=0;while(i<terms.length){var term=$.trim(terms[i]);if(term){was_added=INSTANCE.addTag(term,null,false,true)||was_added;}
i++;}
if(was_added){input.val('');suggestions.toggle(false);INSTANCE.dispatchEvent('change',INSTANCE.getValue());}}
event.preventDefault();event.stopPropagation();}
function removeAllTags(){for(var context in mem_tags){if(context!='total'){for(var term in mem_tags[context]){mem_tags[context][term].remove(true);}
mem_tags[context]={};}}
mem_tags.total=0;mem_selected=[];}
function deleteTagFromMemory(tag){delete mem_tags[tag.context][tag.term_id];mem_tags.total=Math.max(mem_tags.total-1,0);if(mem_tags.total==0){box.addClass('empty');is_empty=true;}}
function deleteTagFromSelection(tag){var i=mem_selected.length;while(i--){if(mem_selected[i]==tag){mem_selected.splice(i,1);break;}}
if(!mem_selected.length){toggleHighlightMode(false);}}
function updateValues(){var updateValue=function(type){var value=[];for(var term in mem_tags[type]){value.push(term);}
values[type].val(value.join(','));};updateValue('keywords');updateValue('categories');updateValue('artists');updateValue('similar');}
function selectAllTags(){for(var context in mem_tags){if(context!='total'){for(var term in mem_tags[context]){mem_tags[context][term].select();}}}}
function adjustWidth(){var list_width_new=taglist.outerWidth(),fset_width_new=fieldset_sb.outerWidth(),difference=list_width_new-list_width,overflow_min=((list_width_new/fset_width_min)>MAX_LIST_PERC),overflow_new=((list_width_new/fset_width_new)>MAX_LIST_PERC),overflowing=false,box_width;if(!overflow_min){box_width=box_width_min;}else{box_width=box_fset_dif+Math.ceil(list_width_new/MAX_LIST_PERC);box_width=Math.min(box_width,box_width_max);overflowing=((list_width_new/(box_width-box_fset_dif))>MAX_LIST_PERC);}
box.width(box_width);list_width=taglist.outerWidth();box.toggleClass('overflow',overflowing);is_overflowing=overflowing;}
INSTANCE.focus=function(){input.focus();};INSTANCE.empty=function(){var was_content=($('li',taglist).length>0);removeAllTags();updateValues();adjustWidth();box.addClass('empty');toggleHighlightMode(false);is_empty=true;input.val('');setTimeout(function(){INSTANCE.focus()},1);if(was_content){INSTANCE.dispatchEvent('change',INSTANCE.getValue());}};INSTANCE.getValue=function(){var tag_values={keywords:[],categories:[],artists:[],similar:[]};for(var context in tag_values){for(var term in mem_tags[context]){tag_values[context].push(term);}}
return tag_values;};INSTANCE.getTags=function(){var tags=[];$('li',taglist).each(function(){tags.push({term:$('.term',this).text(),context:$(this).attr('data-context')});});return tags;};INSTANCE.addTag=function(term,context,replace_all,suppress_event){var term=$.trim(term),success=false,term_id=SearchBoxTag.termToURL(term),context=(context?context.toLowerCase():SearchBoxTag.CONTEXT_DEFAULT);var existing_tag=mem_tags[context][term_id];if(existing_tag&&existing_tag.highlight){existing_tag.highlight();}
else{var index=$('li',taglist).length,replace=false;if(replace_all){removeAllTags();index=0;}else if(context!=SearchBoxTag.CONTEXT_DEFAULT){for(var old_term_id in mem_tags[context]){var tag=mem_tags[context][old_term_id];tag.remove();index--;}}
var tag=SearchBoxTag(term,context);tag.add(taglist,index);mem_tags[context][term_id]=tag;mem_tags.total++;updateValues();tag.on('select',onTagSelect).on('deselect',onTagDeselect).on('remove',onTagRemove);adjustWidth();box.removeClass('empty');is_empty=false;success=true;if(is_overflowing){var offset=tag.item.width();tag.item.stop().css({opacity:0}).animate({opacity:1},250,'linear',function(){$(this).css({opacity:''});});taglist.stop().css({right:-offset}).animate({right:0},250,'easeOutCubic',function(){$(this).css({right:''});});}
if(!suppress_event){INSTANCE.dispatchEvent('change',INSTANCE.getValue());}}
return success;};INSTANCE.set=function(terms){removeAllTags();input.val('');toggleHighlightMode(false);if(terms.length){for(var i=0;i<terms.length;i++){INSTANCE.addTag(terms[i].term,terms[i].context,false,true);}}else{box.addClass('empty');is_empty=true;}
updateValues();adjustWidth();};INSTANCE.updateTag=function(term,context_old,context_new){var term_id=SearchBoxTag.termToURL(term),tag=mem_tags[context_old][term_id];if(context_new!=SearchBoxTag.CONTEXT_DEFAULT){for(var old_term_id in mem_tags[context_new]){var tag_old=mem_tags[context_new][old_term_id];tag_old.remove();}}
tag.update(term,context_new);adjustWidth();delete mem_tags[context_old][term_id];mem_tags[context_new][term_id]=tag;updateValues();};INSTANCE.setStatus=function(status){if(status=='loading'){if(!is_loading){submit.prop('disabled',true);submit.loadingIcon();is_loading=true;}}else{if(is_loading){submit.prop('disabled',false);$('.vs_loadicon',submit).remove();is_loading=false;}}};INSTANCE.setMode=function(mode){INSTANCE.mode=mode;};INSTANCE.reload=function(){INSTANCE.dispatchEvent('change',INSTANCE.getValue());};init();return INSTANCE;};SearchBox.STATUS_LOADING='loading';SearchBox.STATUS_READY='ready';SearchBox.MODE_DYNAMIC='dynamic';SearchBox.MODE_STATIC='static';SearchBox.dictionary=SearchBoxDictionary();;var SearchLoadBar=function(){var INSTANCE=VSModule();var ID_NAMESPACE='bar_loading';var DURATION_LATENCY=1000,DURATION_WAITING=5000;var LOAD_POINTS=[0,40,60,100];var container,bar;function init(){$('#'+ID_NAMESPACE).remove();container=$('<div id="'+ID_NAMESPACE+'" />').appendTo('body');bar=$('<div />').appendTo(container);bar.animate({width:LOAD_POINTS[1]+'%'},DURATION_LATENCY,'easeInCubic',function(){bar.animate({width:LOAD_POINTS[2]+'%'},DURATION_WAITING);});}
INSTANCE.update=function(percent){var wide=(LOAD_POINTS[2]+Math.round(percent*(100-LOAD_POINTS[2])))+'%';bar.stop().animate({width:wide},300,'easeOutQuad');};INSTANCE.complete=function(){bar.stop().animate({width:'100%'},500,'easeOutCubic');setTimeout(function(){container.animate({opacity:0},750,'easeOutCubic',function(){container.remove();});},2000);};init();return INSTANCE;};;var SearchBubble=function(header){var INSTANCE=VSModule();var COPY_ARTIST='We also have an Artist named <a></a>',COPY_CATEGORY='We also have a Category for <a></a>',COPY_VECTOR='We also have a Vector with the ID <a></a>',COPY_FREE='This was a Free vector search. <a></a>';var container,inner,icon,contents,link,but_close;var is_open=false;INSTANCE.term=null;INSTANCE.type=null;INSTANCE.name=null;INSTANCE.url=null;INSTANCE.hits=null;function init(){container=$('.alternatives',header);if(container.length){inner=$('> div',container);icon=$('.icon',inner);contents=$('p',inner);link=$('a',contents);but_close=$('button',inner);INSTANCE.term=link.text();INSTANCE.type=link.data('context');INSTANCE.name=link.text();INSTANCE.url=link.attr('href');link.on('click',onLinkClick);is_open=true;}
else{container=$('<div class="alternatives" />');inner=$('<div />').appendTo(container);icon=$('<span class="icon" />').appendTo(inner);contents=$('<p />').appendTo(inner);but_close=$('<button>Close</button>').appendTo(inner);}
but_close.on('click',saveAndClose);}
function open(){if(!is_open){container.appendTo(header);container.stop().hide().slideDown(300,'easeOutCubic');inner.stop().hide().fadeIn(300);is_open=true;}}
function close(){if(is_open){container.stop().slideUp(300,'easeOutCubic',function(){container.detach();});inner.stop().fadeOut(300);INSTANCE.term=null;INSTANCE.type=null;INSTANCE.name=null;INSTANCE.url=null;is_open=false;}}
function saveAndClose(){if(INSTANCE.type!==SearchBubble.TYPE_FREE){SearchBubble.closed[INSTANCE.term]=true;}
close();}
function onLinkClick(){if(INSTANCE.type==SearchBubble.TYPE_FREE){var tags=VectorStock.search_box.getTags(),tag_list=[];var i=0;while(i<tags.length){tag_list.push(tags[i++].term);}
VectorStock.search_results.setScope(SearchResults.SCOPE_ALL);VectorStock.search_box.dispatchEvent('change',VectorStock.search_box.getValue());}else if(INSTANCE.type==SearchBubble.TYPE_VECTOR){return true;}else{VectorStock.search_box.addTag(INSTANCE.name,INSTANCE.type,true);}
close();return false;}
INSTANCE.set=function(params,response){if(params.type==SearchResults.SCOPE_FREE){var is_keywords=(params.keywords&&params.keywords.length),is_artists=(params.artists&&params.artists.length);if(is_keywords||is_artists){var params=$.extend({},params);params.type=SearchResults.SCOPE_ALL;var data=SearchResultData(params);INSTANCE.type=SearchBubble.TYPE_FREE;INSTANCE.name=$(data.header).text().replace(/^All /i,'');INSTANCE.term=INSTANCE.name;INSTANCE.hits=(response.altresults?response.altresults.hit_count||0:0);INSTANCE.url=data.url;contents.html(COPY_FREE);var counter=(INSTANCE.hits>0)?'('+INSTANCE.hits.formatCommas()+')':'our';link=$('a',contents).text('View '+counter+' Royalty-Free '+INSTANCE.name).attr('href',INSTANCE.url);link.on('click',onLinkClick);open();}}
else if(response.altresults&&params.page==1){var term,type,name,url,copy;term=response.altresults.term;type=response.altresults.type;name=response.altresults.name;url=response.altresults.url;if(INSTANCE.name!==name&&!SearchBubble.closed[name]){switch(type){case SearchBubble.TYPE_ARTIST:copy=COPY_ARTIST;break;case SearchBubble.TYPE_CATEGORY:copy=COPY_CATEGORY;break;case SearchBubble.TYPE_VECTOR:copy=COPY_VECTOR;break;}
contents.html(copy);link=$('a',contents).text(name).attr('href',url).attr('data-context',type);INSTANCE.term=term;INSTANCE.type=type;INSTANCE.name=name;INSTANCE.url=url;link.on('click',onLinkClick);open();}}};INSTANCE.update=function(params){if(is_open){var match_term=false;if(params.keywords.length||params.artists.length){if(params.type==SearchResults.SCOPE_FREE&&INSTANCE.type==SearchBubble.TYPE_FREE){match_term=true;}
else if(INSTANCE.term&&INSTANCE.term.toLowerCase){var i=params.keywords.length;while(i--){if(params.keywords[i]==INSTANCE.term.toLowerCase()){match_term=true;break;}}}}
if(!match_term){var terms_by_id={},j=params.keywords.length;while(j--)terms_by_id[params.keywords[i]]=true;for(var term in SearchBubble.closed){if(!terms_by_id[term]){delete SearchBubble.closed[term];}}
close();}}};init();return INSTANCE;};SearchBubble.TYPE_FREE='free';SearchBubble.TYPE_ARTIST='artists';SearchBubble.TYPE_VECTOR='vectors';SearchBubble.TYPE_CATEGORY='categories';SearchBubble.closed={};;var SearchSimilar=function(sidebar){var INSTANCE=new VSModule();var SEARCH_LIMIT=15;var container,search_list,tooltip;var offset_top=0,is_fixed=false,is_over_link=false,timeout_hoveritem;function init(){container=$('#related-searches',sidebar);if(container.length){search_list=$('ul',container);setSearchTermEvents();onResize();}else{container=null;}
$(window).on('resize',onResize).on('scroll',onScroll);}
function setSearchTermEvents(){var images_used={};var terms_list=$('li',search_list);terms_list.each(function(){var item=$(this),link=$('a',item),terms=link.text().split(' ');var images_pool=item.attr('data-preview').split(','),images_list=[];for(var i=0;i<images_pool.length;i++){var image_id=images_pool[i];if(!images_used[image_id]){images_list.push(image_id);images_used[image_id]=true;if(images_list.length==3)break;}}
if(images_list.length<3){for(var j=0;j<images_pool.length;j++){var image_id=images_pool[i];if(images_list.indexOf(image_id)<0){images_list.push(image_id);if(images_list.length==3)break;}}}
link.on('mouseover',function(){terms_list.removeClass('highlighted');item.addClass('highlighted');is_over_link=true;if(tooltip){tooltip.update(item.position().top,images_list);}else{tooltip=new SearchSimilarTooltip(container,images_list,item.position().top);tooltip.on('mouseout',function(){if(tooltip&&!is_over_link){tooltip.remove();tooltip=null;terms_list.removeClass('highlighted');}});}
clearTimeout(timeout_hoveritem);});link.on('mouseout',function(){is_over_link=false;timeout_hoveritem=setTimeout(function(){if(tooltip&&!tooltip.mouseover){tooltip.remove();tooltip=null;item.removeClass('highlighted');}
timeout_hoveritem=null;},10);});link.on('click',function(event){if($('header nav.top nav li.selected').index()==0){item.addClass('selected');var new_search=[];for(var i=0;i<terms.length;i++){new_search.push({term:terms[i],context:SearchBoxTag.CONTEXT_KEYWORD});}
VectorStock.search_box.set(new_search);VectorStock.search_box.reload();VectorStock.search_results.scrollToTop();event.preventDefault();}});});}
function onResize(){if(container){offset_top=container.offset().top-parseInt(container.css('margin-top'));onScroll();}}
function onScroll(){if(container){var pos_scroll=$(window).scrollTop();if(pos_scroll>=offset_top){if(!is_fixed){container.addClass('fixed');is_fixed=true;}}else{if(is_fixed){container.removeClass('fixed');is_fixed=false;}}}}
INSTANCE.set=function(searches){if(!searches||!searches.length){INSTANCE.clear();return;}
if(!container){container=$('<div id="related-searches"><p>Similar Searches</p><ul></ul></div>').appendTo(sidebar);search_list=$('ul',container);onResize();}
search_list.empty();var total_searches=Math.min(SEARCH_LIMIT,searches.length);for(var i=0;i<total_searches;i++){var search_term=searches[i].search,search_url='/royalty-free-vectors/'+search_term.split(' ').join('-')+'-vectors',search_ids=searches[i].results.join(',');$('<li data-preview="'+search_ids+'"><a href="'+search_url+'">'+search_term+'</a></li>').appendTo(search_list);}
setSearchTermEvents();};INSTANCE.clear=function(){if(container)container.remove();container=null;};init();return INSTANCE;};var SearchSimilarTooltip=function(container,images,offset_y){var INSTANCE=new VSModule();var preview,image_list;var timeout_leave,images_str;INSTANCE.images_str=null;INSTANCE.mouseover=false;function init(){preview=$('<div class="preview" />').css('top',offset_y).appendTo(container);image_list=$('<ul />').appendTo(preview);populate(images);preview.on('mouseover',function(){clearTimeout(timeout_leave);INSTANCE.mouseover=true;}).on('mouseout',function(){INSTANCE.mouseover=false;timeout_leave=setTimeout(function(){INSTANCE.dispatchEvent('mouseout');},100);});setTimeout(function(){preview.addClass('reveal');},10);}
function loadImage(link,image_src){var icon=link.loadingIcon('small');var image=new Image();image.onload=function(){icon.remove();var image=$('<span class="image" />').appendTo(link);image.css('background-image','url('+image_src+')');setTimeout(function(){image.addClass('reveal');},10);};image.onerror=function(){icon.remove();};image.src=image_src;}
function populate(images){var images_str=images.toString();if(images_str==INSTANCE.images_str)return;image_list.empty();for(var i=0;i<images.length;i++){var item=$('<li />').appendTo(image_list),link=$('<a href="/'+images[i]+'" />').appendTo(item);var image_src=VectorStock.imagePath(images[i]);loadImage(link,image_src);}
INSTANCE.images_str=images_str;}
INSTANCE.update=function(new_offset_y,images){preview.css('top',new_offset_y);offset_y=new_offset_y;populate(images);};INSTANCE.remove=function(){preview.addClass('conceal');setTimeout(function(){preview.remove();},500);};init();return INSTANCE;};;var SearchAlternative=function(header,init_container){var INSTANCE=VSModule();var container=(init_container.length?init_container:null),thumbs_list;INSTANCE.parameters=null;function construct(parameters){INSTANCE.parameters=parameters;if(container)container.empty();else container=$('<div class="altresults" />').insertAfter(header);var title,thumbs,link_all,link_label,link_icon;title=$('<h4 />').appendTo(container);thumbs=$('<div class="thumbs" />').appendTo(container);thumbs_list=$('<ul />').appendTo(thumbs);link_all=$('<a href="" class="premium" />').appendTo(container);link_label=$('<span class="label" />').appendTo(link_all);link_icon=$('<span class="icon"></span>').appendTo(link_all);link_all.on('click',function(){onSearchUpgrade('button');});if(parameters.type=='free'){title.html('<strong><a href="'+parameters.url+'">Premium '+parameters.name+'</a></strong> ('+parameters.hit_count.formatCommas()+')');link_all.attr('href',parameters.url);link_label.html('More '+parameters.name+'…');$('a',title).on('click',function(){onSearchUpgrade('title');});}
else if(parameters.type=='vectors'){title.html('<strong>Image #'+parameters.name+'</strong>');link_all.remove();var image_id=parameters.name,image_src=VectorStock.imagePath(image_id,'small');addImageThumb(image_id,parameters.url,image_src,image_id);}
if(parameters.documents){for(var i=0;i<parameters.documents.length;i++){var image_id=parameters.documents[i].id,image_title=parameters.documents[i].title,image_url=parameters.documents[i].url,image_src='https://cdn.vectorstock.com/i/thumbs'+parameters.documents[i].path;addImageThumb(image_id,image_url,image_src,image_title);}}}
function getSearchTerms(url){var search_terms=url.match(/\/royalty-free-vectors\/(.*)-vectors$/i);if(search_terms.length>1){return search_terms[1].replace(/-/g,' ');}
return url;}
function onSearchUpgrade(source){var search_terms=getSearchTerms(INSTANCE.parameters.url);VectorStock.trackAction('Search Upgrade',{search:search_terms,source:source});}
function addImageThumb(image_id,image_url,image_src,image_title){var item=$('<li />').appendTo(thumbs_list),link=$('<a href="'+image_url+'" />').appendTo(item);if(INSTANCE.parameters.type=='free'){var search_terms=getSearchTerms(INSTANCE.parameters.url);VectorStock.trackAction('Search Upgrade',{search:search_terms,source:image_id});}
var image=new Image();image.onload=function(){$(image).attr({title:image_title+' vector',alt:image_title}).appendTo(link);setTimeout(function(){item.addClass('reveal');},10);};image.onerror=function(){item.remove();};image.src=image_src;}
INSTANCE.set=function(parameters){if(INSTANCE.parameters&&parameters.type==INSTANCE.parameters.type&&parameters.name==INSTANCE.parameters.name)return;if(parameters.type!=='free'&&parameters.type!=='vectors')return;construct(parameters);};INSTANCE.remove=function(){if(container){container.remove();container=null;}};return INSTANCE;};;var SearchResults=function(settings){var INSTANCE=VSModule();var URL_SEARCH='/api/search',URL_PURCHASED='/api/template/purchased',URL_PENDING_ARTIST='/api/pending/artist',URL_PENDING_INSPECTOR='/api/pending';var MIN_SCROLLRANGE=200,MIN_PADDING=20;var SIZE_LARGE_WIDTH=240,SIZE_LARGE_HEIGHT=252,SIZE_LARGE_GUTTER=20,RATIO_LARGE=SIZE_LARGE_WIDTH/SIZE_LARGE_HEIGHT;var FLAG_TYPES={'M':'Metadata','K':'Keywords','C':'Categories'};var SEARCH_CACHE_LIMIT=5;INSTANCE.PAGE_LIMIT=100;INSTANCE.PAGE_LIMIT_PENDING=100;var scope=settings.scope,collection,pagination,fs_order,fs_order_items,opt_bestmatch,fs_layout,pagenumbers,results_none,results_fail,loadbar,windowframe;var search_params=settings.params,search_cache={},search_current='',search_url=window.location.pathname,search_order='',search_layout='',search_scope='',search_page=1,search_pages=1,search_history=[],search_results={},vectorset=[],order_set=false,show_gallery=settings.gallery,show_cart=settings.cart,is_pending=false;function init(){collection=$('> ul',scope);pagination=$('.pagination');fs_order=$('fieldset.type_order',pagination);fs_order_items=$('> ul',fs_order);opt_bestmatch=$('li[data-value="bestmatch"]',fs_order_items);fs_layout=$('fieldset.type_layout',pagination);fs_layout_items=$('> ul',fs_layout);pagenumbers=$('ul.pages',pagination);if(pagenumbers.length==0)pagenumbers=$('<ul class="pages" />').appendTo(pagination.last());results_none=$('<div class="message"><h1>Sorry, there are no matches.</h1><p>Keep trying - here are a couple of tips:</p><ul><li>Check the spelling is correct</li><li>Use simpler search terms</li></ul><p>If you continue to have problems, visit the <a href="/contact">Contact page</a> to let us know.</p></div>');results_fail=$('<div class="message"><h1>Hmmm... this search had problems loading.</h1><p>Try <a href="">reloading this page</a>.</p><p>If you\'re still having issues, <a href="/contact">please let us know.</a> and we\'ll do our best to address the problem.</p></div>');windowframe=$(window);search_order=$('.selected',fs_order_items).attr('data-value')||SearchResults.ORDER_LATEST;search_layout=$('.selected',fs_layout_items).attr('data-value')||SearchResults.LAYOUT_LARGE;search_scope=$('#search_type').val()||SearchResults.SCOPE_ALL;search_page=parseInt($('#search_page').val())||search_page;search_pages=parseInt($('#search_pages').val())||search_pages;is_pending=(search_scope==SearchResults.SCOPE_PENDING);is_pending_admin=(is_pending&&$('#pending_scope').val()!=='_self');if(is_pending_admin){search_layout=SearchResults.LAYOUT_SMALL;}
fs_order_items.on('click','li',function(){$('li.selected',fs_order_items).removeClass('selected');$(this).addClass('selected');search_order=$(this).attr('data-value');orderBy(search_order);});fs_layout_items.on('click','li',function(){$('li.selected',fs_layout_items).removeClass('selected');$(this).addClass('selected');setLayout($(this).attr('data-value'));});pagination.on('click','button',function(){var button=$(this);search_page+=button.hasClass('prev')?-1:1;jumpTo(search_page);INSTANCE.scrollToTop();setTimeout(function(){button.blur();},100);});pagenumbers.on('click','li a',function(){var page_number=$(this).text().replace(/[^0-9]/g,'');search_page=parseInt(page_number);jumpTo(search_page);setTimeout(function(){INSTANCE.scrollToTop()},1);return false;});if(!opt_bestmatch.length&&!is_pending){opt_bestmatch=$('<li role="radio" data-value="bestmatch"><span class="icon"></span>Best Match</li>').prependTo(fs_order_items).hide();}
search_params.page=search_page;search_params.order=search_order;search_params.type=search_scope;search_params.limit=INSTANCE.PAGE_LIMIT;if(is_pending){var pending_scope=$('#pending_scope').val();if(pending_scope)search_params.pending=pending_scope;search_params.limit=INSTANCE.PAGE_LIMIT_PENDING;}
search_current=getSearchID(search_params);search_history.push(search_current);search_results={url:window.location.pathname,page:search_page,pages:search_pages,total:parseInt($('#search_total').val())};createVectors(true);search_cache[search_current]=search_results;}
function getSearchID(params){var params_ordered={},keys=[];for(var key in params){if(params.hasOwnProperty(key)){keys.push(key);}}
keys.sort();var i=0;while(i<keys.length){var key=keys[i];params_ordered[key]=params[key];i++;}
return $.param(params_ordered).toLowerCase();}
function createVectors(init){vectorset=[];var results=[],image_ids=[];$('> li',collection).each(function(){var vector=new SearchVector({scope:$(this),gallery:show_gallery,cart:show_cart,layout:search_layout,pending:is_pending});vectorset.push(vector);image_ids.push(vector.id);if(init){results.push({id:vector.id,title:vector.title});}});if(init)search_results.results=results;}
function updatePagination(results){if(results){search_url=(results.url||'');search_pages=(results.pages||1);if(search_pages<=1){pagenumbers.empty();return;}}
var url_base=search_url.replace(/-page_\d+$/gi,'');$('.prev',pagination).prop('disabled',search_page<=1);$('.next',pagination).prop('disabled',search_page==search_pages);pagenumbers.empty();if(search_pages>5){var stack=[],from=search_page-1,to=search_page+1;if(from<1){from=1;to++;}else if(to>search_pages){from--;to=search_pages;}
var i=from;while(i<=to){stack.push(i);i++;}
if(from>1){if(from>2){stack.unshift(null);}
stack.unshift(1);}
if(search_pages>to){if(search_pages>(to+1)){stack.push(null);}}
var j=0;while(j<stack.length){var value=stack[j],item=$('<li />').toggleClass('selected',(value==search_page)).appendTo(pagenumbers);if(value){var url=url_base+((value>1)?'-page_'+value:'');item.append('<a href="'+url+'">'+value.formatCommas()+'</a>');}else{item.addClass('period').text('...');}
j++;}}else{var i=1;while(i<=search_pages){var url=url_base+((i>1)?'-page_'+i:'');$('<li><a href="'+url+'">'+i.formatCommas()+'</a></li>').toggleClass('selected',(i==search_page)).appendTo(pagenumbers);i++;}}}
function disablePagination(){$('button',pagination).prop('disabled',true);pagenumbers.empty();var item=$('<li class="period" />').appendTo(pagenumbers);if(item.loadingIcon)item.loadingIcon();}
function jumpTo(page){search_params.page=page;performSearch(SearchResults.SEARCH_PAGE);}
function orderBy(order){search_page=1;search_order=order;search_params.page=1;search_params.order=order;order_set=true;performSearch(SearchResults.SEARCH_REORDER);}
function setLayout(layout){if(search_layout==layout)return;search_layout=layout;scope.toggleClass(SearchResults.LAYOUT_LARGE,(search_layout==SearchResults.LAYOUT_LARGE));var i=0;while(i<vectorset.length){vectorset[i++].setSize(search_layout);}
document.cookie='layout='+search_layout+'; domain=.vectorstock.com; path=/';}
function performSearch(type){var search_id=getSearchID(search_params);search_current=search_id;search_history.push(search_id);search_page=(search_params.page||1);if(search_history.length>SEARCH_CACHE_LIMIT){var old_searches=search_history.slice(0,search_history-SEARCH_CACHE_LIMIT);var i=old_searches.length;while(i--){var search_id=old_searches[i];if(search_cache[search_id])delete search_cache[search_id];}}
var data=SearchResultData(search_params);VectorStock.track('send','pageview','/api/search?'+search_id);$('#previewpane').remove();var cached_response=search_cache[search_id];if(cached_response){if(type==SearchResults.SEARCH_NEW){updatePagination(cached_response);}else{updatePagination();}
if(loadbar)loadbar.complete();loadbar=null;collection.removeClass('loading');INSTANCE.populate(cached_response);INSTANCE.dispatchEvent(SearchResults.LOAD_CACHED,[type,cached_response,search_params]);}
else{if(type==SearchResults.SEARCH_NEW){disablePagination();}else{updatePagination();}
collection.addClass('loading');INSTANCE.dispatchEvent(SearchResults.LOAD_INIT,[type,search_params]);loadbar=SearchLoadBar();var url=URL_SEARCH;if(search_scope==SearchResults.SCOPE_PURCHASED)url=URL_PURCHASED;if(search_scope==SearchResults.SCOPE_PENDING){var artist=$('#pending_scope').val();if(artist){url=URL_PENDING_ARTIST+(artist=='_self'?'':'/'+artist);}else{url=URL_PENDING_INSPECTOR;}}
if(type==SearchResults.SEARCH_NEW&&(search_scope=='free'||search_scope=='browse')){var scope=(search_scope=='free'?'Free':'All'),terms=$('#searchbox input[name="keywords"]').val().split(',').join(' ');VectorStock.track('send','event','Search',terms,scope+' Vectors');}
var showFailMessage=function(response){if(loadbar)loadbar.complete();loadbar=null;showMessage(results_fail);collection.removeClass('loading');pagenumbers.empty();INSTANCE.dispatchEvent(SearchResults.LOAD_FAILED,[response,search_params]);};$.ajax({url:url,data:search_params,type:'GET',xhr:function(){var xhr=new window.XMLHttpRequest();xhr.addEventListener('progress',function(event){if(event.lengthComputable&&loadbar){loadbar.update(event.loaded/event.total);}},false);return xhr;}}).done(function(response){if(!response){showFailMessage(response);return;}
search_cache[search_id]=response;SearchBox.dictionary.update(response);if(search_current==search_id){if(response.is_vector&&response.results.length===0){VectorStock.goToURL(response.altresults.url);return;}
if(loadbar)loadbar.complete();loadbar=null;INSTANCE.populate(response);if(type==SearchResults.SEARCH_NEW){updatePagination(response);}
collection.removeClass('loading');INSTANCE.dispatchEvent(SearchResults.LOAD_COMPLETE,[type,response,search_params]);}}).fail(showFailMessage);}}
function showMessage(content){fs_order.hide();fs_layout.hide();collection.hide();$('.message',scope).remove();scope.addClass('message').append(content);}
INSTANCE.getValue=function(){return search_params;};INSTANCE.setOrder=function(params){search_order=params.order||$('li.selected',fs_order_items).attr('data-value');if(params.keywords.length){if(!order_set){search_order=SearchResults.ORDER_BESTMATCH;}
opt_bestmatch.show();}
else{if(search_order==SearchResults.ORDER_BESTMATCH){search_order=SearchResults.ORDER_TRENDING;order_set=false;}
opt_bestmatch.hide();}
$('li.selected',fs_order_items).removeClass('selected');$('li[data-value="'+search_order+'"]',fs_order_items).addClass('selected');};INSTANCE.search=function(params){INSTANCE.setOrder(params);search_params=$.extend({},params);search_params.page=params.page||1;search_params.order=search_order;search_params.limit=params.limit||INSTANCE.PAGE_LIMIT;search_params.type=(params.type||search_scope);if((search_params.type==SearchResults.SCOPE_FREE&&search_params.categories.length)||(search_params.type==SearchResults.SCOPE_PURCHASED)){search_scope=SearchResults.SCOPE_ALL;search_params.type=SearchResults.SCOPE_ALL;}
performSearch(SearchResults.SEARCH_NEW);};INSTANCE.populate=function(dataset){collection.empty();if(dataset&&dataset.results&&dataset.results.length){var html='',i=dataset.results.length;while(i--){var item='',id=new String(dataset.results[i].id),size=(search_layout==SearchResults.LAYOUT_LARGE)?'medium':'small',title=dataset.results[i].title+' vector'||'',path=title.replace(/[^\d\w\s-]+/g,'').replace(/[\s-]+/g,'-').toLowerCase()+'-'+id,href=(is_pending)?'/upload/'+id:'/royalty-free-vector/'+path,src=VectorStock.imagePath(id,size,is_pending);item+='<li data-vector-id="'+id+'" data-vector-src="'+src+'">';item+='<a href="'+href+'" title="'+title+'">';item+='<span class="title">'+title+'</span>';item+='<span class="image"></span>';item+='</a>';if(is_pending){var flags=dataset.results[i].alert;item+='<div class="info">';item+='<span class="checkbox"></span>';if(flags){item+='<ul>';for(var j=0;j<flags.length;j++){item+='<li title="'+FLAG_TYPES[flags[j]]+' Missing">'+flags[j]+'</li>';}
item+='</ul>';}
item+='</div>';}
item+='</li>';html=item+html;}
collection[0].innerHTML=html;$('.message',scope).remove();scope.removeClass('message')
results_none.remove();fs_order.show();fs_layout.show();collection.show();createVectors();}
else{if(search_params.type===SearchResults.SCOPE_FREE){var params=$.extend({},search_params);params.type=SearchResults.SCOPE_ALL;if(dataset.is_artist){var artist=dataset.is_artist;var i=params.keywords.length;while(i--){if(params.keywords[i]===artist){params.keywords.splice(i,1);break;}}
params.artists.push(artist);}
var data=SearchResultData(params);data.header=data.header.replace(/\bAll /,'');$('p a',results_none).attr('href',data.url);$('p strong',results_none).replaceWith(data.header);showMessage(results_none);}else{showMessage(results_none);}}};INSTANCE.scrollToTop=function(speed,easing){var speed=speed||500,easing=easing||'easeOutExpo',target=0,position=$('body').scrollTop()||$('html').scrollTop();if(position>target){VectorStock.scrollTo(target,speed,easing);}};INSTANCE.setScope=function(scope){search_scope=scope;};init();return INSTANCE;};SearchResults.LOAD_INIT='load_init';SearchResults.LOAD_CACHED='load_cached';SearchResults.LOAD_COMPLETE='load_complete';SearchResults.LOAD_FAILED='load_failed';SearchResults.SCOPE_ALL='all';SearchResults.SCOPE_FREE='free';SearchResults.SCOPE_PENDING='pending';SearchResults.SCOPE_PURCHASED='purchased';SearchResults.SEARCH_NEW='new';SearchResults.SEARCH_PAGE='page';SearchResults.SEARCH_REORDER='reorder';SearchResults.ORDER_BESTMATCH='bestmatch';SearchResults.ORDER_TRENDING='trending';SearchResults.ORDER_LATEST='latest';SearchResults.LAYOUT_SMALL='small';SearchResults.LAYOUT_LARGE='large';;var SearchVector=function(settings){var INSTANCE=VSModule();var LOAD_ATTEMPTS_MAX=10,SCROLL_MARGIN=200;var container,link,preview,image_wrap,image,frame,actions,background,galleries,info;var show_gallery=(settings.gallery===false)?false:VectorStock.isLoggedIn(),show_cart=(settings.cart===false)?false:true,show_download=null,in_cart=false,is_mobile=$('html').hasClass('mobile'),offset_gallery;INSTANCE.item=settings.scope;INSTANCE.left=null;INSTANCE.top=null;INSTANCE.id=null;INSTANCE.title=null;INSTANCE.href=null;INSTANCE.src=null;function init(){container=INSTANCE.item.parent();link=$('a',INSTANCE.item);image_wrap=$('.image',link);image=$('img',link);info=$('.info',INSTANCE.item);INSTANCE.id=parseInt(INSTANCE.item.attr('data-vector-id'));INSTANCE.title=link.attr('title');INSTANCE.href=INSTANCE.title.replace(/[\s]+/g,'-').toLowerCase()+'-'+INSTANCE.id,INSTANCE.size=(settings.layout==SearchResults.LAYOUT_LARGE)?SearchVector.SIZE_MEDIUM:SearchVector.SIZE_SMALL;INSTANCE.src=VectorStock.imagePath(INSTANCE.id,INSTANCE.size,settings.pending);preview=PreviewLink(link,INSTANCE.id,INSTANCE.title,settings.pending);if(INSTANCE.size==SearchVector.SIZE_MEDIUM||is_mobile)preview.disable();if(VectorStock.userData.isInCart(INSTANCE.id)){in_cart=true;}
show_download=VectorStock.userData.hasPurchased(INSTANCE.id);if(!settings.pending&&!is_mobile)buildHighlightFrame();info.on('click',toggleSelect);link.on('click',viewImage);if(image.length){if(image.hasClass('reveal')){onImageLoad();}else{loadImage();}}else{$(window).on('resize scroll',onViewportChange);onViewportChange();}}
function onViewportChange(){var viewport_height=$(window).height(),viewport_top=$(window).scrollTop(),item_top=INSTANCE.item.offset().top,item_height=INSTANCE.item.height();if((item_top<(viewport_height+viewport_top+SCROLL_MARGIN))&&(item_top>(viewport_top-item_height-SCROLL_MARGIN))){loadImage();$(window).off('resize scroll',onViewportChange);}}
function loadImage(){var load_attempts=1;var icon=image_wrap.loadingIcon();function loadAttempt(){var image=new Image();image.onload=onLoad;image.onerror=onError;image.src=INSTANCE.src;}
function onLoad(){icon.remove();image=$('<img src="'+INSTANCE.src+'" alt="'+INSTANCE.title+'">').appendTo(image_wrap);setTimeout(function(){image.addClass('reveal');onImageLoad();},10);}
function onError(){if(load_attempts<LOAD_ATTEMPTS_MAX){var wait=500+Math.round(Math.random()*500);setTimeout(loadAttempt,wait);}else{icon.remove();var icon_broken=$('<span class="icon_broken" />').appendTo(image_wrap);setTimeout(function(){icon_broken.addClass('reveal');},10);}
load_attempts++;}
loadAttempt();}
function onImageLoad(){}
function viewImage(){}
function buildHighlightFrame(){var background=$('<div class="bg" />').appendTo(INSTANCE.item),actions=$('<div class="actions" />').appendTo(background),actions_list=$('<ul />').appendTo(actions);link_similar=$('<span class="link"><em>View </em>Similar Images…</span>').appendTo(actions);link.attr('title','');image.attr('title','');if(show_download){var item_download=$('<li />').appendTo(actions_list),button_download=$('<button type="button">Download</button>').appendTo(item_download);button_download.on('click',function(){VectorStock.downloadVector(INSTANCE.id);});}else{if(show_cart){var item_cart=$('<li />').appendTo(actions_list),button_cart=$('<button type="button"><em>Add to </em>Cart</button>').appendTo(item_cart);function selectCartButton(){button_cart.html('In Cart');item_cart.addClass('selected');}
function unselectCartButton(){button_cart.html('<em>Add to </em>Cart');item_cart.removeClass('selected');}
button_cart.on('click',function(){if(item_cart.hasClass('selected')){unselectCartButton();VectorStock.removeFromCart(INSTANCE.id);}else{selectCartButton();VectorStock.addToCart(INSTANCE.id);}});if(in_cart)selectCartButton();}
if(show_gallery){var item_gallery=$('<li />').appendTo(actions_list),button_gallery=$('<button type="button">Gallery</button>').appendTo(item_gallery);button_gallery.on('click',function(){var gallery_box=new GalleryBox(INSTANCE.id,INSTANCE.title);});}}
link_similar.on('click',function(){VectorStock.search_results.setScope(SearchResults.SCOPE_ALL);VectorStock.search_box.addTag(INSTANCE.id,SearchBoxTag.CONTEXT_SIMILAR,true);VectorStock.search_results.scrollToTop();});}
function toggleSelect(){INSTANCE.item.toggleClass('selected');VectorStock.BarPending.toggle(INSTANCE.id);}
INSTANCE.setSize=function(layout){var size=(layout==SearchResults.LAYOUT_LARGE?SearchVector.SIZE_MEDIUM:SearchVector.SIZE_SMALL);if(INSTANCE.size!==size){settings.layout=layout;INSTANCE.size=size;INSTANCE.src=VectorStock.imagePath(INSTANCE.id,size,settings.pending);image.attr('src',INSTANCE.src);if(layout==SearchResults.LAYOUT_LARGE)preview.disable();else preview.enable();}};init();return INSTANCE;};SearchVector.SIZE_SMALL='small';SearchVector.SIZE_MEDIUM='medium';;VectorStock.imagePath=function(id,size,is_pending){var PATH_LIVE={small:'thumbs',medium:'thumb-large',large:'1000x1000'},PATH_PENDING={small:'112x118',medium:'238x250',large:'380x400'};var id=String(id),size=(size||'small').toLowerCase();var folder=(is_pending?PATH_PENDING[size]:PATH_LIVE[size]),url_path,url_image;if(is_pending){url_path=VectorStock.amazonHost+'/images/'+folder+'/',url_image=id+'.jpg';}
else{var id_str=String(id).substr(id.length-Math.min(4,id.length));while(id_str.length<4)id_str='0'+id_str;url_path=VectorStock.domain+'/i/'+folder+'/'+id_str.substr(0,2)+'/'+id_str.substr(2)+'/',url_image=id+'.jpg';}
return url_path+url_image;};VectorStock.vectorURL=function(vector_id,vector_title,is_pending){var path=(is_pending?'/upload/':'/royalty-free-vector/');if(vector_id){path+=vector_title.replace(/[^\d\w\s-]+/g,'').replace(/[\s-]+/g,'-').toLowerCase()+'-'+vector_id;}else{path+=vector_id;}
return path;};VectorStock.formatCredits=function(source,target,max,min,currency){var max=max||Infinity,min=min||0,currency=(currency===false)?false:true;amount=Number(source.val()),error=true,display=0;if(amount===+amount&&amount===(amount|0)){error=(amount<min||amount>max);display=amount.formatCommas();}
if(currency){display='<small>$</small>'+display+'.00';}
target.html(display);target.parent().toggleClass('error',error);source.parent().toggleClass('error',error);return error;};VectorStock.rgbToHex=function(r,g,b){var componentToHex=function(c){var hex=c.toString(16);return(hex.length==1)?'0'+hex:hex;};return'#'+componentToHex(r)+componentToHex(g)+componentToHex(b);};VectorStock.setupTabs=function(){var selectTab=function(tab_new){if(!tab_new.attr('disabled')){var id_tab=tab_new.attr('data-tab-id');var group=tab_new.closest('.tabs');tab_old=tab_new.siblings('.selected').removeClass('selected'),sec_old=$('section.selected',group).removeClass('selected'),sec_new=$('section[data-tab-id='+id_tab+']',group).addClass('selected');tab_new.addClass('selected');group.trigger('switch',[sec_new,sec_old]);}};$('.tabs').each(function(){$('> nav li',this).on('click',function(){selectTab($(this));}).on('selectTab',function(){selectTab($(this));});});};VectorStock.setupFormElements=function(){var doc=$(document);doc.on('mouseup','.checkbox',function(){$(this).toggleClass('checked');});doc.on('disable','button',function(event,is_loading,loading_label){var button=$(this),is_master=button.hasClass('master'),value_orig,label_orig,loading_icon;button.prop('disabled',true);if(is_loading){if(is_master){var title=$('.title',button),value=$('.value',button);var wrap=$('<span class="wrapper" />').hide();value.wrapInner(wrap);label_orig=title.text();title.text(loading_label||'LOADING...');loading_icon=value.loadingIcon('medium');}
else{value_orig=button.text();button.get(0).lastChild.nodeValue=loading_label||value_orig;loading_icon=button.loadingIcon('small');button.addClass('loading');}}
$(this).one('enable',function(){button.prop('disabled',false);if(loading_icon){if(is_master){$('.wrapper',value).contents().unwrap();title.text(label_orig);}
else{button.text(value_orig);button.removeClass('loading');}
loading_icon.remove();}});});};VectorStock.setupSharingButtons=function(){if($('a.addthis_button').length){head.js(VectorStock.js.addthis,function(){if(!window.addthis||!addthis.addEventListener)return;addthis.addEventListener('addthis.menu.share',function(event){VectorStock.track('send','event','Share',event.data.service.toTitleCase()+' (AddThis)',window.location.pathname);});});}
$('button.smedia').each(function(){var button=$(this),group=button.closest('.share'),tally=parseInt(button.attr('data-tally')),type=button.hasClass('googleplus')?'googleplus':button.hasClass('facebook')?'facebook':button.hasClass('twitter')?'twitter':button.hasClass('pinterest')?'pinterest':button.hasClass('linkedin')?'linkedin':'';var popupWindow=function(url,width,height){var popup=window.open(url,'share-dialog-'+type,'width='+width+',height='+height+',resizable=1,toolbar=0,menubar=0,status=0,location=0');if(!button.data('static')){var popup_int=setInterval(function(){if(popup.closed){checkTally();clearInterval(popup_int);}},5000);}};var updateTally=function(value){if(group.data('static'))return;tally=value;$('button.smedia.'+type).each(function(){$(this).attr('data-tally',tally);$('.tally',this).html(formatTally(tally));});};var formatTally=function(tally){if(tally<1000){return tally+'';}else if(tally<10000){return(Math.round(tally/100)/10)+'k';}else{return Math.round(tally/1000)+'k';}};var checkTally=function(){};button.on('click',function(){var url=$('meta[property="og:url"]').attr('content'),img=$('meta[property="og:image"]').attr('content'),title=$('meta[property="og:title"]').attr('content'),desc=$('meta[property="og:description"]').attr('content');switch(type){case'googleplus':var params='url='+encodeURIComponent(url);popupWindow('https://plus.google.com/share?'+params,600,450);type='Google';break;case'facebook':var params=['s=100','p[url]='+encodeURIComponent(url),'p[images][0]='+encodeURIComponent(img),'p[title]='+escape('VectorStock: '+title),'p[summary]='+escape(desc)];popupWindow('http://www.facebook.com/sharer.php?'+params.join('&'),626,326);break;case'twitter':var params='text='+escape(title)+escape(" from VectorStock:\n")+encodeURIComponent(url);popupWindow('http://twitter.com/intent/tweet?'+params,600,256);break;}
VectorStock.trackAction('Share',{type:'Custom',platform:type.toTitleCase()});VectorStock.track('send','event','Share',type.toTitleCase()+' (Custom)',window.location.pathname);});});};VectorStock.setupFacebookLike=function(){if(!$('#fb-root').length){$('body').append('<div id="fb-root" />');head.js(VectorStock.js.facebook);}};VectorStock.setupCompetition=function(){var element=$('#competition');if(element.length){Competition(element);}};VectorStock.trackBehaviour=function(){(function(d,w,c){(w[c]=w[c]||[]).push(function(){try{w.yaCounter32721775=new Ya.Metrika({id:32721775,clickmap:true,trackLinks:true,accurateTrackBounce:true,webvisor:true});}catch(e){}});head.load('https://mc.yandex.ru/metrika/watch.js');})(document,window,'yandex_metrika_callbacks');};VectorStock.goToURL=function(url,replace){try{var anchor=document.createElement('a');anchor.href=url;var pathname=(anchor.pathname[0]=='/'?'':'/')+anchor.pathname;var event=$.Event('redirect');$(window).trigger(event,[url,pathname]);if(!event.isDefaultPrevented()){if(replace)window.location.replace(url);else window.location.assign(url);}}catch(error){VectorStock.track('send','event','Error (JS)','CustomError: Go to URL failed',url);}};VectorStock.preloadImages=function(images){var img=new Image();var i=images.length;while(i--){img.src=images[i];}};VectorStock.addToCart=function(vector_id,license,callback){if(!VectorStock.isNumeric(vector_id))return;if(typeof license==='function'){callback=license;license=null;}
var items=VectorStock.userData.addToCart(vector_id);VectorStock.setCartTally(items);var url='/api/cart/add/'+vector_id+(license?'/'+license:'');$.get(url,function(response){VectorStock.setCartTally(response.cart_total);if(callback)callback(response);},'json');VectorStock.trackAction('Add to Cart',{id:vector_id,license:license});};VectorStock.removeFromCart=function(vector_id,callback){if(!VectorStock.isNumeric(vector_id))return;var items=VectorStock.userData.removeFromCart(vector_id);VectorStock.setCartTally(items);$.get('/api/cart/remove/'+vector_id,function(response){VectorStock.setCartTally(response.cart_total);if(callback)callback(response);},'json');};VectorStock.emptyCart=function(callback){VectorStock.userData.emptyCart();VectorStock.setCartTally(0);$.get('/api/cart/empty',function(response){if(callback)callback(response);},'json');};VectorStock.setCartTally=function(tally,callback){if(!tally&&tally!==0)return;var item=$('#sb_account li[data-id=cart]');if(item.length===0){$('#nav_sidebar > nav li[data-tab-id=login]').trigger('selectTab');item=$('#sb_login li[data-id=cart]');if(item.length==0){var extras=$('<div class="extras" />').appendTo('#sb_login'),header=$('<h6>Account</h6>').appendTo(extras),list=$('<ul />').appendTo(extras);item=$('<li data-id="cart"><a href="/cart"><span class="title">Cart</span><span class="value empty"><var data-value="0">0</var></span><span class="icon"></span></a></li>').appendTo(list);extras.hide().slideDown(500,'easeOutCubic');}}
item.trigger('setTally',tally);item=$('#mobilenav-menu li[data-id="cart"]');tally=(tally&&tally.formatCommas?tally.formatCommas():tally);if(item.length===0){var list=$('#mobilenav-menu ul');item=$('<li data-id="cart"><a href="/cart">Cart <em></em></a></li>').appendTo(list);}
$('em',item).text('('+tally+')');};VectorStock.updateTally=function(type,offset){$('#sb_account li[data-id='+type+']').trigger('updateTally',offset);};VectorStock.setTally=function(type,tally){$('#sb_account li[data-id='+type+']').trigger('setTally',tally);};VectorStock.updateFollowingCount=function(offset){var item_sb=$('#sb_account li[data-id="following"]'),item_mb=$('#mobilenav-menu li[data-id="artists"] em'),tally=parseInt($('a .value var',item_sb).data('value'))+offset;item_sb.trigger('setTally',tally);if(item_mb.length)item_mb.html('('+tally+')');}
VectorStock.addToFollowing=function(artist_name){if(artist_name){VectorStock.updateFollowingCount(1);$.put('/api/following/'+artist_name);VectorStock.trackAction('Add to Following',{artist:artist_name});}};VectorStock.removeFromFollowing=function(artist_name){if(artist_name){VectorStock.updateFollowingCount(-1);$.delete('/api/following/'+artist_name);}};VectorStock.isLoggedIn=function(){return $('#nav_sidebar #sb_account').length>0;};VectorStock.trackPurchase=function(transaction_type,transaction_id,transaction_cost,user_email,user_country,provider_type,provider_id){var is_credits=(transaction_type.toLowerCase()=='credits');var transaction_company='VectorStock Media',transaction_tax='na',transaction_name=provider_type+' '+(is_credits?'Credit':'Subscription')+' Purchase',transaction_category=(is_credits?'VS Currency':'VS Subscription'),transaction_price=(is_credits?'1':transaction_cost),transaction_quantity=(is_credits?transaction_cost:'1');try{ga('require','ecommerce');ga('ecommerce:addTransaction',{id:transaction_id,affiliation:transaction_company,revenue:transaction_cost,shipping:user_email,tax:transaction_tax});ga('ecommerce:addItem',{id:transaction_id,name:transaction_name,sku:provider_id,category:transaction_category,price:transaction_price,quantity:transaction_quantity});ga('ecommerce:send');}
catch(err){if(window.console&window.console.log)console.log(err);}};VectorStock.showBrowserMessage=function(){if(head.browser.obsolete){var browsername=head.browser.name,browserline=(browsername=='Unknown')?'old browser version':'old version of '+browsername,container=$('<div id="browser_message"></div>').prependTo('body'),link=$('<a href="http://www.updateyourbrowser.net/" target="_blank"></a>').appendTo(container),header=$('<span class="br_header">Your browser is out of date!</span>').appendTo(link),outline=$('<span class="br_outline">You\'re using an '+browserline+'. For the best experience, <strong>please update your browser.</strong></span>').appendTo(link),button=$('<button type="button">Close</button>').appendTo(container);button.on('click',function(){container.remove();});container.hide().slideDown(500,'easeOutCubic');}};VectorStock.setupPlaceholderSupport=function(){if(!('placeholder'in document.createElement('input'))){var selector='input, textarea';$(document).on('focus',selector,function(){if($(this).isEmpty()){$(this).removeClass('empty').val('');}}).on('blur',selector,function(){if($(this).isEmpty()){var placeholder=$(this).attr('placeholder')||'';$(this).removeClass('empty').val(placeholder);}});$(selector).each(function(){var placeholder=$(this).attr('placeholder')||'';if($(this).val()==''&&placeholder!=''){$(this).addClass('empty').val(placeholder);}
else if($(this).val()==placeholder){$(this).addClass('empty');}});}};VectorStock.scrollTo=function(target,duration,easing,callback){var y_target=(isNaN(target))?target.offset().top:target,duration=duration||500,callback=(typeof(easing)=='function')?easing:callback,easing=easing||'easeInOutQuad',doc_height=$(document).height(),win_height=$(window).height();if(doc_height>win_height){if((y_target+win_height)>doc_height){y_target=doc_height-win_height;}
var cancelScroll=function(){$('html, body').stop();$(window).off('mousewheel',cancelScroll);if(callback)callback();};$(window).on('mousewheel',cancelScroll);$('html, body').animate({scrollTop:y_target},duration,easing,cancelScroll);}};VectorStock.downloadVector=function(vector_id){$.get('/api/vector/download/'+vector_id,function(response){if(response.success==1){VectorStock.goToURL(response.url);}},'json');};VectorStock.sanitizeInput=function(value){if(typeof value=='string')return value;else return $(value).text();};VectorStock.trackConversion=function(settings,callback){function track(){window.google_conversion_id=1056033416;window.google_conversion_format='3';window.google_remarketing_only=false;if(settings){for(var setting in settings){window[setting]=settings[setting];}}
if(window.google_trackConversion){var handler=(callback?{onload_callback:callback}:undefined);window.google_trackConversion(handler);}}
if(window.google_trackConversion){track();}else{head.js('//www.googleadservices.com/pagead/conversion_async.js',track);}};VectorStock.isNumeric=function(value){return!isNaN(parseFloat(value))&&isFinite(value);};;VectorStock.setupHeader=function(){$('#searchbox').each(function(){VectorStock.search_box=SearchBox($(this));VectorStock.search_box.on('change',function(params){if(VectorStock.search_box.mode==SearchBox.MODE_STATIC){var data=new SearchResultData(params);VectorStock.goToURL(data.url);}});var search_type=$('#search_type').val();if(search_type!==SearchResultData.TYPE_BROWSE&&search_type!==SearchResultData.TYPE_FREE){VectorStock.search_box.setMode(SearchBox.MODE_STATIC);}});var menu_mobile=new MenuMobile();};;VectorStock.setupSidebar=function(){$('#nav_sidebar').each(function(){var COPY_REMINDER='Click here if you&rsquo;d like a reminder...',COPY_USERNAME='Missing username...',COPY_PASSWORD='Missing password...';var scope=$(this);var setTally=function(item,value_new){var offset=30,duration=900,easing='easeOutExpo';var container=$('.value',item),tally_old=$('var',container).last(),value_old=parseInt(tally_old.attr('data-value'));value_new=Math.max(value_new,0);if(value_new==value_old)return;var use_ticker=item.closest('nav').hasClass('primary'),direction=(value_new>value_old)?1:-1;offset=offset*direction;if(use_ticker){var tally_new=$('<var>'+value_new.formatCommas(true)+'</var>').attr('data-value',value_new).appendTo(container);item.removeClass('unhighlight').addClass('highlight');container.toggleClass('empty',(value_new==0));tally_new.css({marginTop:(offset*-1),opacity:0}).animate({marginTop:0,opacity:1},duration,easing,function(){$(this).css({marginTop:'',opacity:''});});tally_old.stop().animate({opacity:0},duration,easing,function(){$(this).remove();item.removeClass('highlight').addClass('unhighlight');});}
else{tally_old.attr('data-value',value_new).text(value_new);item.stop().css({opacity:0}).animate({opacity:1},500,'easeOutQuad',function(){item.css({opacity:''});});}
item.toggleClass('empty',(value_new==0));if(value_new==0&&!$('.alert',item).length){$('<span class="alert" />').prependTo($('a',item));}};$('.textfield',scope).each(function(){var textfield=$(this),fieldset_tf=textfield.closest('fieldset'),input=$('input',textfield);textfield.on('click',function(){input.focus();});input.on('focus',function(){if(fieldset_tf)fieldset_tf.addClass('focus');}).on('blur',function(){if(fieldset_tf)fieldset_tf.removeClass('focus');});});$('.checkbox label',scope).on('mouseup',function(){$(this).toggleClass('selected');});$('#sb_signup',scope).each(function(){var tab=$(this);$('.footer button',tab).on('click',function(){VectorStock.goToURL('/signup');});});$('#sb_login',scope).each(function(){var tab=$(this),form=$('form',tab),login=$('> button',form);var validate=function(event){var username=$('#vs_username',tab).val(),password=$('#vs_password',tab).val(),remember=$('#vs_remember',tab).is(':checked'),vs_check=$('#ver_check').val();if(username==''){showMessage(COPY_USERNAME);}else if(password==''){showMessage(COPY_PASSWORD,true);}
else{var container=$('.message',tab);if(container.length){container.stop().animate({height:0},300,'easeOutCubic');}
login.trigger('disable',[true,'Checking...']);$.ajax({type:'POST',url:'/api/json/login',data:{login_user:username,login_password:password,login_remember:remember},success:function(response,textStatus,xhr){if(response.success==1){VectorStock.userData.setProfile(response.profile);if(response.redirect){VectorStock.goToURL(response.redirect);}else{window.location.reload();}}
else{if(response.message){showMessage(response.message,(response.error!=='DISABLED'));}else{showMessage('Unknown server issue - Please try again later',true);var log={username:username,ver_check:vs_check,status:textStatus,code:xhr.status,response:JSON.stringify(response),headers:xhr.getAllResponseHeaders()};if(response.message!==undefined)log.message=response.message;VectorStock.track('send','event','Error (JS)','CustomError: Login issue (Success)',JSON.stringify(log));}
login.trigger('enable');}},error:function(xhr,textStatus,errorThrown){showMessage('Connection failed - Please try again later',true);var log={username:username,ver_check:vs_check,status:textStatus,code:xhr.status,error:errorThrown,headers:xhr.getAllResponseHeaders()};VectorStock.track('send','event','Error (JS)','CustomError: Login issue (Error)',JSON.stringify(log));login.trigger('enable');}});}
event.preventDefault();event.stopPropagation();};var showMessage=function(message,forgotten){var container=$('.message',tab);login.trigger('enable');if(container.length==0){var container=$('<div class="message" />'),wrap1=$('<div class="wrap1" />').appendTo(container),wrap2=$('<div class="wrap2" />').appendTo(wrap1);login.before(container);}
var height_a=container.height();$('.wrap2',container).empty().append('<p>'+message+'</p>');if(forgotten){$('.wrap2',container).append('<p><a href="/request/password">'+COPY_REMINDER+'</a></p>');}
$('p',container).css({top:15,opacity:0}).animate({top:0,opacity:1},800,'easeOutQuint');var height_b=container.css({height:''}).height();container.stop().css({height:height_a}).animate({height:height_b},400,'easeOutCubic',function(){container.css({height:''});});};var matchAutoFillColors=function(){var filled={};try{$('input:-webkit-autofill',form).each(function(){filled[$(this).attr('id')]=true;});}catch(err){}
$('input',form).each(function(){var color_txt='',color_bg='';if(filled[$(this).attr('id')]){color_txt=$(this).css('color');color_bg=$(this).css('backgroundColor');}
$(this).css({color:color_txt});$(this).parent().css({backgroundColor:color_bg});});};$('button.forgot',tab).on('click',function(){VectorStock.goToURL('/request/password');});$('input',form).on('blur',matchAutoFillColors);setTimeout(matchAutoFillColors,500);login.on('click',validate);$('.alternatives li.fb',tab).each(function(){var item=$(this),link=$('a',item),title=$('.title',link);link.on('click',function(){item.addClass('loading');title.text('Connecting...').css({marginLeft:-10,opacity:0.5}).animate({marginLeft:0,opacity:1},350,'easeOutCubic');var icon=link.loadingIcon('small');if(item.hasClass('gp')){}
else if(item.hasClass('fb')){$.post('/api/json/fblogin',function(response){if(response.success==1){VectorStock.userData.destroy();VectorStock.goToURL(response.url);}},'json');}
return false;});});tab.on('setTally','.extras li',function(event,value_new){setTally($(this),value_new);}).on('updateTally','.extras li',function(event,value_offset){var value=parseInt($('var',this).attr('data-value'))+value_offset;setTally($(this),value);});});$('#sb_account',scope).each(function(){var tab=$(this),form=$('form',tab),logout=$('button',tab);$('li',tab).on('setTally',function(event,value_new){setTally($(this),value_new);}).on('updateTally',function(event,value_offset){var value=parseInt($('var',this).attr('data-value'))+value_offset;setTally($(this),value);});logout.on('click',function(){VectorStock.userData.destroy();form.submit();});});});};;VectorStock.setupFooter=function(){var sel_legals=$('#legals');if(sel_legals.length){sel_legals.on('change',function(){var path=$('option:checked',this).val();if(path)VectorStock.goToURL(path);});if(sel_legals.dropdown){sel_legals.dropdown({theme:'dark'});}}};;$(function(){VectorStock.userData=UserData();VectorStock.setupHeader();VectorStock.setupSidebar();VectorStock.setupFooter();VectorStock.setupTabs();VectorStock.setupFormElements();VectorStock.setupCompetition();VectorStock.setupPlaceholderSupport();VectorStock.showBrowserMessage();});