var Tooltip=function(pos_left,pos_top,message){var INSTANCE=new VSModule();var PADDING_TOP=13;var container;function init(){var paragraph,tail;container=$('<div id="vs_tooltip" />').css({left:pos_left,top:pos_top+PADDING_TOP}).appendTo('body');paragraph=$('<p />').html(message).appendTo(container);tail=$('<span class="tail" />').appendTo(container);if(Tooltip.current)Tooltip.current.remove();setTimeout(function(){Tooltip.current=INSTANCE;container.addClass('reveal');});}
INSTANCE.remove=function(){container.addClass('conceal');setTimeout(function(){container.remove();},500);};init();return INSTANCE;};Tooltip.galleries=null;VectorStock.LazyImage=function(container,threshold){var INSTANCE=new VSModule();var windowframe=$(window);INSTANCE.anchor=$('a',container);INSTANCE.src=container.data('src');INSTANCE.id=(INSTANCE.src.match(/(\d+)\.(jpe?g|png)$/)||[null,null])[1];function init(){threshold=(threshold||0);windowframe.on('scroll resize',checkVisibility);checkVisibility();}
function checkVisibility(){if(container.is(':hidden'))return;var frame_top=windowframe.scrollTop(),frame_bottom=frame_top+windowframe.height(),item_top=container.offset().top,item_bottom=item_top+container.height();var on_screen=(item_bottom>=(frame_top-threshold))&&(item_top<=(frame_bottom+threshold));if(on_screen){loadImage();windowframe.off('scroll resize',checkVisibility);}}
function loadImage(){var icon=INSTANCE.anchor.loadingIcon(),img=new Image();img.onload=function(){$(img).appendTo(INSTANCE.anchor);setTimeout(function(){container.addClass('reveal');icon.remove();INSTANCE.dispatchEvent('loaded',[INSTANCE.id]);},10);};img.onerror=function(){container.addClass('error');icon.remove();$('<span class="icon">!</span>').appendTo(INSTANCE.anchor);INSTANCE.dispatchEvent('error');};img.src=INSTANCE.src;}
init();return INSTANCE;};var VectorOptions=function(container,vector_details,account_details){var INSTANCE=new VSModule();INSTANCE.license=null;INSTANCE.payment=null;var area_help,area_options,area_license,opts_license,area_payment_standard,area_payment_expanded,opts_payment_standard,opts_payment_expanded,area_download,actions_download,but_download,but_download_icon,but_download_label,but_dropbox,but_dropbox_label;var area_payment={},opts_payment={};area_options=$('.options',container);area_help=$('.option h6 a',area_options);area_license=$('.option[data-type="license"]',area_options);opts_license=new VectorStock.FieldRadioboxes($('.radgroup label',area_license));area_payment_standard=$('.option[data-type="payment"][data-license="standard"]',area_options);area_payment_expanded=$('.option[data-type="payment"][data-license="expanded"]',area_options);if(area_payment_standard.length)
opts_payment_standard=new VectorStock.FieldRadioboxes($('.radgroup[data-license="standard"] label',area_payment_standard));if(area_payment_expanded.length)
opts_payment_expanded=new VectorStock.FieldRadioboxes($('.radgroup[data-license="expanded"] label',area_payment_expanded));area_download=$('.download',container);actions_download=$('.actions',area_download);but_dropbox=$('button[data-type="dropbox"]',actions_download);but_dropbox_label=$('.label',but_dropbox);but_download=$('button[data-action="download"]',area_download);but_download_icon=$('.icon',but_download);but_download_label=$('.label',but_download);area_payment[VectorOptions.LICENSE_STANDARD]=area_payment_standard;area_payment[VectorOptions.LICENSE_EXPANDED]=area_payment_expanded;opts_payment[VectorOptions.LICENSE_STANDARD]=opts_payment_standard;opts_payment[VectorOptions.LICENSE_EXPANDED]=opts_payment_expanded;var opts_heights={},credits_standard=(area_payment_standard.length?parseInt(area_payment_standard.data('credits')):0),credits_expanded=(area_payment_expanded.length?parseInt(area_payment_expanded.data('credits')):0),dropbox_action=but_dropbox.data('action'),timeout_animate;function init(){INSTANCE.license=opts_license.value;INSTANCE.payment=(opts_payment[INSTANCE.license]?opts_payment[INSTANCE.license].value:null);if(container.attr('data-license')!==opts_license.value){onLicenseChange();}
area_help.on('mouseover',showTooltip);opts_license.on('change',onLicenseChange);if(opts_payment_standard){opts_payment_standard.on('change',onPaymentChange);}
if(opts_payment_expanded){opts_payment_expanded.on('change',onPaymentChange);}
but_download.on('click',attemptDownload);but_dropbox.on('click',onClickDropbox);if(window.location.search.search(/dropbox=1/i)>=0){var is_synchable=(vector_details.license_status||INSTANCE.license==VectorOptions.LICENSE_FREE),has_dropbox_token=dropbox_action=='save';if(is_synchable&&has_dropbox_token){saveToDropbox();}}}
function showTooltip(){if($('html').hasClass('no-mobile')){var scope=$(this).closest('.option').addClass('hover'),help=$('.help',scope).show();function hideTooltip(){scope.removeClass('hover');help.removeClass('reveal').hide();$(this).off('mouseout',hideTooltip);$('body').off('click',hideTooltip);}
setTimeout(function(){help.addClass('reveal');},25);$(this).on('mouseout',hideTooltip);$('body').on('click',hideTooltip);}}
function onLicenseChange(){var license=opts_license.value;container.attr('data-license',license);area_license.attr('data-license',license);updateDownloadButtonLabel();INSTANCE.license=license;onPaymentChange();INSTANCE.dispatchEvent('change_license',[INSTANCE.license]);}
function onPaymentChange(){if(opts_payment_expanded){if(INSTANCE.license==VectorOptions.LICENSE_STANDARD){opts_payment_expanded.set(opts_payment_standard.value,true);}else if(INSTANCE.license==VectorOptions.LICENSE_EXPANDED){opts_payment_standard.set(opts_payment_expanded.value,true);}}
INSTANCE.payment=(opts_payment[INSTANCE.license]?opts_payment[INSTANCE.license].value:null);INSTANCE.dispatchEvent('change_payment',[INSTANCE.payment]);}
function updateDownloadButtonLabel(){var license=opts_license.value,label=VectorOptions.BUTTON_LABEL_BUY;if(account_details.is_artist){label=VectorOptions.BUTTON_LABEL_DOWNLOAD;}else if(license==VectorOptions.LICENSE_FREE){label=VectorOptions.BUTTON_LABEL_FREE;}else if(vector_details.license_status==license||vector_details.license_status==VectorOptions.LICENSE_EXPANDED){label=VectorOptions.BUTTON_LABEL_DOWNLOAD;}
but_download_label.text(label);}
function attemptDownload(){var params=[INSTANCE.license,INSTANCE.payment];if(INSTANCE.payment==VectorOptions.PAYMENT_CREDITS){params.push(INSTANCE.license==VectorOptions.LICENSE_STANDARD?credits_standard:credits_expanded);}
INSTANCE.dispatchEvent('download',params);}
function onClickDropbox(){if(dropbox_action=='connect'){getDropboxToken();}else{saveToDropbox();}}
function getDropboxToken(){var auth_url='/dropbox/redirect.php?',auth_params={url:window.location.protocol+'//'+window.location.host+window.location.pathname},query_str=$.param(auth_params);VectorStock.goToURL('/api/dropbox/redirect?'+query_str);}
function saveToDropbox(){var label_text=but_dropbox_label.text();but_dropbox.attr('data-status','loading').prop('disabled',true);but_dropbox_label.text('Connecting to Dropbox…');$.get('/api/dropbox/save/'+vector_details.id).done(function(response){if(response.success==1){but_dropbox.attr('data-status','complete');but_dropbox_label.text('Vector File has been saved!');setTimeout(function(){but_dropbox.addClass('reveal');},25);VectorStock.trackAction('Save to Dropbox',{id:vector_details.id});VectorStock.track('send','event','Download','Dropbox Sync','Vector: '+vector_details.id,0);}
else{if(response.error==VectorOptions.DROPBOX_ERROR_TOKEN){getDropboxToken();}
else{but_dropbox.attr('data-status','error');but_dropbox_label.text('Error - '+response.message);setTimeout(function(){but_dropbox.addClass('reveal');},25);VectorStock.track('send','event','Error (User)','Dropbox Sync','Vector: '+vector_details.id,0);}}}).fail(function(event){icon_loading.remove();but_dropbox.prop('disabled',false);but_dropbox_label.text(label_text);});}
INSTANCE.disableButton=function(label){but_download.prop('disabled',true);but_download_icon.loadingIcon();but_download_label.text(label);};INSTANCE.enableButton=function(){but_download.prop('disabled',false);but_download_icon.empty();updateDownloadButtonLabel();};INSTANCE.setPurchased=function(license){container.attr('data-status',license);if(license==VectorOptions.LICENSE_STANDARD){credits_expanded=credits_expanded-credits_standard;area_payment_expanded.attr('data-credits',credits_expanded);$('label[for="f_payment_expanded_credits"] .value var',area_payment_expanded).text(credits_expanded);}};INSTANCE.triggerDownload=function(){area_download.addClass('downloading');setTimeout(function(){area_download.removeClass('downloading');},850);};init();return INSTANCE;};VectorOptions.LICENSE_FREE='free';VectorOptions.LICENSE_STANDARD='standard';VectorOptions.LICENSE_EXPANDED='expanded';VectorOptions.PAYMENT_FEE='fee';VectorOptions.PAYMENT_CREDITS='credits';VectorOptions.PAYMENT_SUBSCRIPTION='subscription';VectorOptions.BUTTON_LABEL_FREE='Free Download';VectorOptions.BUTTON_LABEL_BUY='Download';VectorOptions.BUTTON_LABEL_DOWNLOAD='Download';VectorOptions.DROPBOX_ERROR_UNPAID='not_purchased';VectorOptions.DROPBOX_ERROR_TOKEN='invalid_access_token';var VectorImage=function(container,vector_details,account_details){var INSTANCE=new VSModule();var img_high=$('.highres',container),img_low=$('.lowres',container),area_panels=$('.panels',container),but_pinterest=$('.pinterest button',area_panels),but_facebook=$('.facebook button',area_panels),but_twitter=$('.twitter button',area_panels),but_composite=$('.composite button[data-action="download"]',area_panels);var img_path=vector_details.url.replace(/https?:\/\/[^\/]+/i,''),src_high=img_high.data('src');function init(){var icon=container.loadingIcon('large');var img=new Image();img.onload=function(){$(img).appendTo(img_high);setTimeout(function(){container.addClass('reveal');icon.remove();},10);};img.onerror=function(event){$('<div><p>High-res image couldn’t load</p></div>').appendTo(img_low);icon.remove();setTimeout(function(){container.addClass('error');},10);};img.src=src_high;container.on('click',onClickImage);but_pinterest.on('click',shareOnPinterest);but_facebook.on('click',shareOnFacebook);but_twitter.on('click',shareOnTwitter);but_composite.on('click',downloadComposite);}
function onClickImage(event){if(area_panels.length&&event.target!==area_panels[0])return;INSTANCE.dispatchEvent('click');}
function popupWindow(url,name,width,height){var name=(name||''),width=(width||400),height=(height||300),left=0,top=0;var win_left=(window.screenX||window.screenLeft),win_top=(window.screenY||window.screenTop),win_width=(window.outerWidth||document.documentElement.clientWidth),win_height=(window.outerHeight||document.documentElement.clientHeight-22);left=Math.round(win_left+(win_width-width)/2);top=Math.round(win_top+(win_height-height)/2.5);var win_popup=window.open(url,name,'scrollbars=no,menubar=no,resizable=yes,toolbar=no,location=no,status=yes,left='+left+",top="+top+",width="+width+",height="+height);win_popup.focus();return win_popup;}
function shareOnPinterest(){var url_share=vector_details.url+'?utm_source=Pinterest';url_share+='&utm_medium=VectorStock Social Share';url_share+='&utm_campaign=Vector Social Share';url_share+='&utm_content='+vector_details.title;var url_pinterest='https://www.pinterest.com/pin/create/button/?';url_pinterest+='media='+encodeURIComponent(vector_details.media);url_pinterest+='&description='+encodeURIComponent(vector_details.description);url_pinterest+='&url='+encodeURIComponent(url_share);VectorStock.track('send','event','Share','Pinterest',img_path);popupWindow(url_pinterest,'SharePinterest',766,703);}
function shareOnFacebook(){var url_share=vector_details.url+'?utm_source=Facebook';url_share+='&utm_medium=VectorStock Social Share';url_share+='&utm_campaign=Vector Social Share';url_share+='&utm_content='+vector_details.title;var url_facebook='https://www.facebook.com/dialog/share?';url_facebook+='app_id=241100862642313';url_facebook+='&display=popup';url_facebook+='&href='+encodeURIComponent(vector_details.url);url_facebook+='&redirect_uri='+encodeURIComponent(url_share);VectorStock.track('send','event','Share','Facebook',img_path);popupWindow(url_facebook,'ShareFacebook',555,469);}
function shareOnTwitter(){var url_twitter='https://twitter.com/intent/tweet?';url_twitter+='text='+encodeURIComponent(vector_details.title);url_twitter+='&url='+encodeURIComponent(vector_details.url);VectorStock.track('send','event','Share','Twitter',img_path);popupWindow(url_twitter,'ShareTwitter',550,300);}
function downloadComposite(){window.location=src_high+'?download=1';}
init();return INSTANCE;};var VectorAttribution=function(vector_id,vector_url,vector_title){var INSTANCE=new VSModule();var url_field,url_field_input,url_field_button;var key_command_pressed=false,text_to_copy,copy_action;function init(){var container,attr_url,url_steps,url_icon,url_title,url_copy;container=$('<section id="license_attribution" />').insertAfter('body > header');attr_url=$('<div class="attr_url" />').appendTo(container);url_steps=$('<div />').appendTo(attr_url);url_icon=$('<span class="icon"></span>').appendTo(url_steps);url_title=$('<h6>Want FREE Standard + Expanded licenses usage?</h6>').appendTo(url_steps);url_copy=$('<p>Just copy-paste this link into your page to <a href="/faq/members/free-vector-attribution">credit the&nbsp;author</a>:</p>').appendTo(url_steps);url_field=$('<fieldset />').appendTo(attr_url);text_to_copy='<a href=&quot;'+vector_url+'&quot; target=&quot;_blank&quot;>'+vector_title+' at VectorStock</a>';url_field_input=$('<input type="text" value="'+text_to_copy+'">').appendTo(url_field);url_field_button=$('<button type="button">Copy</button>').appendTo(url_field);url_field_input.on('copy',trackCopyAction);try{if(document.queryCommandSupported('copy')){addCopyFunctionality();}}catch(e){}
var full_height=container.outerHeight();container.css({height:10});setTimeout(function(){container.addClass('animating').css({height:full_height});setTimeout(function(){container.removeClass('animating').css({height:''});},1100);},20);var pos_target=container.offset().top,pos_window=$(window).scrollTop();if(pos_target<pos_window){VectorStock.scrollTo(container,250,'easeOutCubic');}}
function addCopyFunctionality(){url_field.addClass('copy_support');url_field_input.on('focus',selectURL);url_field_button.on('mousedown',highlightInput).on('mouseup',unhighlightInput).on('click',copyURLToClipboard);}
function selectURL(){setTimeout(function(){url_field_input.select();},10);}
function highlightInput(){url_field.addClass('highlight');}
function unhighlightInput(){url_field.removeClass('highlight');}
function copyURLToClipboard(){try{url_field_input.select();if(document.execCommand('copy')){var offset=url_field_button.offset(),pos_left=offset.left+(url_field_button.width()/2),pos_top=offset.top+url_field_button.height();var tooltip=new Tooltip(pos_left,pos_top,'Copied!');setTimeout(function(){tooltip.remove();},750);}else{copyURLToClipboardBackup();}}catch(err){copyURLToClipboardBackup();}}
function copyURLToClipboardBackup(){trackCopyAction();window.prompt('Copy failed - try copying here instead:',url_field_input.val());}
function trackCopyAction(){if(!copy_action){VectorStock.track('send','event','Action','Copy Vector URL','#'+vector_id+' '+vector_title,0);copy_action=true;}}
init();return INSTANCE;};$(function(){var COST_FEE={standard:12.99,expanded:29.99};var IMAGE_MIN_HEIGHT=500,IMAGE_MAX_SIDE=1000;var asset=$('#vs-asset'),asset_aside=$('.aside',asset),asset_aside_figure=$('figure',asset_aside),asset_form=$('form',asset),asset_image=$('.image',asset),asset_figure=$('figure',asset_image),asset_details=$('.details',asset),asset_options=$('.options',asset_details),but_cart=$('button[data-action="cart"]',asset_options),but_gallery=$('button[data-action="gallery"]',asset_options),related=$('#vs-related'),attribution;var vector={id:parseInt($('input[id="vector_id"]',asset_form).val()),title:$('input[id="vector_title"]',asset_form).val(),description:$('input[id="vector_description"]',asset_form).val(),url:$('input[id="vector_url"]',asset_form).val(),media:$('input[id="vector_media"]',asset_form).val(),ratio:parseFloat($('input[id="vector_ratio"]',asset_form).val()),license_status:$('input[id="vector_license_status"]',asset_form).val(),artist:$('input[id="artist_name"]',asset_form).val()};var account={is_artist:(asset_form.data('artist')=='1'),is_owner:(asset_form.data('owner')=='1'),logged_in:($('input[id="account_user"]',asset_form).val()=='1'),credits:(parseInt($('input[id="account_credits"]',asset_form).val())||0),downloads:(parseInt($('input[id="account_downloads"]',asset_form).val())||0)};account.downloads=(account.downloads==''?false:parseInt(account.downloads));var vector_options=new VectorOptions(asset_form,vector,account),image_desktop=new VectorImage(asset_figure,vector,account),image_mobile=new VectorImage(asset_aside_figure,vector,account);var related_viewed=[];var area_min_height=parseInt($('#nav_sidebar').css('marginTop'))+$('#nav_sidebar').height()+19,image_min_width=$('.meta',asset_details).width()+20+(account.logged_in?251:125);function setImageLimits(){var browser_width=window.innerWidth,browser_height=window.innerHeight-112;var min_height='',max_width='';if(browser_width>=815){min_height=Math.max(area_min_height,asset_aside.height()+20);max_width=Math.max(IMAGE_MIN_HEIGHT,browser_height)/vector.ratio;max_width=Math.min(1000/vector.ratio,max_width);max_width=Math.min(IMAGE_MAX_SIDE,max_width);max_width=Math.max(image_min_width,max_width);}
asset.css({minHeight:min_height,maxWidth:max_width});}
function launchPaymentBox(license){var box=new PaymentBox({id:vector.id,title:vector.title,license:license,cost:COST_FEE[license],});box.on('purchase',onFeePurchase);}
function onDownloadClick(license,payment,credit_cost){if(account.is_owner||vector.license_status==license||vector.license_status==VectorOptions.LICENSE_EXPANDED){downloadAttempt(license);}
else if(license==VectorOptions.LICENSE_FREE){if(account.logged_in){downloadAttempt(license);}else{var box=new SignupBox();}}
else if(payment==VectorOptions.PAYMENT_FEE){launchPaymentBox(license);}
else if(!account.logged_in){var box=new SignupBox();}
else if(payment==VectorOptions.PAYMENT_SUBSCRIPTION){if(account.downloads>0){purchaseAttempt(license,VectorOptions.PAYMENT_SUBSCRIPTION);}else{VectorStock.goToURL('/purchase/subscription?id='+vector.id);}}
else if(payment==VectorOptions.PAYMENT_CREDITS){if(account.credits>=credit_cost){purchaseAttempt(license,VectorOptions.PAYMENT_CREDITS,credit_cost);}else{VectorStock.goToURL('/purchase/credits?id='+vector.id+'&license='+license);}}}
function downloadAttempt(license){vector_options.disableButton('Downloading…');var url_download='/api/vector/download/'+vector.id;$.get(url_download).done(function(response){if(response.success==1){VectorStock.trackAction('Download',{id:vector.id,license:license.toTitleCase(),Value:0});VectorStock.track('send','event','Download',license.toTitleCase()+' license','#'+vector.id,0);downloadVector(response.url,license);}
else{var message='Image: #'+vector.id+', Message: ';if(response.message)message+=response.message;else message+='No message set: '+JSON.stringify(response);VectorStock.track('send','event','Error (User)','Download',message);alert('Sorry, download failed - '+(response.message||'Unknown server error, please contact support'));}
vector_options.enableButton();}).fail(function(event){VectorStock.track('send','event','Error (JS)','CustomError: Download API Call Failed','Image: #'+vector.id+', '+JSON.stringify(event));vector_options.enableButton();});}
function purchaseAttempt(license,payment_type,credit_cost){vector_options.disableButton('Processing…');var url_download='/api/'+payment_type+'/purchase/'+vector.id;if(payment_type==VectorOptions.PAYMENT_CREDITS){url_download+=(license?'/'+license:'');}
$.get(url_download).done(function(response){if(response.success==1){onPurchaseSuccess(license,payment_type,credit_cost,response);}
else{VectorStock.track('send','event','Error (User)','Download','Image: #'+vector.id+', Message: '+(response.message||'[No message set]'));alert('Sorry, purchase failed - '+(response.message||'Unknown server error, please contact support'));}
vector_options.enableButton();}).fail(function(event){vector_options.enableButton();});}
function onPurchaseSuccess(license,payment_type,credit_cost,response){license=(license||VectorOptions.LICENSE_STANDARD);vector.license_status=license;but_cart.trigger('unselect');asset_options.attr('data-cart','off');setTimeout(function(){VectorStock.removeFromCart(vector.id);},1000);VectorStock.userData.addPurchase(vector.id);$('input[id="vector_license_status"]',asset_form).val(license);vector_options.setPurchased(license);if(response.downloads!==undefined){VectorStock.setTally('subscription',response.downloads);}
if(response.credits!==undefined){VectorStock.setTally('credits',response.credits);}
var event_action=license.toTitleCase()+' license',event_label='#'+vector.id+' ',event_value=(credit_cost||1);if(payment_type==VectorOptions.PAYMENT_SUBSCRIPTION){event_label+='(1 sub download)';}else{event_label+='('+credit_cost+' credit'+(credit_cost==1?'':'s')+')';}
VectorStock.trackAction('Download',{id:vector.id,license:license.toTitleCase(),value:event_value});VectorStock.track('send','event','Download',event_action,event_label,event_value);downloadVector(response.url,license);}
function downloadVector(url_download,license){if(license==VectorOptions.LICENSE_FREE&&!attribution){attribution=new VectorAttribution(vector.id,vector.url,vector.title);setTimeout(function(){VectorStock.goToURL(url_download);},1000);}else{VectorStock.goToURL(url_download);}}
function onFeePurchase(url_download,license){license=(license||VectorOptions.LICENSE_STANDARD);vector.license_status=license;but_cart.trigger('unselect');asset_options.attr('data-cart','off');setTimeout(function(){VectorStock.removeFromCart(vector.id);},1000);VectorStock.userData.addPurchase(vector.id);$('input[id="vector_license_status"]',asset_form).val(license);vector_options.setPurchased(license);var event_action=license.toTitleCase()+' license',event_label='#'+vector.id+' (Fee)',event_value=COST_FEE[license];VectorStock.trackAction('Download',{id:vector.id,license:license.toTitleCase(),value:event_value});VectorStock.track('send','event','Download',event_action,event_label,event_value);VectorStock.goToURL(url_download);vector_options.triggerDownload();}
function onChangeLicense(license){var but_cart_disabled=false;if(license==VectorOptions.LICENSE_FREE||vector.license_status==license||vector.license_status==VectorOptions.LICENSE_EXPANDED){but_cart_disabled=true;}
but_cart.prop('disabled',but_cart_disabled);}
function onClickImage(){if(vector.license_status==vector_options.license){downloadAttempt(vector_options.license);}
else{if(account.logged_in){if(vector_options.license==VectorOptions.LICENSE_FREE){downloadAttempt(vector_options.license);}
else if(!account.credits&&!account.downloads){if(vector_options.payment==VectorOptions.PAYMENT_FEE){launchPaymentBox(vector_options.license);}else{VectorStock.goToURL('/purchase?id='+vector.id);}}}else{if(vector_options.license==VectorOptions.LICENSE_FREE){VectorStock.goToURL('/signup');}else if(vector_options.payment==VectorOptions.PAYMENT_FEE){launchPaymentBox(vector_options.license);}else{VectorStock.goToURL('/signup');}}}}
$(window).on('resize focus',setImageLimits);setImageLimits();image_desktop.on('click',onClickImage);image_mobile.on('click',onClickImage);$('button[data-action="follow"]',asset_details).each(function(){var button=$(this),label=$('.label',button),tooltip;button.on('mouseenter',function(){if(button.hasClass('selected'))return;var left=button.offset().left+(button.outerWidth()/2),top=button.offset().top+button.outerHeight()+5,message=button.attr('title');tooltip=new Tooltip(left,top,message);button.attr('title','');button.one('mouseleave',function(){if(tooltip)tooltip.remove();button.attr('title',message);});});button.on('click',function(){var is_following=button.hasClass('selected');var label_text=(is_following?'Follow':'Following');button.toggleClass('selected');label.text(label_text);if(tooltip)tooltip.remove();if(is_following){VectorStock.removeFromFollowing(vector.artist);}else{VectorStock.addToFollowing(vector.artist);}});});but_cart.each(function(){var label=$('.label',but_cart),in_cart=but_cart.hasClass('selected');but_cart.on('select',function(){label.text('In Cart');but_cart.addClass('selected');in_cart=true;});but_cart.on('unselect',function(){label.text('Add to Cart');but_cart.removeClass('selected');in_cart=false;});but_cart.on('click',function(){if(in_cart){but_cart.trigger('unselect');VectorStock.removeFromCart(vector.id);}else{but_cart.trigger('select');VectorStock.addToCart(vector.id,vector_options.license);}});});but_gallery.on('click',function(){var box=new GalleryBox(vector.id,vector.title,vector.artist);});vector_options.on('change_license',onChangeLicense).on('download',onDownloadClick);$('.filetypes li',asset_aside).on('mouseover',function(){var item=$(this),abbr=$('abbr',item);var left=item.offset().left+(item.outerWidth()/2),top=item.offset().top+item.outerHeight()+3,message=abbr.attr('title');var tooltip=new Tooltip(left,top,message);abbr.attr('title','');item.one('mouseleave',function(){tooltip.remove();abbr.attr('title',message);});});$('.gallery li:not(.more)',related).each(function(){var image=new VectorStock.LazyImage($(this),50);image.on('loaded',function(image_id){related_viewed.push(image_id);});image.anchor.on('click',function(){});});$('html.no-mobile .gallery.small li:not(.more) a').each(function(){var link=$(this),vector_id=/(\d+)$/.exec(link.attr('href')),vector_title=link.attr('title');if(vector_id){var preview=new PreviewLink(link,vector_id[0],vector_title);}});$(window).on('beforeunload',function(){if(related_viewed.length){}});});